# Ahoy Indie Media - Deployment Guide

## Render.com Deployment

This application is configured for easy deployment on Render.com.

### Files Created for Deployment

1. **render.yaml** - Render.com service configuration
2. **Dockerfile** - Docker container configuration
3. **Procfile** - Process file for web dyno
4. **.dockerignore** - Files to exclude from Docker build
5. **Updated run.py** - Production-ready startup script

### Environment Variables

The following environment variables are automatically set by Render.com:

- `RENDER=true` - Indicates production environment
- `PORT` - Port number (automatically assigned by Render)
- `SECRET_KEY` - Generated automatically by Render

### Deployment Steps

1. **Connect Repository**: Link your GitHub repository to Render.com
2. **Auto-Deploy**: The `render.yaml` file enables automatic deployment on push to main branch
3. **Build Process**: Render will automatically install dependencies and build the application
4. **Start Command**: Uses `python run.py` to start the application

### Key Configuration Changes

#### run.py Updates
- **Environment Detection**: Automatically detects production vs development
- **Host Binding**: Uses `0.0.0.0` for production (required by Render)
- **Port Configuration**: Uses `PORT` environment variable from Render
- **Error Handling**: Improved error handling for production

#### render.yaml Configuration
```yaml
services:
  - type: web
    name: ahoy-indie-media
    env: python
    plan: free
    buildCommand: pip install -r requirements.txt
    startCommand: python run.py
    envVars:
      - key: FLASK_ENV
        value: production
      - key: RENDER
        value: true
      - key: SECRET_KEY
        generateValue: true
    healthCheckPath: /
    autoDeploy: true
    branch: main
```

### Troubleshooting

#### Common Issues

1. **Port Binding Error**: 
   - **Problem**: "Port scan timeout reached, no open ports detected on 0.0.0.0"
   - **Solution**: Ensure the app binds to `0.0.0.0` and uses the `PORT` environment variable

2. **Build Failures**:
   - **Problem**: Dependencies not installing correctly
   - **Solution**: Check `requirements.txt` and ensure all dependencies are specified

3. **Startup Timeout**:
   - **Problem**: Application takes too long to start
   - **Solution**: Optimize imports and reduce startup time

### Performance Optimizations

1. **Caching**: Added cache headers to main routes
2. **Compression**: Enabled Flask-Compress for response compression
3. **Static Files**: Optimized static file serving
4. **Database**: Using JSON files for data storage (no external database required)

### Monitoring

- **Health Check**: Configured at root path (`/`)
- **Logs**: Available in Render dashboard
- **Metrics**: Basic metrics available in Render dashboard

### Scaling

- **Free Tier**: Limited to 750 hours/month
- **Upgrade**: Available for always-on deployment
- **Auto-Sleep**: Free instances sleep after 15 minutes of inactivity

### Security

- **Secret Key**: Automatically generated by Render
- **HTTPS**: Automatically provided by Render
- **Environment Variables**: Securely managed by Render

### Local Development

For local development, simply run:
```bash
python run.py
```

The application will automatically detect the development environment and use appropriate settings.

### Production Checklist

- [ ] All dependencies in `requirements.txt`
- [ ] Application binds to `0.0.0.0`
- [ ] Uses `PORT` environment variable
- [ ] Health check endpoint configured
- [ ] Error handling implemented
- [ ] Logging configured
- [ ] Static files optimized
- [ ] Caching headers set
