import{_ as C,o as S,G as _,c as e,d as o,e as s,B as n,t as r,f as l,j as f,k as p,L as E,m as k,p as L,s as x}from"./index-C-wMUvYW.js";const B={class:"account-page"},A={key:0,class:"account-card"},V={class:"account-profile"},F={class:"account-name"},I={class:"account-email"},N={class:"account-section"},T={class:"wallet-balance"},j={class:"wallet-amount"},O=["disabled"],D={key:0,class:"fas fa-spinner fa-spin"},G={key:1,class:"fas fa-wallet"},J={class:"account-section"},M={key:1,class:"account-guest"},P={__name:"AccountView",setup(R){const v=x(),a=E(),c=k(null),i=k(!1);S(async()=>{if(a.isLoggedIn.value)try{const u=await _("/payments/wallet");c.value=u.balance??0}catch{c.value=0}});async function h(){if(!a.isLoggedIn.value){v.push("/login");return}const u=10;i.value=!0;try{const t=await _("/payments/wallet/fund",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:u})});if(t.checkout_url){window.location.href=t.checkout_url;return}window.dispatchEvent(new CustomEvent("ahoy:toast",{detail:{message:t.error||"Could not start checkout",type:"error"}}))}catch(t){window.dispatchEvent(new CustomEvent("ahoy:toast",{detail:{message:t.message||"Failed to add funds",type:"error"}}))}finally{i.value=!1}}async function b(){await a.logout(),window.dispatchEvent(new CustomEvent("ahoy:toast",{detail:{message:"Signed out",type:"success"}})),v.push("/")}return(u,t)=>{var m,y,g,w;const d=L("router-link");return e(),o("div",B,[t[11]||(t[11]=s("div",{class:"unified-header"},[s("div",{class:"header-content"},[s("h1",null,"Account")])],-1)),n(a).isLoggedIn.value?(e(),o("div",A,[s("div",V,[t[0]||(t[0]=s("div",{class:"account-avatar"},[s("i",{class:"fas fa-user-circle"})],-1)),s("div",F,r(((m=n(a).user.value)==null?void 0:m.display_name)||((y=n(a).user.value)==null?void 0:y.username)||((g=n(a).user.value)==null?void 0:g.email)),1),s("div",I,r((w=n(a).user.value)==null?void 0:w.email),1)]),s("section",N,[t[3]||(t[3]=s("h2",{class:"account-section-title"},"Wallet",-1)),s("div",T,[t[1]||(t[1]=s("span",{class:"wallet-label"},"Balance",-1)),s("span",j,"$"+r((c.value??0).toFixed(2)),1)]),t[4]||(t[4]=s("p",{class:"wallet-note"},"Use your wallet for boosts and merch checkout.",-1)),s("button",{type:"button",class:"account-btn primary",disabled:i.value,onClick:h},[i.value?(e(),o("i",D)):(e(),o("i",G)),t[2]||(t[2]=l(" Add funds ",-1))],8,O)]),s("section",J,[t[7]||(t[7]=s("h2",{class:"account-section-title"},"Links",-1)),f(d,{to:"/my-saves",class:"account-link"},{default:p(()=>[...t[5]||(t[5]=[s("i",{class:"fas fa-bookmark"},null,-1),l(" Saved ",-1)])]),_:1}),f(d,{to:"/settings",class:"account-link"},{default:p(()=>[...t[6]||(t[6]=[s("i",{class:"fas fa-cog"},null,-1),l(" Settings ",-1)])]),_:1})]),s("button",{type:"button",class:"account-btn logout",onClick:b},[...t[8]||(t[8]=[s("i",{class:"fas fa-sign-out-alt"},null,-1),l(" Sign out ",-1)])])])):(e(),o("div",M,[t[10]||(t[10]=s("p",null,"Sign in to see your account, wallet, and saved items.",-1)),f(d,{to:"/login",class:"account-btn primary"},{default:p(()=>[...t[9]||(t[9]=[l("Sign in",-1)])]),_:1})]))])}}},W=C(P,[["__scopeId","data-v-132a8967"]]);export{W as default};
