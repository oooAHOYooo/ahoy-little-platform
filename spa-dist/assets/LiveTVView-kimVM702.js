import{_ as Ke,o as We,b as Oe,c,d,e as l,f as L,t as u,n as F,C as T,F as x,r as P,i as M,G as ze,E as qe,a as Qe,M as Xe,m as h,q as se,L as Je,g as we}from"./index-B40IuYg0.js";const Ye={class:"tv-container"},Ze={class:"video-spotlight"},Ie={class:"spotlight-grid"},je={class:"spotlight-left"},et={class:"panelstream-player hero-player"},tt={class:"video-header"},nt={class:"channel-name-label","aria-live":"polite"},st={class:"channel-remote remote-below","aria-label":"Channel Controls"},lt={class:"playing-now glass"},at=["src"],ot={class:"now-col"},it={class:"np-title"},rt={class:"np-sub"},ut={class:"next-col"},ct={class:"np-next"},dt={class:"ltv-progress-wrap"},vt={class:"right-dashboard glass hidden-mobile","aria-label":"Channel Dashboard"},ht=["src"],ft={class:"rd-now"},mt={class:"rd-title"},pt={class:"rd-meta"},gt={class:"rd-next"},bt={class:"rd-title"},yt={id:"channel-selector"},wt={key:1,class:"channel-selector-empty"},_t={class:"channel-selector-empty-text"},Tt={key:0,class:"channel-selector-empty-hint"},kt=["onClick","onMouseenter"],Ct={class:"channel-sideways-text"},Mt={class:"channel-content"},Ut={class:"cc-header"},Dt={key:0,class:"cc-status"},Et={key:1,class:"cc-time"},St={class:"cc-program"},Lt={class:"cc-title"},xt={key:0,class:"cc-meta"},Pt={key:0,class:"cc-progress-track"},Vt=["src"],Nt={class:"live-tv-channel-preview-title"},$t={class:"live-tv-channel-preview-meta"},Rt={class:"channel-list",role:"listbox","aria-label":"Live TV Channels"},At=["aria-selected","onClick","onKeydown"],Ft={class:"channel-name"},Gt={class:"live-tv-main"},Bt={class:"mobile-only",style:{padding:"8px 10px"}},Ht={class:"guide"},Kt={class:"guide-timebar"},Wt={class:"guide-scroller"},Ot={class:"guide-rows",role:"grid","aria-label":"Channel Guide"},zt={class:"guide-channel-label"},qt={class:"guide-track"},Qt=["data-row","data-col","aria-label","onClick","onKeydown"],Xt=["src","alt"],Jt={class:"program-title"},Yt={class:"program-meta"},G="",_e=6,le=180,Zt=2,It={__name:"LiveTVView",setup(jt){const y=h(null),B=h(null),v=h([]),m=h(0),H=h(!0),K=h(!1),V=h(!1),N=h(!0),X=h("Live"),J=h("—"),Y=h(G),Z=h("—"),I=h(0),W=h(!1),b=h({}),$=h({row:0,col:0}),w=h({visible:!1,x:0,y:0,thumb:"",title:"",meta:""});let U=null;const O=h([]);let z="",D=null;const R=["#7c66ff","#ff6b6b","#22c55e","#f59e0b"],ae=se(()=>{const e=m.value,t=v.value[e];return`Channel ${String(e+1).padStart(2,"0")} — ${(t==null?void 0:t.name)||"Live TV"}`}),Te=se(()=>{const e=[],t=new Date;for(let s=0;s<=le;s+=30){const n=new Date(t.getTime()+s*6e4);e.push(n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}))}return e}),oe=se(()=>{b.value;const e={},t=new Date;return v.value.forEach((s,n)=>{const a=[];let o=new Date(t),f=0;const r=s.items||[];if(!r.length){e[n]=a;return}for(;ie(t,o)<le;){const i=r[f%r.length],g=(i==null?void 0:i.video_url)||(i==null?void 0:i.mp4_link)||(i==null?void 0:i.trailer_url)||"",_=Math.max(5,Math.round(((i==null?void 0:i.duration_seconds)||300)/60)),C=new Date(o.getTime()+_*6e4);a.push({title:(i==null?void 0:i.title)||"Untitled",thumbnail:ee(i,g),category:(i==null?void 0:i.category)||s.name||"Show",durMin:_,widthPx:_*_e,timeLabel:`${j(o)} – ${j(C)}`,startUTC:o.getTime(),endUTC:C.getTime(),src:g,item:i}),o=C,f++}e[n]=a}),e});function ie(e,t){return Math.round((t.getTime()-e.getTime())/6e4)}function j(e){return e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function E(e){return e&&e.replace(/\[[^\]]*\]/g,"").replace(/\([^)]*\)/g,"").trim()||"Untitled"}function A(e){return(e==null?void 0:e.video_url)||(e==null?void 0:e.mp4_link)||(e==null?void 0:e.trailer_url)||""}function ee(e,t){if(e!=null&&e.thumbnail)return e.thumbnail;const s=t||A(e);return s&&b.value[s]?b.value[s]:G}const q=[];let te=0;function ke(e){return new Promise((t,s)=>{if(!e||typeof e!="string"){s(new Error("Invalid video URL"));return}const n=document.createElement("video");n.muted=!0,n.playsInline=!0,n.crossOrigin="anonymous",n.preload="metadata";const a=setTimeout(()=>{n.src="",n.load(),s(new Error("Timeout"))},15e3);n.onerror=()=>{clearTimeout(a),s(new Error("Video load failed"))},n.onloadeddata=()=>{const o=Math.min(1,Math.max(0,n.duration?n.duration*.05:1));n.currentTime=o},n.onseeked=()=>{clearTimeout(a);try{const o=document.createElement("canvas"),f=320,r=Math.round(n.videoHeight/n.videoWidth*f)||180;o.width=f,o.height=r;const i=o.getContext("2d");if(!i){t(null);return}i.drawImage(n,0,0,f,r);const g=o.toDataURL("image/jpeg",.85);n.src="",n.load(),t(g)}catch(o){s(o)}},n.src=e,n.load().catch(()=>s(new Error("Load failed")))})}function ne(){if(te>=Zt||q.length===0)return;const e=q.shift();if(b.value[e]){ne();return}te++,ke(e).then(t=>{t&&(b.value={...b.value,[e]:t})}).catch(()=>{}).finally(()=>{te--,ne()})}function Ce(e){!e||b.value[e]||q.includes(e)||(q.push(e),ne())}function Me(){const e=[],t=new Date;v.value.forEach((s,n)=>{const a=s.items||[];if(!a.length)return;let o=new Date(t),f=0;for(;ie(t,o)<le;){const r=a[f%a.length],i=Math.max(5,Math.round(((r==null?void 0:r.duration_seconds)||300)/60)),g=new Date(o.getTime()+i*6e4);e.push({startUTC:o.getTime(),endUTC:g.getTime(),row:n,col:f,title:(r==null?void 0:r.title)||"Program",category:(r==null?void 0:r.category)||s.name||"Show",src:A(r),thumb:(r==null?void 0:r.thumbnail)||"",durationSec:i*60}),o=g,f++}}),e.sort((s,n)=>s.startUTC-n.startUTC),O.value=e}function p(e){const t=Date.now();for(const s of O.value)if(!(e!=null&&s.row!==e)&&t>=s.startUTC&&t<s.endUTC)return s;return null}function re(e){const t=Date.now();let s=null;for(const n of O.value)e!=null&&n.row!==e||n.startUTC>t&&(!s||n.startUTC<s.startUTC)&&(s=n);return s}function ue(e){const t=Math.max(0,Date.now()-e.startUTC);return Math.max(0,Math.min(Math.floor(t/1e3),e.durationSec-1))}function Ue(){const e=y.value;if(!e||!O.value.length)return;const t=p(m.value);if(!t||!t.src)return;const s=t.src!==z,n=ue(t);if(s){z=t.src;try{e.pause()}catch{}e.src=t.src;try{e.load()}catch{}e.currentTime=n,e.muted=!0,N.value=!0,e.play().catch(()=>{});const a=v.value[m.value];Je({id:`live_tv-${(a==null?void 0:a.id)??m.value}-${t.startUTC}`,type:"live_tv",title:t.title||"Live TV",host:(a==null?void 0:a.name)||ae.value,thumbnail:t.thumb,url:t.src})}else if(Math.abs((e.currentTime||0)-n)>3)try{e.currentTime=n}catch{}}function De(){const e=p(m.value),t=re(m.value);e&&(X.value=E(e.title),J.value=e.category||"",Y.value=e.thumb||b.value[e.src]||G),Z.value=t?E(t.title):"—"}function Ee(){const e=p(m.value);if(!e){I.value=0;return}const t=Date.now();I.value=Math.max(0,Math.min(100,(t-e.startUTC)/(e.endUTC-e.startUTC)*100))}function Q(){Ue(),De(),Ee()}function ce(){const e=p(m.value);if(!e)return;const t=y.value;if(!t)return;const s=ue(e);try{Math.abs((t.currentTime||0)-s)>2&&(t.currentTime=s)}catch{}}function Se(){V.value=!1;const e=re(m.value);if(!e)return;const t=()=>{z="",Q()},s=Date.now();s<e.startUTC?setTimeout(t,Math.max(0,e.startUTC-s+50)):t()}function Le(){y.value&&(V.value?y.value.pause():y.value.play().catch(()=>{}))}function xe(){y.value&&(N.value=!N.value,y.value.muted=N.value)}function Pe(){var t,s,n;const e=y.value||document.documentElement;document.fullscreenElement?(n=document.exitFullscreen)==null||n.call(document):(s=(t=e==null?void 0:e.requestFullscreen)==null?void 0:t.call(e))==null||s.catch(()=>{})}function Ve(){const e=v.value.length;if(!e)return;const t=(m.value+1)%e;k(t)}function Ne(){const e=v.value.length;if(!e)return;const t=(m.value-1+e)%e;k(t)}function k(e){m.value=e,z="",Q()}function $e(){var e;(e=B.value)==null||e.scrollIntoView({behavior:"smooth",block:"start"})}function Re(e){var n;const t=p(e);if(t)return E(t.title);const s=v.value[e];return(n=s==null?void 0:s.items)!=null&&n.length?E(s.items[0].title):"Off Air"}function Ae(e){const t=p(e);if(!t)return 0;const s=Date.now();return Math.max(0,Math.min(100,(s-t.startUTC)/(t.endUTC-t.startUTC)*100))}function Fe(e){var n;const t=p(e),s=v.value[e];return t?t.thumb||b.value[t.src]||null:(n=s==null?void 0:s.items)!=null&&n.length?ee(s.items[0],A(s.items[0])):null}function Ge(e){const t=Fe(e);return t&&t!==G?{backgroundImage:`url(${t})`}:{background:`linear-gradient(135deg, ${R[e%4]}22 0%, #111 60%)`,opacity:.8}}function Be(e,t){de(),U=setTimeout(()=>{var fe,me,pe,ge,be,ye;const s=v.value[t];if(!s)return;const n=p(t),a=(n==null?void 0:n.src)||A((fe=s.items)==null?void 0:fe[0]),o=n?n.thumb||b.value[n.src]||G:ee((me=s.items)==null?void 0:me[0],a),f=E(n?n.title:(ge=(pe=s.items)==null?void 0:pe[0])==null?void 0:ge.title),r=(n==null?void 0:n.category)||((ye=(be=s.items)==null?void 0:be[0])==null?void 0:ye.category)||s.name||"",i=e.target.closest(".channel-button").getBoundingClientRect(),g=280;let _=i.left+i.width/2-g/2,C=i.top-12;_<12&&(_=12),_+g>window.innerWidth-12&&(_=window.innerWidth-g-12),C<12&&(C=i.bottom+12),w.value={visible:!0,x:_,y:C,thumb:o,title:f,meta:r}},1e3)}function de(){U&&(clearTimeout(U),U=null),w.value={...w.value,visible:!1}}function S(e,t){$.value={row:e,col:t}}function ve(e){var o;if(!B.value)return;const t=B.value.getBoundingClientRect();if(t.bottom<0||t.top>window.innerHeight)return;const s=v.value.length;if(!s)return;const{row:n,col:a}=$.value;if(e.key==="ArrowUp")e.preventDefault(),S(Math.max(0,n-1),a);else if(e.key==="ArrowDown")e.preventDefault(),S(Math.min(s-1,n+1),a);else if(e.key==="ArrowRight"){e.preventDefault();const f=(((o=oe.value[n])==null?void 0:o.length)||1)-1;S(n,Math.min(f,a+1))}else e.key==="ArrowLeft"?(e.preventDefault(),S(n,Math.max(0,a-1))):e.key==="Enter"&&(e.preventDefault(),k($.value.row))}function He(e){var s;const t=(e==null?void 0:e.channels)??((s=e==null?void 0:e.data)==null?void 0:s.channels)??[];return Array.isArray(t)?t.map(n=>({...n,id:(n==null?void 0:n.id)??"misc",name:(n==null?void 0:n.name)??"Channel",items:Array.isArray(n==null?void 0:n.items)?n.items:[]})):[]}async function he(){H.value=!0,K.value=!1,D&&(clearInterval(D),D=null);let e=null;try{e=await qe("/api/live-tv/channels?_="+Date.now())}catch{try{e=await Qe("/api/live-tv/channels")}catch{K.value=!0,v.value=[],H.value=!1;return}}v.value=He(e||{}),v.value.length&&(Me(),Q(),D=setInterval(Q,1e3),Xe(()=>{v.value.forEach(t=>{(t.items||[]).forEach(s=>{const n=A(s);n&&!(s!=null&&s.thumbnail)&&Ce(n)})})})),H.value=!1}return We(async()=>{document.addEventListener("keydown",ve),await he()}),Oe(()=>{D&&clearInterval(D),U&&clearTimeout(U),document.removeEventListener("keydown",ve)}),(e,t)=>(c(),d("div",Ye,[t[21]||(t[21]=l("section",{class:"podcasts-hero"},[l("div",{class:"podcasts-hero-inner"},[l("h1",null,[l("i",{class:"fas fa-tv","aria-hidden":"true"}),L(" Live TV ")]),l("p",null,"Channel surf and watch live programming.")])],-1)),l("div",Ze,[l("div",Ie,[l("div",je,[l("div",et,[l("video",{ref_key:"videoEl",ref:y,controls:"",autoplay:"",muted:"",playsinline:"","webkit-playsinline":"",onPlay:t[0]||(t[0]=s=>V.value=!0),onPause:t[1]||(t[1]=s=>V.value=!1),onEnded:Se,onError:ce,onStalled:ce},null,544),l("div",tt,[t[4]||(t[4]=l("span",{class:"now-playing-label"},"Now Playing",-1)),l("span",nt,u(ae.value),1)]),t[5]||(t[5]=l("div",{class:"hero-glass"},null,-1))]),l("div",st,[l("button",{type:"button",class:"remote-btn",title:"Play/Pause",onClick:Le},[l("i",{class:F(V.value?"fas fa-pause":"fas fa-play")},null,2)]),l("button",{type:"button",class:"remote-btn",title:"Mute",onClick:xe},[l("i",{class:F(N.value?"fas fa-volume-mute":"fas fa-volume-up")},null,2)]),l("button",{type:"button",class:"remote-btn",title:"Fullscreen",onClick:Pe},[...t[6]||(t[6]=[l("i",{class:"fas fa-expand"},null,-1)])]),l("button",{type:"button",class:"remote-btn",title:"Go to Guide",onClick:$e},[...t[7]||(t[7]=[l("i",{class:"fas fa-list"},null,-1)])]),l("button",{type:"button",class:"remote-btn",title:"Channel Up",onClick:Ve},[...t[8]||(t[8]=[l("i",{class:"fas fa-chevron-up"},null,-1)])]),l("button",{type:"button",class:"remote-btn",title:"Channel Down",onClick:Ne},[...t[9]||(t[9]=[l("i",{class:"fas fa-chevron-down"},null,-1)])])]),l("div",lt,[l("img",{src:Y.value,alt:""},null,8,at),l("div",ot,[l("div",it,u(X.value),1),l("div",rt,u(J.value),1)]),l("div",ut,[t[10]||(t[10]=l("div",{class:"np-label"},"Up Next",-1)),l("div",ct,u(Z.value),1)]),l("div",dt,[l("div",{class:"ltv-progress",style:T({width:I.value+"%"})},null,4)])])]),l("aside",vt,[l("img",{src:Y.value,alt:"",class:"rd-thumb"},null,8,ht),l("div",ft,[t[11]||(t[11]=l("div",{class:"rd-label"},"Playing Now",-1)),l("div",mt,u(X.value),1),l("div",pt,[l("span",null,u(J.value),1)])]),l("div",gt,[t[12]||(t[12]=l("div",{class:"rd-label"},"Up Next",-1)),l("div",bt,u(Z.value),1)])])])]),l("div",yt,[H.value?(c(),d(x,{key:0},P(4,s=>l("div",{key:"skeleton-"+s,class:"channel-button",style:{"pointer-events":"none"}},[...t[13]||(t[13]=[l("div",{class:"skeleton",style:{height:"20px",width:"70%","margin-bottom":"8px"}},null,-1),l("div",{class:"skeleton",style:{height:"14px",width:"50%"}},null,-1)])])),64)):v.value.length===0?(c(),d("div",wt,[l("p",_t,u(K.value?"Couldn't load channels":"No channels available"),1),K.value?(c(),d("p",Tt,"Check your connection and try again.")):M("",!0),l("button",{type:"button",class:"channel-selector-retry",onClick:he},[...t[14]||(t[14]=[l("i",{class:"fas fa-sync-alt"},null,-1),L(" Retry ",-1)])])])):(c(!0),d(x,{key:2},P(v.value,(s,n)=>(c(),d("button",{key:s.id,type:"button",class:F(["channel-button",{active:m.value===n}]),onClick:a=>k(n),onMouseenter:a=>Be(a,n),onMouseleave:de},[l("div",{class:"channel-strip",style:T({"--strip-color":R[n%4]})},[l("div",Ct,[L(" CH "+u(String(n+1).padStart(2,"0"))+" ",1),t[15]||(t[15]=l("span",{class:"bullet"},"•",-1)),L(" "+u(s.name),1)])],4),l("div",Mt,[l("div",Ut,[m.value===n?(c(),d("div",Dt,[...t[16]||(t[16]=[l("span",{class:"pulsing-dot"},null,-1),L(" WATCHING ",-1)])])):M("",!0),p(n)?(c(),d("div",Et,u(j(new Date(p(n).startUTC))),1)):M("",!0)]),l("div",St,[l("div",Lt,u(Re(n)),1),p(n)?(c(),d("div",xt,u(p(n).category||s.name),1)):M("",!0)]),p(n)?(c(),d("div",Pt,[l("div",{class:"cc-progress-fill",style:T({width:Ae(n)+"%",background:R[n%4]})},null,4)])):M("",!0)]),l("div",{class:"channel-bg-image",style:T(Ge(n))},null,4),t[17]||(t[17]=l("div",{class:"channel-bg-overlay"},null,-1))],42,kt))),128))]),w.value.visible?(c(),d("div",{key:0,class:"live-tv-channel-preview visible",style:T({left:w.value.x+"px",top:w.value.y+"px"}),"aria-hidden":"true"},[l("img",{src:w.value.thumb,alt:""},null,8,Vt),l("div",Nt,u(w.value.title),1),l("div",$t,u(w.value.meta),1)],4)):M("",!0),l("div",{ref_key:"guideRef",ref:B,class:"live-tv-container","aria-label":"TV Guide"},[l("aside",{class:F(["live-tv-sidebar",{open:W.value}]),"aria-label":"Channels"},[l("ul",Rt,[(c(!0),d(x,null,P(v.value,(s,n)=>(c(),d("li",{key:s.id,class:"channel-item",role:"option","aria-selected":String(m.value===n),tabindex:"0",onClick:a=>k(n),onKeydown:we(a=>k(n),["enter"])},[l("span",{class:"channel-pill",style:T({background:R[n%4]})},null,4),l("span",Ft,u(s.name),1)],40,At))),128))])],2),l("section",Gt,[l("div",Bt,[l("button",{class:"channels-btn",type:"button",onClick:t[2]||(t[2]=s=>W.value=!0)},[...t[18]||(t[18]=[l("i",{class:"fas fa-list"},null,-1),L(" Channels ",-1)])])]),l("div",Ht,[t[20]||(t[20]=ze('<div class="guide-header" data-v-16c0eaab><div data-v-16c0eaab>Guide</div><div class="kbd-hint" aria-hidden="true" data-v-16c0eaab><span data-v-16c0eaab>Navigate</span><span class="kbd" data-v-16c0eaab>↑</span><span class="kbd" data-v-16c0eaab>↓</span><span class="kbd" data-v-16c0eaab>←</span><span class="kbd" data-v-16c0eaab>→</span><span data-v-16c0eaab>Tune to channel</span><span class="kbd" data-v-16c0eaab>Enter</span></div></div>',1)),l("div",Kt,[(c(!0),d(x,null,P(Te.value,s=>(c(),d("div",{key:s,class:"time-marker",style:T({minWidth:30*_e+"px"})},u(s),5))),128))]),l("div",Wt,[l("div",Ot,[t[19]||(t[19]=l("div",{class:"now-line",style:{left:"150px"}},null,-1)),(c(!0),d(x,null,P(v.value,(s,n)=>(c(),d("div",{key:s.id,class:"guide-row",role:"row"},[l("div",zt,[l("span",{class:"guide-channel-icon",style:T({background:R[n%4]})},null,4),l("span",null,u(s.name),1)]),l("div",qt,[(c(!0),d(x,null,P(oe.value[n]||[],(a,o)=>(c(),d("div",{key:n+"-"+o,class:F(["program",{selected:$.value.row===n&&$.value.col===o}]),style:T({width:a.widthPx+"px"}),"data-row":n,"data-col":o,tabindex:"0",role:"gridcell","aria-label":a.title+" • "+a.durMin+" min",onClick:f=>{S(n,o),k(n)},onKeydown:we(f=>{S(n,o),k(n)},["enter"])},[l("img",{class:"program-thumb",src:a.thumbnail,alt:a.title,loading:"lazy"},null,8,Xt),l("div",Jt,u(a.title),1),l("div",Yt,u(a.timeLabel)+" • "+u(a.category),1)],46,Qt))),128))])]))),128))])])])]),W.value?(c(),d("div",{key:0,class:"ltv-overlay",onClick:t[3]||(t[3]=s=>W.value=!1)})):M("",!0)],512)]))}},tn=Ke(It,[["__scopeId","data-v-16c0eaab"]]);export{tn as default};
