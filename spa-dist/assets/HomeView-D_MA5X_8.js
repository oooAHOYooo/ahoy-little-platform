import{u as ee,o as te,a as R,b as se,w as ae,c as d,d as v,e as t,f as A,g as ne,h as k,t as r,i as V,j as le,k as ie,n as L,F as E,r as U,l as B,v as F,m as c,p as oe,q as re,s as ue}from"./index-Dc5YEzPe.js";const de={class:"home-page"},ve={class:"live-dashboard"},ce={class:"dashboard-grid"},he={class:"dash-preview"},fe=["src"],pe={class:"dash-overlay"},me={class:"dash-badges"},we={class:"channel-badge"},ye={key:0,class:"channel-nav"},ge={class:"dash-content"},be={class:"dash-actions"},ke={class:"dashboard-sidebar"},_e={class:"dash-thumb"},Ce=["src"],Te={class:"dash-info"},Ve={class:"radio-next-list"},Ne={class:"track-title"},xe={class:"track-artist"},Ae={key:0,class:"tv-channel-strip"},Le={class:"tv-channel-strip-list"},Se=["onClick"],$e={class:"tv-channel-strip-meta"},Ie={class:"tv-channel-strip-name"},je={class:"tv-channel-strip-now"},De={key:0,class:"tv-channel-strip-next"},Me={class:"whats-new-section"},Re={class:"whats-new-container"},Ee={class:"whats-new-header"},Ue={key:0,href:"/whats-new",class:"view-all-link"},Be={class:"whats-new-loading"},Fe={class:"whats-new-updates"},Pe=["href"],Oe={class:"whats-new-content"},He={class:"whats-new-date"},Qe={class:"whats-new-empty"},ze={__name:"HomeView",setup(We){const K=ue(),f=ee(),h=c([]),_=c(0),i=c(null),w=c(null),N=c({}),S=c({});let $=null;const z={misc:"Channel 01 — Misc",films:"Channel 02 — Short Films","music-videos":"Channel 03 — Music Videos","live-shows":"Channel 04 — Live Shows"};function P(s,e){return z[s.id]||`Channel ${String(e+1).padStart(2,"0")} — ${s.name||"Unknown"}`}function O(){var a,m;const s=new Date().getHours(),e={},l={};for(let u=0;u<h.value.length;u++){const o=h.value[u];if((a=o==null?void 0:o.items)!=null&&a.length){const g=s%o.items.length;e[o.id]=o.items[g],l[o.id]=o.items.length>g+1?o.items[g+1]:o.items[0]}}if(N.value=e,S.value=l,(m=w.value)!=null&&m.id){const u=w.value.id;e[u]&&(i.value=e[u])}}function I(s){var l;if(!h.value.length)return;_.value=(s+h.value.length)%h.value.length;const e=h.value[_.value];w.value={...e,name:P(e,_.value)},N.value[e.id]?i.value=N.value[e.id]:(l=e.items)!=null&&l.length?i.value=e.items[0]:i.value={id:"placeholder",title:"No content available",thumbnail:"/static/img/default-cover.jpg",host:e.name}}function H(s){h.value.length&&I(_.value+(s==="next"?1:-1))}function j(s){!(s!=null&&s.id)||s.id==="placeholder"||s.id==="error"||K.push({path:"/shows",query:{play:s.id}})}const b=c([]),D=c([]),C=c([]),p=c(null),M=re(()=>{if(!p.value||!f.currentTrack)return!1;const s=String(p.value.id??""),e=String(f.currentTrack.id??"");return s===e&&f.isPlaying});function G(){const s=[...b.value];s.sort(()=>.5-Math.random()),D.value=s.map(e=>({...e,type:"track"})),C.value=D.value.slice(0,20)}function J(){if(M.value){f.pause();return}if(p.value){f.resume();return}const s=D.value[0]||C.value[0];s&&(p.value=s,f.setQueue(b.value,b.value.findIndex(e=>e.id===s.id)))}const y=c([]),T=c(!0);function X(s){if(!s)return"";try{return new Date(s).toLocaleDateString(void 0,{year:"numeric",month:"short"})}catch{return s}}function Y(s){if(s.year&&s.month&&s.section){const e=`/whats-new/${s.year}/${s.month}/${s.section}`;return s.slug?`${e}#update-${s.slug}`:e}return s.link?s.link:"/whats-new"}function Z(s){var l;const e=(s==null?void 0:s.channels)??((l=s==null?void 0:s.data)==null?void 0:l.channels)??[];return Array.isArray(e)?e.map(a=>({...a,id:(a==null?void 0:a.id)??"misc",name:(a==null?void 0:a.name)??"Channel",items:Array.isArray(a==null?void 0:a.items)?a.items:[]})):[]}return te(async()=>{try{let s=null;try{s=await apiFetch("/api/live-tv/channels?_="+Date.now())}catch{s=await R("/api/live-tv/channels").catch(()=>null)}const e=s?Z(s):[];if(h.value=e,e.length){const l=e.find(a=>a.id==="misc")||e[0];_.value=e.findIndex(a=>a.id===l.id),O(),I(_.value)}else i.value={id:"placeholder",title:"Loading Live TV...",thumbnail:"/static/img/default-cover.jpg",host:"Ahoy TV"},w.value={id:"misc",name:"Channel 01 — Misc"};$=setInterval(O,60*1e3)}catch{i.value={id:"error",title:"Live TV",thumbnail:"/static/img/default-cover.jpg",host:"Ahoy TV"},w.value={id:"misc",name:"Channel 01 — Misc"}}try{const e=((await R("/api/music").catch(()=>({tracks:[]}))).tracks||[]).filter(a=>a.audio_url||a.preview_url),l=new Set;b.value=e.filter(a=>l.has(a.id)?!1:(l.add(a.id),!0)),G()}catch{}f.currentTrack&&b.value.length&&b.value.some(e=>{var l;return String(e.id)===String((l=f.currentTrack)==null?void 0:l.id)})&&(p.value=f.currentTrack),T.value=!0;try{const e=(await R("/api/whats-new").catch(()=>({updates:[]}))).updates;if(Array.isArray(e))y.value=e.slice(0,4);else if(e&&typeof e=="object"){const l=[];for(const a of Object.keys(e).sort().reverse())for(const m of Object.keys(e[a]||{}).sort().reverse())for(const u of Object.keys(e[a][m]||{})){const o=(e[a][m][u].items||[]).map(g=>({...g,year:a,month:m,section:u}));l.push(...o)}y.value=l.slice(0,4)}else y.value=[]}catch{y.value=[]}finally{T.value=!1}}),se(()=>{$&&clearInterval($)}),ae(()=>f.currentTrack,s=>{if(!s)return;b.value.some(l=>String(l.id)===String(s.id))&&(p.value=s)},{deep:!0}),(s,e)=>{var a,m,u,o,g,Q,W,q;const l=oe("router-link");return d(),v("div",de,[e[22]||(e[22]=t("section",{class:"podcasts-hero"},[t("div",{class:"podcasts-hero-inner"},[t("h1",null,[t("i",{class:"fas fa-home","aria-hidden":"true"}),A(" Home")]),t("p",null,"Explore")])],-1)),t("section",ve,[t("div",ce,[t("div",{class:"dashboard-main",role:"button",tabindex:"0",onClick:e[4]||(e[4]=n=>i.value&&i.value.id!=="placeholder"&&i.value.id!=="error"?j(i.value):null),onKeydown:e[5]||(e[5]=ne(k(n=>i.value&&i.value.id!=="placeholder"&&i.value.id!=="error"?j(i.value):null,["prevent"]),["enter"]))},[t("div",he,[t("img",{src:((a=i.value)==null?void 0:a.thumbnail)||"/static/img/default-cover.jpg",alt:"Live TV",class:"dash-bg"},null,8,fe),t("div",pe,[t("div",me,[e[6]||(e[6]=t("span",{class:"live-badge"},"LIVE TV",-1)),t("span",we,r(((m=w.value)==null?void 0:m.name)||"Channel 01 — Misc"),1)]),h.value.length>1?(d(),v("div",ye,[t("button",{type:"button",class:"channel-nav-btn","aria-label":"Previous channel",onClick:e[0]||(e[0]=k(n=>H("prev"),["stop"]))},[...e[7]||(e[7]=[t("i",{class:"fas fa-chevron-left"},null,-1)])]),t("button",{type:"button",class:"channel-nav-btn","aria-label":"Next channel",onClick:e[1]||(e[1]=k(n=>H("next"),["stop"]))},[...e[8]||(e[8]=[t("i",{class:"fas fa-chevron-right"},null,-1)])])])):V("",!0),t("div",ge,[t("h2",null,r(((u=i.value)==null?void 0:u.title)||"Loading..."),1),t("p",null,r(((o=i.value)==null?void 0:o.artist)||((g=i.value)==null?void 0:g.host)||""),1),t("div",be,[i.value&&i.value.id!=="placeholder"&&i.value.id!=="error"?(d(),v("button",{key:0,type:"button",class:"dash-play-btn",onClick:e[2]||(e[2]=k(n=>j(i.value),["stop"]))},[...e[9]||(e[9]=[t("i",{class:"fas fa-play"},null,-1),A(" Watch Now ",-1)])])):V("",!0),le(l,{to:"/live-tv",class:"dash-guide-btn",onClick:e[3]||(e[3]=k(()=>{},["stop"]))},{default:ie(()=>[...e[10]||(e[10]=[t("i",{class:"fas fa-tv"},null,-1),A(" View All Channels ",-1)])]),_:1})])])])])],32),t("div",ke,[e[14]||(e[14]=t("div",{class:"sidebar-header"},[t("h3",null,"Live Radio")],-1)),t("div",{class:L(["dash-item radio-item",{active:M.value}])},[t("div",_e,[t("img",{src:((Q=p.value||C.value[0])==null?void 0:Q.cover_art)||"https://ahoy.ooo/images/Ahoy-Indie-Media-DEFAULT-COVER-A-8.jpg",alt:"Radio"},null,8,Ce),e[11]||(e[11]=t("div",{class:"dash-icon"},[t("i",{class:"fas fa-broadcast-tower"})],-1))]),t("div",Te,[e[12]||(e[12]=t("div",{class:"dash-label"},"On Air Now",-1)),t("h4",null,r(((W=p.value||C.value[0])==null?void 0:W.title)||"Loading..."),1),t("p",null,r(((q=p.value||C.value[0])==null?void 0:q.artist)||""),1)]),t("button",{type:"button",class:"dash-action-btn","aria-label":"Play/Pause radio",onClick:k(J,["stop"])},[t("i",{class:L(M.value?"fas fa-pause":"fas fa-play")},null,2)])],2),t("div",Ve,[e[13]||(e[13]=t("div",{class:"list-label"},"Up Next",-1)),(d(!0),v(E,null,U(C.value.slice(0,3),n=>(d(),v("div",{key:n.id,class:"mini-track"},[t("span",Ne,r(n.title),1),t("span",xe,r(n.artist),1)]))),128))])])]),h.value.length>1?(d(),v("div",Ae,[e[16]||(e[16]=t("div",{class:"tv-channel-strip-header"},[t("div",{class:"tv-channel-strip-title"},"Live TV Channels"),t("div",{class:"tv-channel-strip-subtitle"},"Tap a channel to switch")],-1)),t("div",Le,[(d(!0),v(E,null,U(h.value,(n,x)=>(d(),v("button",{key:n.id,type:"button",class:L(["tv-channel-strip-item",{active:w.value&&w.value.id===n.id}]),onClick:k(qe=>I(x),["stop"])},[t("div",$e,[t("span",Ie,r(P(n,x)),1),e[15]||(e[15]=t("span",{class:"tv-channel-strip-live"},"LIVE",-1))]),t("div",je,r((N.value[n.id]||{}).title||"No content available"),1),S.value[n.id]?(d(),v("div",De," Up next: "+r((S.value[n.id]||{}).title||""),1)):V("",!0)],10,Se))),128))])])):V("",!0)]),t("section",Me,[t("div",Re,[t("div",Ee,[e[18]||(e[18]=t("h2",null,"What's New at Ahoy",-1)),!T.value&&y.value.length>0?(d(),v("a",Ue,[...e[17]||(e[17]=[A(" View All ",-1),t("i",{class:"fas fa-arrow-right"},null,-1)])])):V("",!0)]),B(t("div",Be,[...e[19]||(e[19]=[t("span",null,"Loading updates...",-1)])],512),[[F,T.value]]),B(t("div",Fe,[(d(!0),v(E,null,U(y.value,(n,x)=>(d(),v("a",{key:n.id||n.title||x,href:Y(n),class:L(["whats-new-item clickable","type-"+(n.type||"update")])},[t("div",Oe,[t("h3",null,r(n.title),1),t("p",null,r(n.description),1),t("span",He,r(X(n.date,n.type)),1)]),e[20]||(e[20]=t("div",{class:"whats-new-arrow"},[t("i",{class:"fas fa-chevron-right"})],-1))],10,Pe))),128))],512),[[F,!T.value&&y.value.length>0]]),B(t("div",Qe,[...e[21]||(e[21]=[t("p",null,"No updates available at this time.",-1),t("a",{href:"/whats-new",class:"view-archive-link"},"View Archive",-1)])],512),[[F,!T.value&&y.value.length===0]])])])])}}};export{ze as default};
