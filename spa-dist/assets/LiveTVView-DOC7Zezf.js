import{_ as Fe,o as Ge,b as Re,c as v,d as h,e as n,f as X,t as c,n as V,C as S,F as x,r as U,i as Y,H as Oe,G as We,a as Ae,m as u,q as A,g as me}from"./index-B3g4hvEb.js";const Ke={class:"tv-container"},Be={class:"video-spotlight"},je={class:"spotlight-grid"},ze={class:"spotlight-left"},He={class:"panelstream-player hero-player"},Je={class:"video-header"},qe={class:"channel-name-label","aria-live":"polite"},Qe={class:"channel-remote remote-below","aria-label":"Channel Controls"},Xe={class:"playing-now glass"},Ye=["src"],Ze={class:"now-col"},Ie={class:"np-title"},et={class:"np-sub"},tt={class:"next-col"},nt={class:"np-next"},lt={class:"ltv-progress-wrap"},st={class:"right-dashboard glass hidden-mobile","aria-label":"Channel Dashboard"},at=["src"],ot={class:"rd-now"},it={class:"rd-title"},rt={class:"rd-meta"},ct={class:"rd-next"},ut={class:"rd-title"},dt={id:"channel-selector"},vt={key:1,class:"channel-selector-empty"},ht={class:"channel-selector-empty-text"},ft={key:0,class:"channel-selector-empty-hint"},mt=["onClick","onMouseenter"],pt={class:"channel-button-name"},yt={class:"channel-button-next"},gt=["src"],bt={class:"live-tv-channel-preview-title"},wt={class:"live-tv-channel-preview-meta"},_t={class:"channel-list",role:"listbox","aria-label":"Live TV Channels"},kt=["aria-selected","onClick","onKeydown"],Ct={class:"channel-name"},Tt={class:"live-tv-main"},Mt={class:"mobile-only",style:{padding:"8px 10px"}},St={class:"player-frame","aria-live":"polite"},xt={class:"now-playing-overlay"},Ut={class:"now-title"},Dt={class:"now-meta"},Pt={class:"guide"},Et={class:"guide-timebar"},Nt={class:"guide-scroller"},Vt={class:"guide-rows",role:"grid","aria-label":"Channel Guide"},$t={class:"guide-channel-label"},Lt={class:"guide-track"},Ft=["data-row","data-col","aria-label","onClick","onKeydown"],Gt=["src","alt"],Rt={class:"program-title"},Ot={class:"program-meta"},pe=6,Z=180,Wt={__name:"LiveTVView",setup(At){const y=u(null),I=u(null),$=u(null),d=u([]),m=u(0),L=u(!0),F=u(!1),D=u(!1),P=u(!0),K=u("Select a program"),B=u("—"),j=u("/static/img/default-cover.jpg"),z=u("—"),H=u(0),G=u(!1),b=u({row:0,col:0}),J=u("Select a program"),q=u("Use arrow keys and press Enter to play"),g=u({visible:!1,x:0,y:0,thumb:"",title:"",meta:""});let _=null;const R=u([]);let O="",k=null;const ee=["#7c66ff","#ff6b6b","#22c55e","#f59e0b"],ye=[{key:"misc",titles:["misc","clips","clip"],label:"Channel 01 — Misc"},{key:"films",titles:["films","film","movies","movie","short films","short film"],label:"Channel 02 — Short Films"},{key:"music-videos",titles:["music videos","music_video","music"],label:"Channel 03 — Music Videos"},{key:"live-shows",titles:["live shows","broadcast","shows","live"],label:"Channel 04 — Live Shows"}],ge=A(()=>d.value.map((e,t)=>{const l=ye[t];return(l==null?void 0:l.label)||`Channel ${String(t+1).padStart(2,"0")} — ${e.name}`})),be=A(()=>{const e=m.value,t=d.value[e];return`Channel ${String(e+1).padStart(2,"0")} — ${(t==null?void 0:t.name)||"Live TV"}`}),we=A(()=>{const e=[],t=new Date;for(let l=0;l<=Z;l+=30){const s=new Date(t.getTime()+l*6e4);e.push(s.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}))}return e}),E=A(()=>{const e={},t=new Date;return d.value.forEach((l,s)=>{const a=[];let i=new Date(t),f=0;const r=l.items||[];if(!r.length){e[s]=a;return}for(;te(t,i)<Z;){const o=r[f%r.length],p=Math.max(5,Math.round(((o==null?void 0:o.duration_seconds)||300)/60)),w=new Date(i.getTime()+p*6e4);a.push({title:(o==null?void 0:o.title)||"Untitled",thumbnail:(o==null?void 0:o.thumbnail)||"/static/img/default-cover.jpg",category:(o==null?void 0:o.category)||l.name||"Show",durMin:p,widthPx:p*pe,timeLabel:`${ne(i)} – ${ne(w)}`,startUTC:i.getTime(),endUTC:w.getTime(),src:(o==null?void 0:o.video_url)||(o==null?void 0:o.mp4_link)||(o==null?void 0:o.trailer_url)||"",item:o}),i=w,f++}e[s]=a}),e});function te(e,t){return Math.round((t.getTime()-e.getTime())/6e4)}function ne(e){return e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function C(e){return e&&e.replace(/\[[^\]]*\]/g,"").replace(/\([^)]*\)/g,"").trim()||"Untitled"}function _e(e){return(e==null?void 0:e.video_url)||(e==null?void 0:e.mp4_link)||(e==null?void 0:e.trailer_url)||""}function ke(){const e=[],t=new Date;d.value.forEach((l,s)=>{const a=l.items||[];if(!a.length)return;let i=new Date(t),f=0;for(;te(t,i)<Z;){const r=a[f%a.length],o=Math.max(5,Math.round(((r==null?void 0:r.duration_seconds)||300)/60)),p=new Date(i.getTime()+o*6e4);e.push({startUTC:i.getTime(),endUTC:p.getTime(),row:s,col:f,title:(r==null?void 0:r.title)||"Program",category:(r==null?void 0:r.category)||l.name||"Show",src:_e(r),thumb:(r==null?void 0:r.thumbnail)||"",durationSec:o*60}),i=p,f++}}),e.sort((l,s)=>l.startUTC-s.startUTC),R.value=e}function T(e){const t=Date.now();for(const l of R.value)if(!(e!=null&&l.row!==e)&&t>=l.startUTC&&t<l.endUTC)return l;return null}function le(e){const t=Date.now();let l=null;for(const s of R.value)e!=null&&s.row!==e||s.startUTC>t&&(!l||s.startUTC<l.startUTC)&&(l=s);return l}function se(e){const t=Math.max(0,Date.now()-e.startUTC);return Math.max(0,Math.min(Math.floor(t/1e3),e.durationSec-1))}function Ce(){const e=y.value;if(!e||!R.value.length)return;const t=T(m.value);if(!t||!t.src)return;const l=t.src!==O,s=se(t);if(l){O=t.src;try{e.pause()}catch{}e.src=t.src;try{e.load()}catch{}e.currentTime=s,e.muted=!0,P.value=!0,e.play().catch(()=>{})}else if(Math.abs((e.currentTime||0)-s)>3)try{e.currentTime=s}catch{}}function Te(){const e=T(m.value),t=le(m.value);e&&(K.value=C(e.title),B.value=e.category||"",e.thumb&&(j.value=e.thumb)),z.value=t?C(t.title):"—"}function Me(){const e=T(m.value);if(!e){H.value=0;return}const t=Date.now();H.value=Math.max(0,Math.min(100,(t-e.startUTC)/(e.endUTC-e.startUTC)*100))}function W(){Ce(),Te(),Me()}function ae(){const e=T(m.value);if(!e)return;const t=y.value;if(!t)return;const l=se(e);try{Math.abs((t.currentTime||0)-l)>2&&(t.currentTime=l)}catch{}}function Se(){D.value=!1;const e=le(m.value);if(!e)return;const t=()=>{O="",W()},l=Date.now();l<e.startUTC?setTimeout(t,Math.max(0,e.startUTC-l+50)):t()}function xe(){y.value&&(D.value?y.value.pause():y.value.play().catch(()=>{}))}function Ue(){y.value&&(P.value=!P.value,y.value.muted=P.value)}function De(){var t,l,s;const e=y.value||document.documentElement;document.fullscreenElement?(s=document.exitFullscreen)==null||s.call(document):(l=(t=e==null?void 0:e.requestFullscreen)==null?void 0:t.call(e))==null||l.catch(()=>{})}function Pe(){const e=d.value.length;if(!e)return;const t=(m.value+1)%e;N(t)}function Ee(){const e=d.value.length;if(!e)return;const t=(m.value-1+e)%e;N(t)}function N(e){m.value=e,O="",W()}function Ne(){var e;(e=$.value)==null||e.scrollIntoView({behavior:"smooth",block:"start"})}function Ve(e){var s;const t=T(e);if(t)return C(t.title);const l=d.value[e];return(s=l==null?void 0:l.items)!=null&&s.length?C(l.items[0].title):"—"}function $e(e,t){oe(),_=setTimeout(()=>{var ce,ue,de,ve,he,fe;const l=d.value[t];if(!l)return;const s=T(t),a=(s==null?void 0:s.thumb)||((ue=(ce=l.items)==null?void 0:ce[0])==null?void 0:ue.thumbnail)||"/static/img/default-cover.jpg",i=C(s?s.title:(ve=(de=l.items)==null?void 0:de[0])==null?void 0:ve.title),f=(s==null?void 0:s.category)||((fe=(he=l.items)==null?void 0:he[0])==null?void 0:fe.category)||l.name||"",r=e.target.closest(".channel-button").getBoundingClientRect(),o=280;let p=r.left+r.width/2-o/2,w=r.top-12;p<12&&(p=12),p+o>window.innerWidth-12&&(p=window.innerWidth-o-12),w<12&&(w=r.bottom+12),g.value={visible:!0,x:p,y:w,thumb:a,title:i,meta:f}},1e3)}function oe(){_&&(clearTimeout(_),_=null),g.value={...g.value,visible:!1}}function M(e,t){b.value={row:e,col:t};const l=E.value[e],s=l==null?void 0:l[t];s&&(J.value=s.title,q.value=`${s.category} • ${s.durMin} min`)}function Q(){const e=E.value[b.value.row],t=e==null?void 0:e[b.value.col];if(!(t!=null&&t.src))return;const l=I.value;if(l){try{l.pause()}catch{}l.src=t.src;try{l.load()}catch{}l.play().catch(()=>{}),J.value=t.title,q.value=`${t.category} • ${t.durMin} min`}}async function Le(){var l;const e=E.value[b.value.row],t=e==null?void 0:e[b.value.col];if((l=t==null?void 0:t.item)!=null&&l.id)try{await fetch("/api/bookmarks",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({media_id:t.item.id,media_type:"show"})})}catch{try{const a="ahoy_watch_later",i=JSON.parse(localStorage.getItem(a)||"[]");i.find(f=>f.id===t.item.id)||i.push({id:t.item.id,type:"show",t:Date.now()}),localStorage.setItem(a,JSON.stringify(i))}catch{}}}function ie(e){var i;if(!$.value)return;const t=$.value.getBoundingClientRect();if(t.bottom<0||t.top>window.innerHeight)return;const l=d.value.length;if(!l)return;const{row:s,col:a}=b.value;if(e.key==="ArrowUp")e.preventDefault(),M(Math.max(0,s-1),a);else if(e.key==="ArrowDown")e.preventDefault(),M(Math.min(l-1,s+1),a);else if(e.key==="ArrowRight"){e.preventDefault();const f=(((i=E.value[s])==null?void 0:i.length)||1)-1;M(s,Math.min(f,a+1))}else e.key==="ArrowLeft"?(e.preventDefault(),M(s,Math.max(0,a-1))):e.key==="Enter"&&(e.preventDefault(),Q())}async function re(){L.value=!0,F.value=!1,k&&(clearInterval(k),k=null);let e=null;try{e=await We("/api/live-tv/channels")}catch{try{e=await Ae("/api/live-tv/channels")}catch{F.value=!0,d.value=[],L.value=!1;return}}d.value=((e==null?void 0:e.channels)||[]).map(t=>(Array.isArray(t.items)||(t.items=[]),t)),d.value.length&&(ke(),W(),k=setInterval(W,1e3)),L.value=!1}return Ge(async()=>{document.addEventListener("keydown",ie),await re()}),Re(()=>{k&&clearInterval(k),_&&clearTimeout(_),document.removeEventListener("keydown",ie)}),(e,t)=>(v(),h("div",Ke,[t[18]||(t[18]=n("section",{class:"podcasts-hero"},[n("div",{class:"podcasts-hero-inner"},[n("h1",null,[n("i",{class:"fas fa-tv","aria-hidden":"true"}),X(" Live TV ")]),n("p",null,"Channel surf and watch live programming.")])],-1)),n("div",Be,[n("div",je,[n("div",ze,[n("div",He,[n("video",{ref_key:"videoEl",ref:y,controls:"",autoplay:"",muted:"",playsinline:"","webkit-playsinline":"",onPlay:t[0]||(t[0]=l=>D.value=!0),onPause:t[1]||(t[1]=l=>D.value=!1),onEnded:Se,onError:ae,onStalled:ae},null,544),n("div",Je,[t[4]||(t[4]=n("span",{class:"now-playing-label"},"Now Playing",-1)),n("span",qe,c(be.value),1)]),t[5]||(t[5]=n("div",{class:"hero-glass"},null,-1))]),n("div",Qe,[n("button",{type:"button",class:"remote-btn",title:"Play/Pause",onClick:xe},[n("i",{class:V(D.value?"fas fa-pause":"fas fa-play")},null,2)]),n("button",{type:"button",class:"remote-btn",title:"Mute",onClick:Ue},[n("i",{class:V(P.value?"fas fa-volume-mute":"fas fa-volume-up")},null,2)]),n("button",{type:"button",class:"remote-btn",title:"Fullscreen",onClick:De},[...t[6]||(t[6]=[n("i",{class:"fas fa-expand"},null,-1)])]),n("button",{type:"button",class:"remote-btn",title:"Go to Guide",onClick:Ne},[...t[7]||(t[7]=[n("i",{class:"fas fa-list"},null,-1)])]),n("button",{type:"button",class:"remote-btn",title:"Channel Up",onClick:Pe},[...t[8]||(t[8]=[n("i",{class:"fas fa-chevron-up"},null,-1)])]),n("button",{type:"button",class:"remote-btn",title:"Channel Down",onClick:Ee},[...t[9]||(t[9]=[n("i",{class:"fas fa-chevron-down"},null,-1)])])]),n("div",Xe,[n("img",{src:j.value,alt:""},null,8,Ye),n("div",Ze,[n("div",Ie,c(K.value),1),n("div",et,c(B.value),1)]),n("div",tt,[t[10]||(t[10]=n("div",{class:"np-label"},"Up Next",-1)),n("div",nt,c(z.value),1)]),n("div",lt,[n("div",{class:"ltv-progress",style:S({width:H.value+"%"})},null,4)])])]),n("aside",st,[n("img",{src:j.value,alt:"",class:"rd-thumb"},null,8,at),n("div",ot,[t[11]||(t[11]=n("div",{class:"rd-label"},"Playing Now",-1)),n("div",it,c(K.value),1),n("div",rt,[n("span",null,c(B.value),1)])]),n("div",ct,[t[12]||(t[12]=n("div",{class:"rd-label"},"Up Next",-1)),n("div",ut,c(z.value),1)])])])]),n("div",dt,[L.value?(v(),h(x,{key:0},U(4,l=>n("div",{key:"skeleton-"+l,class:"channel-button",style:{"pointer-events":"none"}},[...t[13]||(t[13]=[n("div",{class:"skeleton",style:{height:"20px",width:"70%","margin-bottom":"8px"}},null,-1),n("div",{class:"skeleton",style:{height:"14px",width:"50%"}},null,-1)])])),64)):d.value.length===0?(v(),h("div",vt,[n("p",ht,c(F.value?"Couldn't load channels":"No channels available"),1),F.value?(v(),h("p",ft,"Check your connection and try again.")):Y("",!0),n("button",{type:"button",class:"channel-selector-retry",onClick:re},[...t[14]||(t[14]=[n("i",{class:"fas fa-sync-alt"},null,-1),X(" Retry ",-1)])])])):(v(!0),h(x,{key:2},U(d.value,(l,s)=>(v(),h("button",{key:l.id,type:"button",class:V(["channel-button",{active:m.value===s}]),onClick:a=>N(s),onMouseenter:a=>$e(a,s),onMouseleave:oe},[n("div",pt,c(ge.value[s]||l.name),1),n("div",yt,c(Ve(s)),1)],42,mt))),128))]),g.value.visible?(v(),h("div",{key:0,class:"live-tv-channel-preview visible",style:S({left:g.value.x+"px",top:g.value.y+"px"}),"aria-hidden":"true"},[n("img",{src:g.value.thumb,alt:""},null,8,gt),n("div",bt,c(g.value.title),1),n("div",wt,c(g.value.meta),1)],4)):Y("",!0),n("div",{ref_key:"guideRef",ref:$,class:"live-tv-container","aria-label":"TV Guide"},[n("aside",{class:V(["live-tv-sidebar",{open:G.value}]),"aria-label":"Channels"},[n("ul",_t,[(v(!0),h(x,null,U(d.value,(l,s)=>(v(),h("li",{key:l.id,class:"channel-item",role:"option","aria-selected":String(m.value===s),tabindex:"0",onClick:a=>N(s),onKeydown:me(a=>N(s),["enter"])},[n("span",{class:"channel-pill",style:S({background:ee[s%4]})},null,4),n("span",Ct,c(l.name),1)],40,kt))),128))])],2),n("section",Tt,[n("div",Mt,[n("button",{class:"channels-btn",type:"button",onClick:t[2]||(t[2]=l=>G.value=!0)},[...t[15]||(t[15]=[n("i",{class:"fas fa-list"},null,-1),X(" Channels ",-1)])])]),n("div",St,[n("video",{ref_key:"guideVideoEl",ref:I,playsinline:"","webkit-playsinline":"",controls:"",preload:"metadata"},null,512),n("div",xt,[n("div",Ut,c(J.value),1),n("div",Dt,c(q.value),1)]),n("div",{class:"player-actions"},[n("button",{class:"btn btn-primary",onClick:Q},"Watch"),n("button",{class:"btn",onClick:Le},"Watch later")])]),n("div",Pt,[t[17]||(t[17]=Oe('<div class="guide-header" data-v-97ed6d85><div data-v-97ed6d85>Guide</div><div class="kbd-hint" aria-hidden="true" data-v-97ed6d85><span data-v-97ed6d85>Navigate</span><span class="kbd" data-v-97ed6d85>↑</span><span class="kbd" data-v-97ed6d85>↓</span><span class="kbd" data-v-97ed6d85>←</span><span class="kbd" data-v-97ed6d85>→</span><span data-v-97ed6d85>Open</span><span class="kbd" data-v-97ed6d85>Enter</span></div></div>',1)),n("div",Et,[(v(!0),h(x,null,U(we.value,l=>(v(),h("div",{key:l,class:"time-marker",style:S({minWidth:30*pe+"px"})},c(l),5))),128))]),n("div",Nt,[n("div",Vt,[t[16]||(t[16]=n("div",{class:"now-line",style:{left:"150px"}},null,-1)),(v(!0),h(x,null,U(d.value,(l,s)=>(v(),h("div",{key:l.id,class:"guide-row",role:"row"},[n("div",$t,[n("span",{class:"guide-channel-icon",style:S({background:ee[s%4]})},null,4),n("span",null,c(l.name),1)]),n("div",Lt,[(v(!0),h(x,null,U(E.value[s]||[],(a,i)=>(v(),h("div",{key:s+"-"+i,class:V(["program",{selected:b.value.row===s&&b.value.col===i}]),style:S({width:a.widthPx+"px"}),"data-row":s,"data-col":i,tabindex:"0",role:"gridcell","aria-label":a.title+" • "+a.durMin+" min",onClick:f=>M(s,i),onKeydown:me(f=>{M(s,i),Q()},["enter"])},[n("img",{class:"program-thumb",src:a.thumbnail,alt:a.title,loading:"lazy"},null,8,Gt),n("div",Rt,c(a.title),1),n("div",Ot,c(a.timeLabel)+" • "+c(a.category),1)],46,Ft))),128))])]))),128))])])])]),G.value?(v(),h("div",{key:0,class:"ltv-overlay",onClick:t[3]||(t[3]=l=>G.value=!1)})):Y("",!0)],512)]))}},Bt=Fe(Wt,[["__scopeId","data-v-97ed6d85"]]);export{Bt as default};
