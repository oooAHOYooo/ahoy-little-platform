import{_ as Ke,o as We,b as He,c as h,d as f,e as s,f as I,t as c,n as N,C as D,F as E,r as S,i as ee,G as Oe,E as ze,a as qe,M as Qe,m as d,q as O,L as Xe,g as we}from"./index-DOyqqBR8.js";const Je={class:"tv-container"},Ye={class:"video-spotlight"},Ze={class:"spotlight-grid"},je={class:"spotlight-left"},Ie={class:"panelstream-player hero-player"},et={class:"video-header"},tt={class:"channel-name-label","aria-live":"polite"},nt={class:"channel-remote remote-below","aria-label":"Channel Controls"},lt={class:"playing-now glass"},st=["src"],at={class:"now-col"},ot={class:"np-title"},it={class:"np-sub"},rt={class:"next-col"},ut={class:"np-next"},ct={class:"ltv-progress-wrap"},dt={class:"right-dashboard glass hidden-mobile","aria-label":"Channel Dashboard"},vt=["src"],ht={class:"rd-now"},ft={class:"rd-title"},mt={class:"rd-meta"},pt={class:"rd-next"},gt={class:"rd-title"},bt={id:"channel-selector"},yt={key:1,class:"channel-selector-empty"},wt={class:"channel-selector-empty-text"},_t={key:0,class:"channel-selector-empty-hint"},Tt=["onClick","onMouseenter"],kt={class:"channel-button-name"},Ct={class:"channel-button-next"},Mt=["src"],xt={class:"live-tv-channel-preview-title"},Ut={class:"live-tv-channel-preview-meta"},Dt={class:"channel-list",role:"listbox","aria-label":"Live TV Channels"},Et=["aria-selected","onClick","onKeydown"],St={class:"channel-name"},Lt={class:"live-tv-main"},Vt={class:"mobile-only",style:{padding:"8px 10px"}},Pt={class:"guide"},Nt={class:"guide-timebar"},$t={class:"guide-scroller"},Rt={class:"guide-rows",role:"grid","aria-label":"Channel Guide"},Ft={class:"guide-channel-label"},At={class:"guide-track"},Gt=["data-row","data-col","aria-label","onClick","onKeydown"],Bt=["src","alt"],Kt={class:"program-title"},Wt={class:"program-meta"},z="/static/img/default-cover.jpg",_e=6,te=180,Ht=2,Ot={__name:"LiveTVView",setup(zt){const g=d(null),$=d(null),u=d([]),m=d(0),R=d(!0),F=d(!1),L=d(!1),V=d(!0),q=d("Live"),Q=d("—"),X=d(z),J=d("—"),Y=d(0),A=d(!1),b=d({}),P=d({row:0,col:0}),y=d({visible:!1,x:0,y:0,thumb:"",title:"",meta:""});let k=null;const G=d([]);let B="",C=null;const ne=["#7c66ff","#ff6b6b","#22c55e","#f59e0b"],Te=[{key:"misc",titles:["misc","clips","clip"],label:"Channel 01 — Misc"},{key:"films",titles:["films","film","movies","movie","short films","short film"],label:"Channel 02 — Short Films"},{key:"music-videos",titles:["music videos","music_video","music"],label:"Channel 03 — Music Videos"},{key:"live-shows",titles:["live shows","broadcast","shows","live"],label:"Channel 04 — Live Shows"}],ke=O(()=>u.value.map((e,t)=>{const l=Te[t];return(l==null?void 0:l.label)||`Channel ${String(t+1).padStart(2,"0")} — ${e.name}`})),le=O(()=>{const e=m.value,t=u.value[e];return`Channel ${String(e+1).padStart(2,"0")} — ${(t==null?void 0:t.name)||"Live TV"}`}),Ce=O(()=>{const e=[],t=new Date;for(let l=0;l<=te;l+=30){const n=new Date(t.getTime()+l*6e4);e.push(n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}))}return e}),se=O(()=>{b.value;const e={},t=new Date;return u.value.forEach((l,n)=>{const a=[];let o=new Date(t),v=0;const r=l.items||[];if(!r.length){e[n]=a;return}for(;ae(t,o)<te;){const i=r[v%r.length],p=(i==null?void 0:i.video_url)||(i==null?void 0:i.mp4_link)||(i==null?void 0:i.trailer_url)||"",w=Math.max(5,Math.round(((i==null?void 0:i.duration_seconds)||300)/60)),T=new Date(o.getTime()+w*6e4);a.push({title:(i==null?void 0:i.title)||"Untitled",thumbnail:ie(i,p),category:(i==null?void 0:i.category)||l.name||"Show",durMin:w,widthPx:w*_e,timeLabel:`${oe(o)} – ${oe(T)}`,startUTC:o.getTime(),endUTC:T.getTime(),src:p,item:i}),o=T,v++}e[n]=a}),e});function ae(e,t){return Math.round((t.getTime()-e.getTime())/6e4)}function oe(e){return e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function M(e){return e&&e.replace(/\[[^\]]*\]/g,"").replace(/\([^)]*\)/g,"").trim()||"Untitled"}function K(e){return(e==null?void 0:e.video_url)||(e==null?void 0:e.mp4_link)||(e==null?void 0:e.trailer_url)||""}function ie(e,t){if(e!=null&&e.thumbnail)return e.thumbnail;const l=t||K(e);return l&&b.value[l]?b.value[l]:z}const W=[];let Z=0;function Me(e){return new Promise((t,l)=>{if(!e||typeof e!="string"){l(new Error("Invalid video URL"));return}const n=document.createElement("video");n.muted=!0,n.playsInline=!0,n.crossOrigin="anonymous",n.preload="metadata";const a=setTimeout(()=>{n.src="",n.load(),l(new Error("Timeout"))},15e3);n.onerror=()=>{clearTimeout(a),l(new Error("Video load failed"))},n.onloadeddata=()=>{const o=Math.min(1,Math.max(0,n.duration?n.duration*.05:1));n.currentTime=o},n.onseeked=()=>{clearTimeout(a);try{const o=document.createElement("canvas"),v=320,r=Math.round(n.videoHeight/n.videoWidth*v)||180;o.width=v,o.height=r;const i=o.getContext("2d");if(!i){t(null);return}i.drawImage(n,0,0,v,r);const p=o.toDataURL("image/jpeg",.85);n.src="",n.load(),t(p)}catch(o){l(o)}},n.src=e,n.load().catch(()=>l(new Error("Load failed")))})}function j(){if(Z>=Ht||W.length===0)return;const e=W.shift();if(b.value[e]){j();return}Z++,Me(e).then(t=>{t&&(b.value={...b.value,[e]:t})}).catch(()=>{}).finally(()=>{Z--,j()})}function xe(e){!e||b.value[e]||W.includes(e)||(W.push(e),j())}function Ue(){const e=[],t=new Date;u.value.forEach((l,n)=>{const a=l.items||[];if(!a.length)return;let o=new Date(t),v=0;for(;ae(t,o)<te;){const r=a[v%a.length],i=Math.max(5,Math.round(((r==null?void 0:r.duration_seconds)||300)/60)),p=new Date(o.getTime()+i*6e4);e.push({startUTC:o.getTime(),endUTC:p.getTime(),row:n,col:v,title:(r==null?void 0:r.title)||"Program",category:(r==null?void 0:r.category)||l.name||"Show",src:K(r),thumb:(r==null?void 0:r.thumbnail)||"",durationSec:i*60}),o=p,v++}}),e.sort((l,n)=>l.startUTC-n.startUTC),G.value=e}function x(e){const t=Date.now();for(const l of G.value)if(!(e!=null&&l.row!==e)&&t>=l.startUTC&&t<l.endUTC)return l;return null}function re(e){const t=Date.now();let l=null;for(const n of G.value)e!=null&&n.row!==e||n.startUTC>t&&(!l||n.startUTC<l.startUTC)&&(l=n);return l}function ue(e){const t=Math.max(0,Date.now()-e.startUTC);return Math.max(0,Math.min(Math.floor(t/1e3),e.durationSec-1))}function De(){const e=g.value;if(!e||!G.value.length)return;const t=x(m.value);if(!t||!t.src)return;const l=t.src!==B,n=ue(t);if(l){B=t.src;try{e.pause()}catch{}e.src=t.src;try{e.load()}catch{}e.currentTime=n,e.muted=!0,V.value=!0,e.play().catch(()=>{});const a=u.value[m.value];Xe({id:`live_tv-${(a==null?void 0:a.id)??m.value}-${t.startUTC}`,type:"live_tv",title:t.title||"Live TV",host:(a==null?void 0:a.name)||le.value,thumbnail:t.thumb,url:t.src})}else if(Math.abs((e.currentTime||0)-n)>3)try{e.currentTime=n}catch{}}function Ee(){const e=x(m.value),t=re(m.value);e&&(q.value=M(e.title),Q.value=e.category||"",X.value=e.thumb||b.value[e.src]||z),J.value=t?M(t.title):"—"}function Se(){const e=x(m.value);if(!e){Y.value=0;return}const t=Date.now();Y.value=Math.max(0,Math.min(100,(t-e.startUTC)/(e.endUTC-e.startUTC)*100))}function H(){De(),Ee(),Se()}function ce(){const e=x(m.value);if(!e)return;const t=g.value;if(!t)return;const l=ue(e);try{Math.abs((t.currentTime||0)-l)>2&&(t.currentTime=l)}catch{}}function Le(){L.value=!1;const e=re(m.value);if(!e)return;const t=()=>{B="",H()},l=Date.now();l<e.startUTC?setTimeout(t,Math.max(0,e.startUTC-l+50)):t()}function Ve(){g.value&&(L.value?g.value.pause():g.value.play().catch(()=>{}))}function Pe(){g.value&&(V.value=!V.value,g.value.muted=V.value)}function Ne(){var t,l,n;const e=g.value||document.documentElement;document.fullscreenElement?(n=document.exitFullscreen)==null||n.call(document):(l=(t=e==null?void 0:e.requestFullscreen)==null?void 0:t.call(e))==null||l.catch(()=>{})}function $e(){const e=u.value.length;if(!e)return;const t=(m.value+1)%e;_(t)}function Re(){const e=u.value.length;if(!e)return;const t=(m.value-1+e)%e;_(t)}function _(e){m.value=e,B="",H()}function Fe(){var e;(e=$.value)==null||e.scrollIntoView({behavior:"smooth",block:"start"})}function Ae(e){var n;const t=x(e);if(t)return M(t.title);const l=u.value[e];return(n=l==null?void 0:l.items)!=null&&n.length?M(l.items[0].title):"—"}function Ge(e,t){de(),k=setTimeout(()=>{var fe,me,pe,ge,be,ye;const l=u.value[t];if(!l)return;const n=x(t),a=(n==null?void 0:n.src)||K((fe=l.items)==null?void 0:fe[0]),o=n?n.thumb||b.value[n.src]||z:ie((me=l.items)==null?void 0:me[0],a),v=M(n?n.title:(ge=(pe=l.items)==null?void 0:pe[0])==null?void 0:ge.title),r=(n==null?void 0:n.category)||((ye=(be=l.items)==null?void 0:be[0])==null?void 0:ye.category)||l.name||"",i=e.target.closest(".channel-button").getBoundingClientRect(),p=280;let w=i.left+i.width/2-p/2,T=i.top-12;w<12&&(w=12),w+p>window.innerWidth-12&&(w=window.innerWidth-p-12),T<12&&(T=i.bottom+12),y.value={visible:!0,x:w,y:T,thumb:o,title:v,meta:r}},1e3)}function de(){k&&(clearTimeout(k),k=null),y.value={...y.value,visible:!1}}function U(e,t){P.value={row:e,col:t}}function ve(e){var o;if(!$.value)return;const t=$.value.getBoundingClientRect();if(t.bottom<0||t.top>window.innerHeight)return;const l=u.value.length;if(!l)return;const{row:n,col:a}=P.value;if(e.key==="ArrowUp")e.preventDefault(),U(Math.max(0,n-1),a);else if(e.key==="ArrowDown")e.preventDefault(),U(Math.min(l-1,n+1),a);else if(e.key==="ArrowRight"){e.preventDefault();const v=(((o=se.value[n])==null?void 0:o.length)||1)-1;U(n,Math.min(v,a+1))}else e.key==="ArrowLeft"?(e.preventDefault(),U(n,Math.max(0,a-1))):e.key==="Enter"&&(e.preventDefault(),_(P.value.row))}function Be(e){var l;const t=(e==null?void 0:e.channels)??((l=e==null?void 0:e.data)==null?void 0:l.channels)??[];return Array.isArray(t)?t.map(n=>({...n,id:(n==null?void 0:n.id)??"misc",name:(n==null?void 0:n.name)??"Channel",items:Array.isArray(n==null?void 0:n.items)?n.items:[]})):[]}async function he(){R.value=!0,F.value=!1,C&&(clearInterval(C),C=null);let e=null;try{e=await ze("/api/live-tv/channels?_="+Date.now())}catch{try{e=await qe("/api/live-tv/channels")}catch{F.value=!0,u.value=[],R.value=!1;return}}u.value=Be(e||{}),u.value.length&&(Ue(),H(),C=setInterval(H,1e3),Qe(()=>{u.value.forEach(t=>{(t.items||[]).forEach(l=>{const n=K(l);n&&!(l!=null&&l.thumbnail)&&xe(n)})})})),R.value=!1}return We(async()=>{document.addEventListener("keydown",ve),await he()}),He(()=>{C&&clearInterval(C),k&&clearTimeout(k),document.removeEventListener("keydown",ve)}),(e,t)=>(h(),f("div",Je,[t[18]||(t[18]=s("section",{class:"podcasts-hero"},[s("div",{class:"podcasts-hero-inner"},[s("h1",null,[s("i",{class:"fas fa-tv","aria-hidden":"true"}),I(" Live TV ")]),s("p",null,"Channel surf and watch live programming.")])],-1)),s("div",Ye,[s("div",Ze,[s("div",je,[s("div",Ie,[s("video",{ref_key:"videoEl",ref:g,controls:"",autoplay:"",muted:"",playsinline:"","webkit-playsinline":"",onPlay:t[0]||(t[0]=l=>L.value=!0),onPause:t[1]||(t[1]=l=>L.value=!1),onEnded:Le,onError:ce,onStalled:ce},null,544),s("div",et,[t[4]||(t[4]=s("span",{class:"now-playing-label"},"Now Playing",-1)),s("span",tt,c(le.value),1)]),t[5]||(t[5]=s("div",{class:"hero-glass"},null,-1))]),s("div",nt,[s("button",{type:"button",class:"remote-btn",title:"Play/Pause",onClick:Ve},[s("i",{class:N(L.value?"fas fa-pause":"fas fa-play")},null,2)]),s("button",{type:"button",class:"remote-btn",title:"Mute",onClick:Pe},[s("i",{class:N(V.value?"fas fa-volume-mute":"fas fa-volume-up")},null,2)]),s("button",{type:"button",class:"remote-btn",title:"Fullscreen",onClick:Ne},[...t[6]||(t[6]=[s("i",{class:"fas fa-expand"},null,-1)])]),s("button",{type:"button",class:"remote-btn",title:"Go to Guide",onClick:Fe},[...t[7]||(t[7]=[s("i",{class:"fas fa-list"},null,-1)])]),s("button",{type:"button",class:"remote-btn",title:"Channel Up",onClick:$e},[...t[8]||(t[8]=[s("i",{class:"fas fa-chevron-up"},null,-1)])]),s("button",{type:"button",class:"remote-btn",title:"Channel Down",onClick:Re},[...t[9]||(t[9]=[s("i",{class:"fas fa-chevron-down"},null,-1)])])]),s("div",lt,[s("img",{src:X.value,alt:""},null,8,st),s("div",at,[s("div",ot,c(q.value),1),s("div",it,c(Q.value),1)]),s("div",rt,[t[10]||(t[10]=s("div",{class:"np-label"},"Up Next",-1)),s("div",ut,c(J.value),1)]),s("div",ct,[s("div",{class:"ltv-progress",style:D({width:Y.value+"%"})},null,4)])])]),s("aside",dt,[s("img",{src:X.value,alt:"",class:"rd-thumb"},null,8,vt),s("div",ht,[t[11]||(t[11]=s("div",{class:"rd-label"},"Playing Now",-1)),s("div",ft,c(q.value),1),s("div",mt,[s("span",null,c(Q.value),1)])]),s("div",pt,[t[12]||(t[12]=s("div",{class:"rd-label"},"Up Next",-1)),s("div",gt,c(J.value),1)])])])]),s("div",bt,[R.value?(h(),f(E,{key:0},S(4,l=>s("div",{key:"skeleton-"+l,class:"channel-button",style:{"pointer-events":"none"}},[...t[13]||(t[13]=[s("div",{class:"skeleton",style:{height:"20px",width:"70%","margin-bottom":"8px"}},null,-1),s("div",{class:"skeleton",style:{height:"14px",width:"50%"}},null,-1)])])),64)):u.value.length===0?(h(),f("div",yt,[s("p",wt,c(F.value?"Couldn't load channels":"No channels available"),1),F.value?(h(),f("p",_t,"Check your connection and try again.")):ee("",!0),s("button",{type:"button",class:"channel-selector-retry",onClick:he},[...t[14]||(t[14]=[s("i",{class:"fas fa-sync-alt"},null,-1),I(" Retry ",-1)])])])):(h(!0),f(E,{key:2},S(u.value,(l,n)=>(h(),f("button",{key:l.id,type:"button",class:N(["channel-button",{active:m.value===n}]),onClick:a=>_(n),onMouseenter:a=>Ge(a,n),onMouseleave:de},[s("div",kt,c(ke.value[n]||l.name),1),s("div",Ct,c(Ae(n)),1)],42,Tt))),128))]),y.value.visible?(h(),f("div",{key:0,class:"live-tv-channel-preview visible",style:D({left:y.value.x+"px",top:y.value.y+"px"}),"aria-hidden":"true"},[s("img",{src:y.value.thumb,alt:""},null,8,Mt),s("div",xt,c(y.value.title),1),s("div",Ut,c(y.value.meta),1)],4)):ee("",!0),s("div",{ref_key:"guideRef",ref:$,class:"live-tv-container","aria-label":"TV Guide"},[s("aside",{class:N(["live-tv-sidebar",{open:A.value}]),"aria-label":"Channels"},[s("ul",Dt,[(h(!0),f(E,null,S(u.value,(l,n)=>(h(),f("li",{key:l.id,class:"channel-item",role:"option","aria-selected":String(m.value===n),tabindex:"0",onClick:a=>_(n),onKeydown:we(a=>_(n),["enter"])},[s("span",{class:"channel-pill",style:D({background:ne[n%4]})},null,4),s("span",St,c(l.name),1)],40,Et))),128))])],2),s("section",Lt,[s("div",Vt,[s("button",{class:"channels-btn",type:"button",onClick:t[2]||(t[2]=l=>A.value=!0)},[...t[15]||(t[15]=[s("i",{class:"fas fa-list"},null,-1),I(" Channels ",-1)])])]),s("div",Pt,[t[17]||(t[17]=Oe('<div class="guide-header" data-v-8128f3d7><div data-v-8128f3d7>Guide</div><div class="kbd-hint" aria-hidden="true" data-v-8128f3d7><span data-v-8128f3d7>Navigate</span><span class="kbd" data-v-8128f3d7>↑</span><span class="kbd" data-v-8128f3d7>↓</span><span class="kbd" data-v-8128f3d7>←</span><span class="kbd" data-v-8128f3d7>→</span><span data-v-8128f3d7>Tune to channel</span><span class="kbd" data-v-8128f3d7>Enter</span></div></div>',1)),s("div",Nt,[(h(!0),f(E,null,S(Ce.value,l=>(h(),f("div",{key:l,class:"time-marker",style:D({minWidth:30*_e+"px"})},c(l),5))),128))]),s("div",$t,[s("div",Rt,[t[16]||(t[16]=s("div",{class:"now-line",style:{left:"150px"}},null,-1)),(h(!0),f(E,null,S(u.value,(l,n)=>(h(),f("div",{key:l.id,class:"guide-row",role:"row"},[s("div",Ft,[s("span",{class:"guide-channel-icon",style:D({background:ne[n%4]})},null,4),s("span",null,c(l.name),1)]),s("div",At,[(h(!0),f(E,null,S(se.value[n]||[],(a,o)=>(h(),f("div",{key:n+"-"+o,class:N(["program",{selected:P.value.row===n&&P.value.col===o}]),style:D({width:a.widthPx+"px"}),"data-row":n,"data-col":o,tabindex:"0",role:"gridcell","aria-label":a.title+" • "+a.durMin+" min",onClick:v=>{U(n,o),_(n)},onKeydown:we(v=>{U(n,o),_(n)},["enter"])},[s("img",{class:"program-thumb",src:a.thumbnail,alt:a.title,loading:"lazy"},null,8,Bt),s("div",Kt,c(a.title),1),s("div",Wt,c(a.timeLabel)+" • "+c(a.category),1)],46,Gt))),128))])]))),128))])])])]),A.value?(h(),f("div",{key:0,class:"ltv-overlay",onClick:t[3]||(t[3]=l=>A.value=!1)})):ee("",!0)],512)]))}},Qt=Ke(Ot,[["__scopeId","data-v-8128f3d7"]]);export{Qt as default};
