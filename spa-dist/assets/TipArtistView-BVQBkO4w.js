import{_ as D,o as $,E as h,c as i,d as o,e as t,k as y,w as g,C as I,F as w,f as b,t as l,l as k,v as A,O as M,B as O,m as c,A as x,s as U}from"./index-J1hCH1Lh.js";const L={class:"tip-artist-page"},R={class:"tip-content"},j={class:"tip-grid"},z={class:"tip-card tip-form-card"},J={class:"tip-field"},P=["value"],Y={key:0,class:"tip-artist-preview"},q=["src"],G={key:1,class:"tip-artist-placeholder"},H={class:"tip-artist-desc"},K={class:"tip-field"},Q={class:"tip-amount-btns"},W=["onClick"],X={class:"tip-field"},Z=["disabled"],tt={key:0,class:"fas fa-spinner fa-spin"},st={key:1,class:"fas fa-heart"},et={class:"tip-card tip-history-card"},at={key:0,class:"tip-empty"},it={key:1,class:"tip-list"},ot={class:"tip-item-main"},nt={class:"tip-item-date"},lt={key:0,class:"tip-item-note"},rt={class:"tip-item-amount"},ut={key:2,class:"tip-total"},dt={__name:"TipArtistView",setup(ct){const S=O(),T=M(),_=c([]),r=c(""),v=x(()=>r.value&&_.value.find(a=>a.name===r.value)||null),n=c(10),m=c(""),f=c(!1),p=c([]),B=x(()=>p.value.reduce((a,s)=>a+(s.amount||0),0));$(async()=>{if(!T.isLoggedIn.value){S.push("/login");return}await V(),await C()});function E(){}async function V(){try{const s=(await h("/api/artists")).artists||[];try{const d=await h("/api/music"),e=new Set(s.map(u=>u.name));(d.tracks||[]).forEach(u=>{u.artist&&!e.has(u.artist)&&(s.push({name:u.artist,id:`artist_${u.artist}`,description:"Indie artist"}),e.add(u.artist))})}catch{}s.sort((d,e)=>(d.name||"").localeCompare(e.name||"")),_.value=s}catch(a){console.error(a)}}async function C(){try{const a=await h("/api/tips");p.value=a.tips||[]}catch(a){console.error(a)}}async function F(){if(!(!r.value||!n.value||n.value<1)){f.value=!0;try{await h("/api/tips",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({artist_name:r.value,amount:Math.round(Number(n.value)*100),note:(m.value||"").slice(0,500)})}),r.value="",n.value=10,m.value="",await C(),window.dispatchEvent(new CustomEvent("ahoy:toast",{detail:{message:"Boost sent!",type:"success"}}))}catch(a){const s=a.message||"Failed to send boost";window.dispatchEvent(new CustomEvent("ahoy:toast",{detail:{message:s,type:"error"}}))}finally{f.value=!1}}}function N(a){return a?new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}return(a,s)=>{var d;return i(),o("div",L,[s[13]||(s[13]=t("section",{class:"podcasts-hero tip-hero"},[t("div",{class:"podcasts-hero-inner"},[t("h1",null,[t("i",{class:"fas fa-heart"}),y(" Boost Artists")]),t("p",null,"Support the indie artists you love")])],-1)),t("div",R,[t("div",j,[t("div",z,[s[9]||(s[9]=t("h2",null,[t("i",{class:"fas fa-user-music"}),y(" Select Artist")],-1)),t("div",J,[s[5]||(s[5]=t("label",null,"Choose an Artist",-1)),g(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>r.value=e),onChange:E,class:"tip-select"},[s[4]||(s[4]=t("option",{value:""},"-- Select an artist --",-1)),(i(!0),o(w,null,b(_.value,e=>(i(),o("option",{key:e.id||e.name,value:e.name},l(e.name),9,P))),128))],544),[[I,r.value]])]),v.value?(i(),o("div",Y,[(d=v.value)!=null&&d.image?(i(),o("img",{key:0,src:v.value.image,alt:"",class:"tip-artist-img",onError:s[1]||(s[1]=e=>e.target.style.display="none")},null,40,q)):(i(),o("div",G,[...s[6]||(s[6]=[t("i",{class:"fas fa-user-music"},null,-1)])])),t("div",null,[t("h3",null,l(r.value),1),t("p",H,l(v.value.description||"Indie artist"),1)])])):k("",!0),t("div",K,[s[7]||(s[7]=t("label",null,"Amount (USD)",-1)),t("div",Q,[(i(),o(w,null,b([5,10,25,50],e=>t("button",{key:e,type:"button",class:U(["tip-amount-btn",{active:n.value===e}]),onClick:u=>n.value=e},"$"+l(e),11,W)),64))]),g(t("input",{"onUpdate:modelValue":s[2]||(s[2]=e=>n.value=e),type:"number",min:"1",step:"1",class:"tip-input",placeholder:"Or enter custom amount"},null,512),[[A,n.value,void 0,{number:!0}]])]),t("div",X,[s[8]||(s[8]=t("label",null,"Optional Message",-1)),g(t("textarea",{"onUpdate:modelValue":s[3]||(s[3]=e=>m.value=e),class:"tip-textarea",placeholder:"Leave a message for the artist...",rows:"3"},null,512),[[A,m.value]])]),t("button",{type:"button",class:"tip-submit",disabled:!r.value||!n.value||n.value<1||f.value,onClick:F},[f.value?(i(),o("i",tt)):(i(),o("i",st)),y(" Boost $"+l((n.value||0).toFixed(0)),1)],8,Z)]),t("div",et,[s[12]||(s[12]=t("h2",null,[t("i",{class:"fas fa-history"}),y(" Your Boosts")],-1)),p.value.length===0?(i(),o("div",at,[...s[10]||(s[10]=[t("i",{class:"fas fa-inbox"},null,-1),t("p",null,"No boosts yet. Start supporting artists!",-1)])])):(i(),o("div",it,[(i(!0),o(w,null,b(p.value,e=>(i(),o("div",{key:e.id,class:"tip-item"},[t("div",ot,[t("h4",null,l(e.artist_name),1),t("p",nt,l(N(e.created_at)),1),e.note?(i(),o("p",lt,'"'+l(e.note)+'"',1)):k("",!0)]),t("div",rt,"$"+l((e.amount/100).toFixed(2)),1)]))),128))])),p.value.length>0?(i(),o("div",ut,[s[11]||(s[11]=t("span",null,"Total Boosts:",-1)),t("span",null,"$"+l((B.value/100).toFixed(2)),1)])):k("",!0)])])])])}}},vt=D(dt,[["__scopeId","data-v-965a8038"]]);export{vt as default};
