import{_ as S,o as F,b as s,c as n,d as t,h as d,g as _,w as b,B as V,F as L,t as o,p as h,e as I,i as B,N as M,E as g,r as U,j as c}from"./index-DKIbx5E3.js";const R={class:"wallet-page"},W={class:"wallet-content"},$={class:"wallet-actions"},E={key:0,class:"wallet-guest"},P={class:"wallet-balance-card"},j={class:"wallet-balance-amount"},z={class:"wallet-card"},H={class:"wallet-card-header"},q=["disabled"],G={class:"wallet-card-body"},J={key:0,class:"wallet-state"},K={key:1,class:"wallet-state wallet-error"},O={key:2,class:"wallet-state"},Q={key:3,class:"wallet-table-wrap"},X={class:"wallet-table"},Y={class:"wallet-time"},Z={class:"num"},x={key:4,class:"wallet-load-more"},tt=["disabled"],at={key:0,class:"fas fa-spinner fa-spin"},k=50,et={__name:"WalletView",setup(lt){const p=M(),C=c(0),i=c([]),r=c(!0),u=c(!1),f=c(null),v=c(0);async function y(){if(p.isLoggedIn.value){r.value=!0,f.value=null;try{const[e,a]=await Promise.all([g("/payments/wallet"),g(`/payments/wallet/transactions?limit=${k}`)]);C.value=e.balance??0,i.value=a.transactions??[],v.value=i.value.length}catch(e){f.value="Failed to load transactions. Please try again.",console.error(e)}finally{r.value=!1}}}async function D(){if(!(u.value||i.value.length<v.value)){u.value=!0;try{const a=(await g(`/payments/wallet/transactions?limit=${k}&offset=${v.value}`)).transactions||[];a.length&&(i.value=[...i.value,...a],v.value=i.value.length)}catch(e){console.error(e)}finally{u.value=!1}}}F(()=>{p.isLoggedIn.value&&y()});function m(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e??0)}function T(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"—"}function A(e){return e?new Date(e).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):""}function N(e){return e?e.charAt(0).toUpperCase()+e.slice(1):"—"}return(e,a)=>{const w=U("router-link");return s(),n("div",R,[a[11]||(a[11]=t("section",{class:"podcasts-hero wallet-hero"},[t("div",{class:"podcasts-hero-inner"},[t("h1",null,[t("i",{class:"fas fa-wallet"}),d(" Wallet")]),t("p",null,"Balance and transaction history")])],-1)),t("div",W,[t("div",$,[_(w,{to:"/account",class:"wallet-back"},{default:b(()=>[...a[0]||(a[0]=[t("i",{class:"fas fa-arrow-left"},null,-1),d(" Back to Account ",-1)])]),_:1})]),V(p).isLoggedIn.value?(s(),n(L,{key:1},[t("div",P,[a[3]||(a[3]=t("span",{class:"wallet-balance-label"},"Current Balance",-1)),t("span",j,o(m(C.value)),1)]),t("div",z,[t("div",H,[a[4]||(a[4]=t("h2",null,"Transaction History",-1)),t("button",{type:"button",class:"wallet-refresh",disabled:r.value,onClick:y,title:"Refresh"},[t("i",{class:h(["fas fa-sync-alt",{"fa-spin":r.value}])},null,2)],8,q)]),t("div",G,[r.value?(s(),n("div",J,[...a[5]||(a[5]=[t("i",{class:"fas fa-spinner fa-spin"},null,-1),t("p",null,"Loading transactions...",-1)])])):f.value?(s(),n("div",K,[a[6]||(a[6]=t("i",{class:"fas fa-exclamation-triangle"},null,-1)),t("p",null,o(f.value),1),t("button",{type:"button",class:"wallet-btn primary",onClick:y},"Try Again")])):i.value.length===0?(s(),n("div",O,[a[8]||(a[8]=t("i",{class:"fas fa-wallet"},null,-1)),a[9]||(a[9]=t("p",null,"No transactions yet",-1)),_(w,{to:"/account",class:"wallet-btn primary"},{default:b(()=>[...a[7]||(a[7]=[d("Add Funds",-1)])]),_:1})])):(s(),n("div",Q,[t("table",X,[a[10]||(a[10]=t("thead",null,[t("tr",null,[t("th",null,"Date & Time"),t("th",null,"Type"),t("th",null,"Description"),t("th",{class:"num"},"Amount"),t("th",{class:"num"},"Balance After")])],-1)),t("tbody",null,[(s(!0),n(L,null,I(i.value,l=>(s(),n("tr",{key:l.id},[t("td",null,[t("div",null,o(T(l.created_at)),1),t("div",Y,o(A(l.created_at)),1)]),t("td",null,[t("span",{class:h(["wallet-type",l.type])},o(N(l.type)),3)]),t("td",null,o(l.description||"—"),1),t("td",{class:h(["num",l.type==="fund"?"positive":l.type==="spend"?"negative":"neutral"])},o(l.type==="fund"?"+":"-")+o(m(Math.abs(l.amount))),3),t("td",Z,o(m(l.balance_after)),1)]))),128))])])])),i.value.length>=k&&!r.value?(s(),n("div",x,[t("button",{type:"button",class:"wallet-btn secondary",disabled:u.value,onClick:D},[u.value?(s(),n("i",at)):B("",!0),d(" "+o(u.value?"Loading...":"Load More"),1)],8,tt)])):B("",!0)])])],64)):(s(),n("div",E,[a[2]||(a[2]=t("p",null,"Sign in to view your wallet.",-1)),_(w,{to:"/login",class:"wallet-btn primary"},{default:b(()=>[...a[1]||(a[1]=[d("Sign in",-1)])]),_:1})]))])])}}},nt=S(et,[["__scopeId","data-v-540217bb"]]);export{nt as default};
