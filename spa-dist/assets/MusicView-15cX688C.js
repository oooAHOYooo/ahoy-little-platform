import{a as D,b as F}from"./useApi-BCqoWMHl.js";import{_ as L,a as c,c as u,b as e,k as w,n as _,t as p,l as z,m as h,g as d,u as E,o as N,j as O,w as S,F as M,r as R,h as V,i as T,e as A}from"./index-BdyQCXb8.js";const P=70,Y=120,H={__name:"PullRefresh",emits:["refresh"],setup(b,{emit:l}){const o=l,m=d(null),r=d(!1),a=d(!1),n=d(0),s=d(0),y=h(()=>a.value?P*.6:Math.min(s.value*.5,Y*.5)),t=h(()=>a.value?0:Math.min(s.value*.4,Y*.4)-40),k=h(()=>a.value?1:Math.min(s.value/P,1)),i=h(()=>s.value>=P);function f(){return window.scrollY<=0}function x(v){!f()||a.value||(n.value=v.touches[0].clientY,r.value=!0)}function C(v){if(!r.value||a.value)return;const g=v.touches[0].clientY-n.value;g>0?s.value=g:(r.value=!1,s.value=0)}function $(){r.value&&(i.value?(a.value=!0,s.value=0,o("refresh",B)):s.value=0,r.value=!1)}function B(){a.value=!1,s.value=0}return(v,g)=>(c(),u("div",{class:"pull-refresh-wrapper",ref_key:"wrapper",ref:m,onTouchstartPassive:x,onTouchmovePassive:C,onTouchendPassive:$},[e("div",{class:_(["pull-indicator",{active:r.value,refreshing:a.value}]),style:w({transform:`translateY(${t.value}px)`,opacity:k.value})},[e("i",{class:_(a.value?"fas fa-spinner fa-spin":"fas fa-arrow-down"),style:w({transform:i.value?"rotate(180deg)":""})},null,6),e("span",null,p(a.value?"Refreshing...":i.value?"Release to refresh":"Pull to refresh"),1)],6),e("div",{class:"pull-content",style:w({transform:`translateY(${y.value}px)`})},[z(v.$slots,"default",{},void 0)],4)],544))}},I=L(H,[["__scopeId","data-v-d1c2085f"]]),j={class:"music-container"},J={class:"unified-header music-subheader"},Q={class:"header-content"},U={class:"header-count"},X={key:0,class:"music-grid"},q=["onClick"],G=["src","alt"],K={class:"track-overlay"},W={class:"play-btn"},Z={class:"track-title"},ee={class:"track-artist"},se={key:1,class:"music-grid"},ne={__name:"MusicView",setup(b){const l=E(),o=d([]);function m(n){var s;((s=l.currentTrack)==null?void 0:s.id)===o.value[n].id&&l.isPlaying?l.pause():l.setQueue(o.value,n)}async function r(){const n=await D("/api/music").catch(()=>({tracks:[]}));o.value=n.tracks||[]}async function a(n){try{const s=await F("/api/music");o.value=s.tracks||[],localStorage.setItem("ahoy:/api/music",JSON.stringify({data:s,ts:Date.now()}))}catch{}n()}return N(r),(n,s)=>{const y=V("router-link");return c(),O(I,{onRefresh:a},{default:S(()=>[e("div",j,[e("div",J,[e("div",Q,[s[0]||(s[0]=e("h1",null,"Music",-1)),e("span",U,p(o.value.length)+" tracks",1)])]),o.value.length?(c(),u("div",X,[(c(!0),u(M,null,R(o.value,(t,k)=>{var i,f;return c(),u("div",{key:t.id,class:_(["track-card",{playing:((i=T(l).currentTrack)==null?void 0:i.id)===t.id}])},[e("div",{class:"track-cover",onClick:x=>m(k)},[e("img",{src:t.cover_art,alt:t.title,loading:"lazy"},null,8,G),e("div",K,[e("button",W,[e("i",{class:_(((f=T(l).currentTrack)==null?void 0:f.id)===t.id&&T(l).isPlaying?"fas fa-pause":"fas fa-play")},null,2)])])],8,q),A(y,{to:`/music/${t.id}`,class:"track-info",style:{"text-decoration":"none",color:"inherit"}},{default:S(()=>[e("div",Z,p(t.title),1),e("div",ee,p(t.artist),1)]),_:2},1032,["to"])],2)}),128))])):(c(),u("div",se,[(c(),u(M,null,R(8,t=>e("div",{class:"track-card",key:t},[...s[1]||(s[1]=[e("div",{class:"track-cover skeleton"},null,-1),e("div",{class:"track-info"},[e("div",{class:"skeleton",style:{height:"14px",width:"60%","margin-bottom":"6px"}}),e("div",{class:"skeleton",style:{height:"12px",width:"40%"}})],-1)])])),64))]))])]),_:1})}}};export{ne as default};
