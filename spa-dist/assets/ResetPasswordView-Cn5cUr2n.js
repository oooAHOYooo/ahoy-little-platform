import{_ as g,o as h,c as p,d as w,e as s,h as x,f as v,l as m,R as f,T as R,n as V,t as q,i as T,j as C,k as N,H as M,m as o,q as P,p as S}from"./index-B9CI7FIP.js";const B={class:"pw-wrap"},j={class:"pw-card"},D={class:"pw-label"},U=["type"],E={class:"pw-label"},O=["type"],z={class:"pw-show"},H=["disabled"],I={key:0},J={key:1},Y={class:"pw-note"},A={__name:"ResetPasswordView",setup(F){const k=M(),i=o(""),a=o(""),r=o(""),u=o(!1),d=o(!1),t=o(""),n=o(!1),y=P(()=>a.value&&a.value.length>=8&&a.value===r.value&&!!i.value);h(()=>{i.value=k.query.token||"",i.value||(t.value="Missing reset token. Please request a new link.",n.value=!0)});async function _(){if(a.value!==r.value){t.value="Passwords do not match.",n.value=!0;return}d.value=!0,t.value="",n.value=!1;try{const e=await fetch(""+"/api/auth/password-reset/confirm",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:i.value,password:a.value})}),c=await e.json().catch(()=>({}));if(!e.ok){n.value=!0,t.value=c.error==="token_expired"?"That link expired. Request a new one?":"Reset failed. Try requesting a new link.";return}t.value="Password reset! Redirecting to sign in...",setTimeout(()=>{window.location.href="/login"},2e3)}catch{n.value=!0,t.value="Reset failed. Try requesting a new link."}finally{d.value=!1}}return(b,e)=>{const c=S("router-link");return p(),w("div",B,[s("div",j,[e[7]||(e[7]=s("h1",{class:"pw-title"},"New password time ðŸ”",-1)),e[8]||(e[8]=s("p",{class:"pw-sub"},"Make it strong-ish. Your future self will high-five you.",-1)),s("form",{class:"pw-form",onSubmit:x(_,["prevent"])},[s("label",D,[e[3]||(e[3]=v(" New password ",-1)),m(s("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>a.value=l),class:"pw-input",type:u.value?"text":"password",autocomplete:"new-password",minlength:"8",required:""},null,8,U),[[f,a.value]])]),s("label",E,[e[4]||(e[4]=v(" Confirm ",-1)),m(s("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>r.value=l),class:"pw-input",type:u.value?"text":"password",autocomplete:"new-password",minlength:"8",required:""},null,8,O),[[f,r.value]])]),s("label",z,[m(s("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>u.value=l),type:"checkbox"},null,512),[[R,u.value]]),e[5]||(e[5]=v(" show password ",-1))]),s("button",{type:"submit",class:"btn btn-primary",disabled:d.value||!y.value},[d.value?(p(),w("span",J,"Resettingâ€¦")):(p(),w("span",I,"Reset password ðŸŽ‰"))],8,H)],32),t.value?(p(),w("div",{key:0,class:V(["pw-msg",{"pw-err":n.value}])},q(t.value),3)):T("",!0),s("div",Y,[C(c,{to:"/login"},{default:N(()=>[...e[6]||(e[6]=[v("Back to sign in",-1)])]),_:1})])])])}}},K=g(A,[["__scopeId","data-v-d8d03356"]]);export{K as default};
