import{_ as Ne,n as $e,m as d,o as Ae,b as Fe,c as v,d as f,e as s,k as ee,g as k,l as te,t as m,s as E,F as S,f as U,G as Be,q as M,y as ze,E as Ge,a as He,M as Oe,A as B,H as Ke,x as ve}from"./index-CvISaDOf.js";const Xe={class:"tv-container"},qe={class:"video-spotlight"},Qe={class:"spotlight-grid"},We={class:"spotlight-left"},Ye={key:0,class:"placeholder-content"},Je={class:"video-header"},Ze={class:"channel-name-label","aria-live":"polite"},je={class:"right-dashboard glass hidden-mobile","aria-label":"Channel Dashboard"},Ie=["src"],et={class:"rd-now"},tt={class:"rd-title"},nt={class:"rd-meta"},st={class:"rd-next"},lt={class:"rd-title"},at={class:"rd-suggested"},ot=["onClick"],it={class:"rd-suggested-name"},rt={ref:"guideRef",class:"live-tv-container guide-flush","aria-label":"TV Guide"},ut={class:"channel-list",role:"listbox","aria-label":"Live TV Channels"},dt=["aria-selected","onClick","onKeydown"],ct={class:"channel-name"},vt={class:"live-tv-main"},ft={class:"mobile-only",style:{padding:"8px 10px"}},mt={class:"guide"},ht={class:"guide-timebar"},gt={class:"guide-rows",role:"grid","aria-label":"Channel Guide"},pt={class:"guide-channel-label"},bt={class:"guide-channel-name"},wt={class:"guide-track"},yt=["onClick","onKeydown","data-row","data-col","aria-label"],Tt={class:"program-title",style:{"font-size":"11px",opacity:"0.9"}},Ct={class:"program-modal"},_t={class:"modal-content"},kt={class:"modal-header"},Mt={class:"modal-title"},Lt={class:"modal-meta"},xt={class:"modal-badge"},Dt={class:"modal-body"},Et={class:"modal-desc"},St={class:"modal-actions"},fe="",ne=6,z=180,Ut=2,Pt={__name:"LiveTVView",setup(Vt){Ke();const P=d(null),b=d(null),g=$e(),c=d([]),h=d(0),G=d(!0),se=d(!1),V=d(!1),R=d(!0);let L=null;const H=d(!1),le=d(0),ae=d(0);function me(e){H.value=!0,le.value=e.pageX-b.value.offsetLeft,ae.value=b.value.scrollLeft,b.value.style.cursor="grabbing"}function he(e){if(!H.value)return;e.preventDefault();const l=(e.pageX-b.value.offsetLeft-le.value)*1.5;b.value.scrollLeft=ae.value-l}function oe(){H.value=!1,b.value&&(b.value.style.cursor="grab")}function x(){R.value=!0,L&&clearTimeout(L),L=setTimeout(()=>{R.value=!1},5e3)}const w=d({}),D=d({row:0,col:0}),O=d(ge());function ge(){const e=new Date,t=1e3*60*30;return new Date(Math.floor(e.getTime()/t)*t)}const pe=B(()=>{const e=Date.now(),t=O.value.getTime();return{left:158+(e-t)/6e4*ne+"px"}}),y=d(null);function ie(e){y.value=e}function K(){y.value=null}function be(e){console.log("Added to saved:",e.title),K()}const X=d([]);let C=null;const p=["#00a2ff","#00ffff","#0066ff","#5b21b6"],we=B(()=>{const e=h.value,t=c.value[e];return`Channel ${String(e+1).padStart(2,"0")} — ${(t==null?void 0:t.name)||"Live TV"}`}),ye=B(()=>{const e=[],t=O.value;for(let l=0;l<=z;l+=30){const n=new Date(t.getTime()+l*6e4);e.push(n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}))}return e}),re=B(()=>{w.value;const e={},t=O.value;return new Date(t.getTime()+z*6e4),c.value.forEach((l,n)=>{const a=[],o=l.items||[];if(!o.length){e[n]=a;return}let u=new Date(t),r=0;for(;ue(t,u)<z;){const i=o[r%o.length],T=(i==null?void 0:i.video_url)||(i==null?void 0:i.mp4_link)||(i==null?void 0:i.trailer_url)||"";let j=Math.max(5,Math.round(((i==null?void 0:i.duration_seconds)||300)/60));const I=new Date(u.getTime()+j*6e4);a.push({title:(i==null?void 0:i.title)||"Untitled",thumbnail:Te(i,T),category:(i==null?void 0:i.category)||l.name||"Show",durMin:j,widthPx:j*ne,timeLabel:`${de(u)} – ${de(I)}`,startUTC:u.getTime(),endUTC:I.getTime(),src:T,item:i}),u=I,r++}e[n]=a}),e});function ue(e,t){return Math.round((t.getTime()-e.getTime())/6e4)}function de(e){return e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function q(e){return e&&e.replace(/\[[^\]]*\]/g,"").replace(/\([^)]*\)/g,"").trim()||"Untitled"}function Q(e){return(e==null?void 0:e.video_url)||(e==null?void 0:e.mp4_link)||(e==null?void 0:e.trailer_url)||""}function Te(e,t){if(e!=null&&e.thumbnail)return e.thumbnail;const l=t||Q(e);return l&&w.value[l]?w.value[l]:fe}const N=[];let W=0;function Ce(e){return new Promise((t,l)=>{if(!e||typeof e!="string"){l(new Error("Invalid video URL"));return}const n=document.createElement("video");n.muted=!0,n.playsInline=!0,n.crossOrigin="anonymous",n.preload="metadata";const a=setTimeout(()=>{n.src="",n.load(),l(new Error("Timeout"))},15e3);n.onerror=()=>{clearTimeout(a),l(new Error("Video load failed"))},n.onloadeddata=()=>{const o=Math.min(1,Math.max(0,n.duration?n.duration*.05:1));n.currentTime=o},n.onseeked=()=>{clearTimeout(a);try{const o=document.createElement("canvas"),u=320,r=Math.round(n.videoHeight/n.videoWidth*u)||180;o.width=u,o.height=r;const i=o.getContext("2d");if(!i){t(null);return}i.drawImage(n,0,0,u,r);const T=o.toDataURL("image/jpeg",.85);n.src="",n.load(),t(T)}catch(o){l(o)}},n.src=e,n.load().catch(()=>l(new Error("Load failed")))})}function Y(){if(W>=Ut||N.length===0)return;const e=N.shift();if(w.value[e]){Y();return}W++,Ce(e).then(t=>{t&&(w.value={...w.value,[e]:t})}).catch(()=>{}).finally(()=>{W--,Y()})}function _e(e){!e||w.value[e]||N.includes(e)||(N.push(e),Y())}function ke(){const e=[],t=new Date;c.value.forEach((l,n)=>{const a=l.items||[];if(!a.length)return;let o=new Date(t),u=0;for(;ue(t,o)<z;){const r=a[u%a.length],i=Math.max(5,Math.round(((r==null?void 0:r.duration_seconds)||300)/60)),T=new Date(o.getTime()+i*6e4);e.push({startUTC:o.getTime(),endUTC:T.getTime(),row:n,col:u,title:(r==null?void 0:r.title)||"Program",category:(r==null?void 0:r.category)||l.name||"Show",src:Q(r),thumb:(r==null?void 0:r.thumbnail)||"",durationSec:i*60}),o=T,u++}}),e.sort((l,n)=>l.startUTC-n.startUTC),X.value=e}function J(e){const t=Date.now();for(const l of X.value)if(!(e!=null&&l.row!==e)&&t>=l.startUTC&&t<l.endUTC)return l;return null}function Me(e){const t=Date.now();let l=null;for(const n of X.value)e!=null&&n.row!==e||n.startUTC>t&&(!l||n.startUTC<l.startUTC)&&(l=n);return l}function Le(){var n;const e=J(h.value);if(!e||!e.src)return;const t=c.value[h.value],l={type:"live_tv",id:`live_tv-${(t==null?void 0:t.id)??h.value}`,title:e.title||"Live TV",host:(t==null?void 0:t.name)||"Live TV",thumbnail:e.thumb,video_url:e.src,duration_seconds:e.durationSec};((n=g.currentTrack)==null?void 0:n.video_url)!==e.src&&g.play(l)}function xe(){const e=J(h.value),t=Me(h.value);e&&(nowTitle.value=q(e.title),nowMeta.value=e.category||"",nowThumb.value=e.thumb||w.value[e.src]||fe),upNextTitle.value=t?q(t.title):"—"}function De(){const e=J(h.value);if(!e){progressPct.value=0;return}const t=Date.now();progressPct.value=Math.max(0,Math.min(100,(t-e.startUTC)/(e.endUTC-e.startUTC)*100))}function Z(){Le(),xe(),De()}function Ee(){var t,l,n;const e=videoEl.value||document.documentElement;document.fullscreenElement?(n=document.exitFullscreen)==null||n.call(document):(l=(t=e==null?void 0:e.requestFullscreen)==null?void 0:t.call(e))==null||l.catch(()=>{})}function Se(){const e=c.value.length;if(!e)return;const t=(h.value+1)%e;_(t)}function Ue(){const e=c.value.length;if(!e)return;const t=(h.value-1+e)%e;_(t)}function _(e){h.value=e,Z()}function Pe(){var e;(e=guideRef.value)==null||e.scrollIntoView({behavior:"smooth",block:"start"})}function $(e,t){D.value={row:e,col:t}}function ce(e){var o;if(!guideRef.value)return;const t=guideRef.value.getBoundingClientRect();if(t.bottom<0||t.top>window.innerHeight)return;const l=c.value.length;if(!l)return;const{row:n,col:a}=D.value;if(e.key==="ArrowUp")e.preventDefault(),$(Math.max(0,n-1),a);else if(e.key==="ArrowDown")e.preventDefault(),$(Math.min(l-1,n+1),a);else if(e.key==="ArrowRight"){e.preventDefault();const u=(((o=re.value[n])==null?void 0:o.length)||1)-1;$(n,Math.min(u,a+1))}else e.key==="ArrowLeft"?(e.preventDefault(),$(n,Math.max(0,a-1))):e.key==="Enter"&&(e.preventDefault(),_(D.value.row))}function Ve(e){var l;const t=(e==null?void 0:e.channels)??((l=e==null?void 0:e.data)==null?void 0:l.channels)??[];return Array.isArray(t)?t.map(n=>({...n,id:(n==null?void 0:n.id)??"misc",name:(n==null?void 0:n.name)??"Channel",items:Array.isArray(n==null?void 0:n.items)?n.items:[]})):[]}async function Re(){G.value=!0,se.value=!1,C&&(clearInterval(C),C=null);let e=null;try{e=await Ge("/api/live-tv/channels?_="+Date.now())}catch{try{e=await He("/api/live-tv/channels")}catch{se.value=!0,c.value=[],G.value=!1;return}}c.value=Ve(e||{}),c.value.forEach((t,l)=>{if(!t.items||t.items.length===0){const n=[],a=["Broadcast","Live Segment","Commercial Break","Station ID"];for(let o=0;o<24;o++)n.push({title:a[o%a.length]+" #"+(o+1),duration_seconds:3600,category:t.name});t.items=n}}),c.value.length&&(ke(),Z(),C=setInterval(Z,1e3),Oe(()=>{c.value.forEach(t=>{(t.items||[]).forEach(l=>{const n=Q(l);n&&!(l!=null&&l.thumbnail)&&_e(n)})})})),G.value=!1}let A=null;function F(){if(P.value){const e=P.value.getBoundingClientRect();g.setHeroBounds({top:e.top+window.scrollY,left:e.left+window.scrollX,width:e.width,height:e.height})}}return Ae(async()=>{document.addEventListener("keydown",ce),window.addEventListener("mousemove",x),window.addEventListener("touchstart",x),x(),await Re(),F(),window.ResizeObserver&&(A=new ResizeObserver(F),A.observe(P.value)),window.addEventListener("resize",F)}),Fe(()=>{C&&clearInterval(C),L&&clearTimeout(L),window.removeEventListener("mousemove",x),window.removeEventListener("touchstart",x),document.removeEventListener("keydown",ce),window.removeEventListener("resize",F),A&&A.disconnect(),g.setHeroBounds(null)}),(e,t)=>{var l;return v(),f("div",Xe,[t[22]||(t[22]=s("section",{class:"podcasts-hero"},[s("div",{class:"podcasts-hero-inner"},[s("h1",null,[s("i",{class:"fas fa-tv","aria-hidden":"true"}),ee(" Live TV ")]),s("p",null,"Channel surf and watch live programming.")])],-1)),s("div",qe,[s("div",Qe,[s("div",We,[s("div",{ref_key:"heroPlaceholder",ref:P,class:"panelstream-player hero-player"},[!k(g).currentTrack||k(g).mode!=="video"?(v(),f("div",Ye,[...t[6]||(t[6]=[s("i",{class:"fas fa-tv fa-3x",style:{opacity:"0.2","margin-bottom":"20px"}},null,-1),s("span",null,"Select a channel to start watching",-1)])])):te("",!0),s("div",Je,[t[7]||(t[7]=s("span",{class:"now-playing-label"},"Now Playing",-1)),s("span",Ze,m(we.value),1)]),t[8]||(t[8]=s("div",{class:"hero-glass"},null,-1))],512),s("div",{class:E(["channel-remote remote-below",{"vibes-hidden":!R.value}]),"aria-label":"Channel Controls"},[s("button",{type:"button",class:"remote-btn",title:"Play/Pause",onClick:t[0]||(t[0]=n=>k(g).togglePlay())},[s("i",{class:E(k(g).isPlaying?"fas fa-pause":"fas fa-play")},null,2)]),s("button",{type:"button",class:"remote-btn",title:"Mute",onClick:t[1]||(t[1]=n=>k(g).toggleMute())},[s("i",{class:E(k(g).isMuted?"fas fa-volume-mute":"fas fa-volume-up")},null,2)]),s("button",{type:"button",class:"remote-btn",title:"Fullscreen",onClick:Ee},[...t[9]||(t[9]=[s("i",{class:"fas fa-expand"},null,-1)])]),s("button",{type:"button",class:"remote-btn",title:"Go to Guide",onClick:Pe},[...t[10]||(t[10]=[s("i",{class:"fas fa-list"},null,-1)])]),s("button",{type:"button",class:"remote-btn",title:"Channel Up",onClick:Se},[...t[11]||(t[11]=[s("i",{class:"fas fa-chevron-up"},null,-1)])]),s("button",{type:"button",class:"remote-btn",title:"Channel Down",onClick:Ue},[...t[12]||(t[12]=[s("i",{class:"fas fa-chevron-down"},null,-1)])]),s("button",{type:"button",class:"remote-btn hide-vibes-btn",title:"Hide Controls",onClick:t[2]||(t[2]=n=>R.value=!1)},[...t[13]||(t[13]=[s("i",{class:"fas fa-eye-slash"},null,-1)])])],2)]),s("aside",je,[s("img",{src:e.nowThumb,alt:"",class:"rd-thumb"},null,8,Ie),s("div",et,[t[14]||(t[14]=s("div",{class:"rd-label"},"Playing Now",-1)),s("div",tt,m(e.nowTitle),1),s("div",nt,[s("span",null,m(e.nowMeta),1)])]),s("div",st,[t[15]||(t[15]=s("div",{class:"rd-label"},"Up Next",-1)),s("div",lt,m(e.upNextTitle),1)]),s("div",at,[t[17]||(t[17]=s("div",{class:"rd-suggested-title"},"Suggested for You",-1)),(v(!0),f(S,null,U(c.value.slice(0,4),(n,a)=>(v(),f("div",{key:n.id,class:"rd-suggested-item",onClick:o=>_(a)},[s("span",{class:"rd-suggested-dot",style:M({background:p[a%4]})},null,4),s("span",it,m(n.name),1),t[16]||(t[16]=s("span",{class:"rd-suggested-meta"},"Live",-1))],8,ot))),128))])])])]),s("div",rt,[s("aside",{class:E(["live-tv-sidebar",{open:V.value}]),"aria-label":"Channels"},[s("ul",ut,[(v(!0),f(S,null,U(c.value,(n,a)=>(v(),f("li",{key:n.id,class:"channel-item",role:"option","aria-selected":String(h.value===a),tabindex:"0",onClick:o=>_(a),onKeydown:ve(o=>_(a),["enter"])},[s("span",{class:"channel-pill",style:M({background:p[a%4]})},null,4),s("span",ct,m(n.name),1)],40,dt))),128))])],2),s("section",vt,[s("div",ft,[s("button",{class:"channels-btn",type:"button",onClick:t[3]||(t[3]=n=>V.value=!0)},[...t[18]||(t[18]=[s("i",{class:"fas fa-list"},null,-1),ee(" Channels ",-1)])])]),s("div",mt,[t[19]||(t[19]=Be('<div class="guide-header" data-v-b64f5ae8><div data-v-b64f5ae8>Guide</div><div class="kbd-hint" aria-hidden="true" data-v-b64f5ae8><span data-v-b64f5ae8>Navigate</span><span class="kbd" data-v-b64f5ae8>↑</span><span class="kbd" data-v-b64f5ae8>↓</span><span class="kbd" data-v-b64f5ae8>←</span><span class="kbd" data-v-b64f5ae8>→</span></div></div>',1)),s("div",ht,[(v(!0),f(S,null,U(ye.value,n=>(v(),f("div",{key:n,class:"time-marker",style:M({minWidth:30*ne+"px"})},m(n),5))),128))]),s("div",{class:"guide-scroller",ref_key:"scrollerRef",ref:b,onMousedown:me,onMousemove:he,onMouseup:oe,onMouseleave:oe},[s("div",gt,[s("div",{class:"now-line",style:M(pe.value)},null,4),(v(!0),f(S,null,U(c.value,(n,a)=>(v(),f("div",{key:n.id,class:"guide-row",role:"row"},[s("div",pt,[s("div",{class:"guide-channel-icon",style:M({background:"linear-gradient(135deg, "+p[a%4]+", "+p[a%4]+"dd)",boxShadow:"0 0 15px "+p[a%4]+"44"})},null,4),s("div",bt,m(n.name),1)]),s("div",wt,[(v(!0),f(S,null,U(re.value[a]||[],(o,u)=>(v(),f("div",{key:a+"-"+u,class:E(["program",{selected:D.value.row===a&&D.value.col===u}]),onClick:r=>ie(o),onKeydown:ve(r=>ie(o),["enter"]),"data-row":a,"data-col":u,tabindex:"0",role:"gridcell","aria-label":o.title+" • "+o.durMin+" min",style:M({width:o.widthPx+"px",background:"linear-gradient(165deg, "+p[a%4]+"cc 0%, "+p[a%4]+"44 100%)",border:"1px solid "+p[a%4]+"66",backdropFilter:"blur(12px)",boxShadow:"0 4px 15px rgba(0,0,0,0.3), inset 0 0 10px "+p[a%4]+"33"})},[s("div",Tt,m(o.title),1)],46,yt))),128))])]))),128))])],544)])]),V.value?(v(),f("div",{key:0,class:"ltv-overlay",onClick:t[4]||(t[4]=n=>V.value=!1)})):te("",!0),y.value?(v(),f("div",{key:1,class:"program-modal-overlay",onClick:ze(K,["self"])},[s("div",Ct,[s("button",{class:"close-btn",onClick:K,"aria-label":"Close"},[...t[20]||(t[20]=[s("i",{class:"fas fa-times"},null,-1)])]),s("div",_t,[s("div",kt,[s("h2",Mt,m(q(y.value.title)),1),s("div",Lt,[s("span",xt,m(y.value.category),1),s("span",null,m(y.value.durMin)+" min",1)])]),s("div",Dt,[s("p",Et,m(((l=y.value.item)==null?void 0:l.description)||"No description available for this program."),1),s("div",St,[s("button",{class:"action-btn primary",onClick:t[5]||(t[5]=n=>be(y.value))},[...t[21]||(t[21]=[s("i",{class:"fas fa-plus"},null,-1),ee(" Add to Saved ",-1)])])])])])])])):te("",!0)],512)])}}},Nt=Ne(Pt,[["__scopeId","data-v-b64f5ae8"]]);export{Nt as default};
