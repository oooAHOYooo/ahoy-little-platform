import{_ as Ne,n as $e,m as d,o as Ae,b as Fe,c as f,d as m,e as s,k as te,g as p,l as B,t as h,s as M,F as P,f as S,G as Be,q as L,y as ze,E as Ge,a as We,M as He,A as z,H as Oe,x as ve}from"./index-DcQ9GdWE.js";const Ke={class:"tv-container"},Xe={key:0,class:"video-spotlight"},qe={class:"spotlight-grid"},Qe={class:"spotlight-left"},Ye={key:0,class:"placeholder-content"},Je={class:"video-header"},Ze={class:"channel-name-label","aria-live":"polite"},je=["title"],Ie={class:"right-dashboard glass hidden-mobile","aria-label":"Channel Dashboard"},et=["src"],tt={class:"rd-now"},nt={class:"rd-title"},st={class:"rd-meta"},lt={class:"rd-next"},at={class:"rd-title"},ot={class:"rd-suggested"},it=["onClick"],rt={class:"rd-suggested-name"},ut={ref:"guideRef",class:"live-tv-container guide-flush","aria-label":"TV Guide"},dt={class:"channel-list",role:"listbox","aria-label":"Live TV Channels"},ct=["aria-selected","onClick","onKeydown"],vt={class:"channel-name"},ft={class:"live-tv-main"},mt={class:"mobile-only",style:{padding:"8px 10px"}},ht={class:"guide"},gt={class:"guide-timebar"},pt={class:"guide-rows",role:"grid","aria-label":"Channel Guide"},bt={class:"guide-channel-label"},wt={class:"guide-channel-name"},yt={class:"guide-track"},Tt=["onClick","onKeydown","data-row","data-col","aria-label"],kt={class:"program-title",style:{"font-size":"11px",opacity:"0.9"}},Ct={class:"program-modal"},_t={class:"modal-content"},Mt={class:"modal-header"},Lt={class:"modal-title"},xt={class:"modal-meta"},Dt={class:"modal-badge"},Et={class:"modal-body"},Pt={class:"modal-desc"},St={class:"modal-actions"},fe="",ne=6,G=180,Ut=2,Vt={__name:"LiveTVView",setup(Rt){Oe();const U=d(null),w=d(null),c=$e(),v=d([]),g=d(0),W=d(!0),se=d(!1),V=d(!1),R=d(!0);let x=null;const H=d(!1),le=d(0),ae=d(0);function me(e){H.value=!0,le.value=e.pageX-w.value.offsetLeft,ae.value=w.value.scrollLeft,w.value.style.cursor="grabbing"}function he(e){if(!H.value)return;e.preventDefault();const l=(e.pageX-w.value.offsetLeft-le.value)*1.5;w.value.scrollLeft=ae.value-l}function oe(){H.value=!1,w.value&&(w.value.style.cursor="grab")}function D(){R.value=!0,x&&clearTimeout(x),x=setTimeout(()=>{R.value=!1},5e3)}const y=d({}),E=d({row:0,col:0}),O=d(ge());function ge(){const e=new Date,t=1e3*60*30;return new Date(Math.floor(e.getTime()/t)*t)}const pe=z(()=>{const e=Date.now(),t=O.value.getTime();return{left:158+(e-t)/6e4*ne+"px"}}),T=d(null);function ie(e){T.value=e}function K(){T.value=null}function be(e){console.log("Added to saved:",e.title),K()}const X=d([]);let C=null;const b=["#00a2ff","#00ffff","#0066ff","#5b21b6"],we=z(()=>{const e=g.value,t=v.value[e];return`Channel ${String(e+1).padStart(2,"0")} — ${(t==null?void 0:t.name)||"Live TV"}`}),ye=z(()=>{const e=[],t=O.value;for(let l=0;l<=G;l+=30){const n=new Date(t.getTime()+l*6e4);e.push(n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}))}return e}),re=z(()=>{y.value;const e={},t=O.value;return new Date(t.getTime()+G*6e4),v.value.forEach((l,n)=>{const a=[],o=l.items||[];if(!o.length){e[n]=a;return}let u=new Date(t),r=0;for(;ue(t,u)<G;){const i=o[r%o.length],k=(i==null?void 0:i.video_url)||(i==null?void 0:i.mp4_link)||(i==null?void 0:i.trailer_url)||"";let I=Math.max(5,Math.round(((i==null?void 0:i.duration_seconds)||300)/60));const ee=new Date(u.getTime()+I*6e4);a.push({title:(i==null?void 0:i.title)||"Untitled",thumbnail:Te(i,k),category:(i==null?void 0:i.category)||l.name||"Show",durMin:I,widthPx:I*ne,timeLabel:`${de(u)} – ${de(ee)}`,startUTC:u.getTime(),endUTC:ee.getTime(),src:k,item:i}),u=ee,r++}e[n]=a}),e});function ue(e,t){return Math.round((t.getTime()-e.getTime())/6e4)}function de(e){return e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function q(e){return e&&e.replace(/\[[^\]]*\]/g,"").replace(/\([^)]*\)/g,"").trim()||"Untitled"}function Q(e){return(e==null?void 0:e.video_url)||(e==null?void 0:e.mp4_link)||(e==null?void 0:e.trailer_url)||""}function Te(e,t){if(e!=null&&e.thumbnail)return e.thumbnail;const l=t||Q(e);return l&&y.value[l]?y.value[l]:fe}const N=[];let Y=0;function ke(e){return new Promise((t,l)=>{if(!e||typeof e!="string"){l(new Error("Invalid video URL"));return}const n=document.createElement("video");n.muted=!0,n.playsInline=!0,n.crossOrigin="anonymous",n.preload="metadata";const a=setTimeout(()=>{n.src="",n.load(),l(new Error("Timeout"))},15e3);n.onerror=()=>{clearTimeout(a),l(new Error("Video load failed"))},n.onloadeddata=()=>{const o=Math.min(1,Math.max(0,n.duration?n.duration*.05:1));n.currentTime=o},n.onseeked=()=>{clearTimeout(a);try{const o=document.createElement("canvas"),u=320,r=Math.round(n.videoHeight/n.videoWidth*u)||180;o.width=u,o.height=r;const i=o.getContext("2d");if(!i){t(null);return}i.drawImage(n,0,0,u,r);const k=o.toDataURL("image/jpeg",.85);n.src="",n.load(),t(k)}catch(o){l(o)}},n.src=e,n.load().catch(()=>l(new Error("Load failed")))})}function J(){if(Y>=Ut||N.length===0)return;const e=N.shift();if(y.value[e]){J();return}Y++,ke(e).then(t=>{t&&(y.value={...y.value,[e]:t})}).catch(()=>{}).finally(()=>{Y--,J()})}function Ce(e){!e||y.value[e]||N.includes(e)||(N.push(e),J())}function _e(){const e=[],t=new Date;v.value.forEach((l,n)=>{const a=l.items||[];if(!a.length)return;let o=new Date(t),u=0;for(;ue(t,o)<G;){const r=a[u%a.length],i=Math.max(5,Math.round(((r==null?void 0:r.duration_seconds)||300)/60)),k=new Date(o.getTime()+i*6e4);e.push({startUTC:o.getTime(),endUTC:k.getTime(),row:n,col:u,title:(r==null?void 0:r.title)||"Program",category:(r==null?void 0:r.category)||l.name||"Show",src:Q(r),thumb:(r==null?void 0:r.thumbnail)||"",durationSec:i*60}),o=k,u++}}),e.sort((l,n)=>l.startUTC-n.startUTC),X.value=e}function Z(e){const t=Date.now();for(const l of X.value)if(!(e!=null&&l.row!==e)&&t>=l.startUTC&&t<l.endUTC)return l;return null}function Me(e){const t=Date.now();let l=null;for(const n of X.value)e!=null&&n.row!==e||n.startUTC>t&&(!l||n.startUTC<l.startUTC)&&(l=n);return l}function Le(){var n;const e=Z(g.value);if(!e||!e.src)return;const t=v.value[g.value],l={type:"live_tv",id:`live_tv-${(t==null?void 0:t.id)??g.value}`,title:e.title||"Live TV",host:(t==null?void 0:t.name)||"Live TV",thumbnail:e.thumb,video_url:e.src,duration_seconds:e.durationSec};((n=c.currentTrack)==null?void 0:n.video_url)!==e.src&&c.play(l)}function xe(){const e=Z(g.value),t=Me(g.value);e&&(nowTitle.value=q(e.title),nowMeta.value=e.category||"",nowThumb.value=e.thumb||y.value[e.src]||fe),upNextTitle.value=t?q(t.title):"—"}function De(){const e=Z(g.value);if(!e){progressPct.value=0;return}const t=Date.now();progressPct.value=Math.max(0,Math.min(100,(t-e.startUTC)/(e.endUTC-e.startUTC)*100))}function j(){Le(),xe(),De()}function Ee(){var t,l,n;const e=videoEl.value||document.documentElement;document.fullscreenElement?(n=document.exitFullscreen)==null||n.call(document):(l=(t=e==null?void 0:e.requestFullscreen)==null?void 0:t.call(e))==null||l.catch(()=>{})}function Pe(){const e=v.value.length;if(!e)return;const t=(g.value+1)%e;_(t)}function Se(){const e=v.value.length;if(!e)return;const t=(g.value-1+e)%e;_(t)}function _(e){g.value=e,j()}function Ue(){var e;(e=guideRef.value)==null||e.scrollIntoView({behavior:"smooth",block:"start"})}function $(e,t){E.value={row:e,col:t}}function ce(e){var o;if(!guideRef.value)return;const t=guideRef.value.getBoundingClientRect();if(t.bottom<0||t.top>window.innerHeight)return;const l=v.value.length;if(!l)return;const{row:n,col:a}=E.value;if(e.key==="ArrowUp")e.preventDefault(),$(Math.max(0,n-1),a);else if(e.key==="ArrowDown")e.preventDefault(),$(Math.min(l-1,n+1),a);else if(e.key==="ArrowRight"){e.preventDefault();const u=(((o=re.value[n])==null?void 0:o.length)||1)-1;$(n,Math.min(u,a+1))}else e.key==="ArrowLeft"?(e.preventDefault(),$(n,Math.max(0,a-1))):e.key==="Enter"&&(e.preventDefault(),_(E.value.row))}function Ve(e){var l;const t=(e==null?void 0:e.channels)??((l=e==null?void 0:e.data)==null?void 0:l.channels)??[];return Array.isArray(t)?t.map(n=>({...n,id:(n==null?void 0:n.id)??"misc",name:(n==null?void 0:n.name)??"Channel",items:Array.isArray(n==null?void 0:n.items)?n.items:[]})):[]}async function Re(){W.value=!0,se.value=!1,C&&(clearInterval(C),C=null);let e=null;try{e=await Ge("/api/live-tv/channels?_="+Date.now())}catch{try{e=await We("/api/live-tv/channels")}catch{se.value=!0,v.value=[],W.value=!1;return}}v.value=Ve(e||{}),v.value.forEach((t,l)=>{if(!t.items||t.items.length===0){const n=[],a=["Broadcast","Live Segment","Commercial Break","Station ID"];for(let o=0;o<24;o++)n.push({title:a[o%a.length]+" #"+(o+1),duration_seconds:3600,category:t.name});t.items=n}}),v.value.length&&(_e(),j(),C=setInterval(j,1e3),He(()=>{v.value.forEach(t=>{(t.items||[]).forEach(l=>{const n=Q(l);n&&!(l!=null&&l.thumbnail)&&Ce(n)})})})),W.value=!1}let A=null;function F(){if(U.value){const e=U.value.getBoundingClientRect();c.setHeroBounds({top:e.top+window.scrollY,left:e.left+window.scrollX,width:e.width,height:e.height})}}return Ae(async()=>{document.addEventListener("keydown",ce),window.addEventListener("mousemove",D),window.addEventListener("touchstart",D),D(),await Re(),F(),window.ResizeObserver&&(A=new ResizeObserver(F),A.observe(U.value)),window.addEventListener("resize",F)}),Fe(()=>{C&&clearInterval(C),x&&clearTimeout(x),window.removeEventListener("mousemove",D),window.removeEventListener("touchstart",D),document.removeEventListener("keydown",ce),window.removeEventListener("resize",F),A&&A.disconnect(),c.setHeroBounds(null)}),(e,t)=>{var l;return f(),m("div",Ke,[t[23]||(t[23]=s("section",{class:"podcasts-hero"},[s("div",{class:"podcasts-hero-inner"},[s("h1",null,[s("i",{class:"fas fa-tv","aria-hidden":"true"}),te(" Live TV ")]),s("p",null,"Channel surf and watch live programming.")])],-1)),p(c).isWidescreenPinned?B("",!0):(f(),m("div",Xe,[s("div",qe,[s("div",Qe,[s("div",{ref_key:"heroPlaceholder",ref:U,class:"panelstream-player hero-player"},[!p(c).currentTrack||p(c).mode!=="video"?(f(),m("div",Ye,[...t[7]||(t[7]=[s("i",{class:"fas fa-tv fa-3x",style:{opacity:"0.2","margin-bottom":"20px"}},null,-1),s("span",null,"Select a channel to start watching",-1)])])):B("",!0),s("div",Je,[t[8]||(t[8]=s("span",{class:"now-playing-label"},"Now Playing",-1)),s("span",Ze,h(we.value),1)]),t[9]||(t[9]=s("div",{class:"hero-glass"},null,-1))],512),s("div",{class:M(["channel-remote remote-below",{"vibes-hidden":!R.value}]),"aria-label":"Channel Controls"},[s("button",{type:"button",class:"remote-btn",title:"Play/Pause",onClick:t[0]||(t[0]=n=>p(c).togglePlay())},[s("i",{class:M(p(c).isPlaying?"fas fa-pause":"fas fa-play")},null,2)]),s("button",{type:"button",class:"remote-btn",title:"Mute",onClick:t[1]||(t[1]=n=>p(c).toggleMute())},[s("i",{class:M(p(c).isMuted?"fas fa-volume-mute":"fas fa-volume-up")},null,2)]),s("button",{type:"button",class:"remote-btn",title:"Fullscreen",onClick:Ee},[...t[10]||(t[10]=[s("i",{class:"fas fa-expand"},null,-1)])]),s("button",{type:"button",class:"remote-btn",title:p(c).isWidescreenPinned?"Unpin Player":"Pin Widescreen Player",onClick:t[2]||(t[2]=(...n)=>p(c).toggleWidescreenPinned&&p(c).toggleWidescreenPinned(...n))},[s("i",{class:M(p(c).isWidescreenPinned?"fas fa-thumbtack":"fas fa-map-marker-alt")},null,2)],8,je),s("button",{type:"button",class:"remote-btn",title:"Go to Guide",onClick:Ue},[...t[11]||(t[11]=[s("i",{class:"fas fa-list"},null,-1)])]),s("button",{type:"button",class:"remote-btn",title:"Channel Up",onClick:Pe},[...t[12]||(t[12]=[s("i",{class:"fas fa-chevron-up"},null,-1)])]),s("button",{type:"button",class:"remote-btn",title:"Channel Down",onClick:Se},[...t[13]||(t[13]=[s("i",{class:"fas fa-chevron-down"},null,-1)])]),s("button",{type:"button",class:"remote-btn hide-vibes-btn",title:"Hide Controls",onClick:t[3]||(t[3]=n=>R.value=!1)},[...t[14]||(t[14]=[s("i",{class:"fas fa-eye-slash"},null,-1)])])],2)]),s("aside",Ie,[s("img",{src:e.nowThumb,alt:"",class:"rd-thumb"},null,8,et),s("div",tt,[t[15]||(t[15]=s("div",{class:"rd-label"},"Playing Now",-1)),s("div",nt,h(e.nowTitle),1),s("div",st,[s("span",null,h(e.nowMeta),1)])]),s("div",lt,[t[16]||(t[16]=s("div",{class:"rd-label"},"Up Next",-1)),s("div",at,h(e.upNextTitle),1)]),s("div",ot,[t[18]||(t[18]=s("div",{class:"rd-suggested-title"},"Suggested for You",-1)),(f(!0),m(P,null,S(v.value.slice(0,4),(n,a)=>(f(),m("div",{key:n.id,class:"rd-suggested-item",onClick:o=>_(a)},[s("span",{class:"rd-suggested-dot",style:L({background:b[a%4]})},null,4),s("span",rt,h(n.name),1),t[17]||(t[17]=s("span",{class:"rd-suggested-meta"},"Live",-1))],8,it))),128))])])])])),s("div",ut,[s("aside",{class:M(["live-tv-sidebar",{open:V.value}]),"aria-label":"Channels"},[s("ul",dt,[(f(!0),m(P,null,S(v.value,(n,a)=>(f(),m("li",{key:n.id,class:"channel-item",role:"option","aria-selected":String(g.value===a),tabindex:"0",onClick:o=>_(a),onKeydown:ve(o=>_(a),["enter"])},[s("span",{class:"channel-pill",style:L({background:b[a%4]})},null,4),s("span",vt,h(n.name),1)],40,ct))),128))])],2),s("section",ft,[s("div",mt,[s("button",{class:"channels-btn",type:"button",onClick:t[4]||(t[4]=n=>V.value=!0)},[...t[19]||(t[19]=[s("i",{class:"fas fa-list"},null,-1),te(" Channels ",-1)])])]),s("div",ht,[t[20]||(t[20]=Be('<div class="guide-header" data-v-de4a6a7e><div data-v-de4a6a7e>Guide</div><div class="kbd-hint" aria-hidden="true" data-v-de4a6a7e><span data-v-de4a6a7e>Navigate</span><span class="kbd" data-v-de4a6a7e>↑</span><span class="kbd" data-v-de4a6a7e>↓</span><span class="kbd" data-v-de4a6a7e>←</span><span class="kbd" data-v-de4a6a7e>→</span></div></div>',1)),s("div",gt,[(f(!0),m(P,null,S(ye.value,n=>(f(),m("div",{key:n,class:"time-marker",style:L({minWidth:30*ne+"px"})},h(n),5))),128))]),s("div",{class:"guide-scroller",ref_key:"scrollerRef",ref:w,onMousedown:me,onMousemove:he,onMouseup:oe,onMouseleave:oe},[s("div",pt,[s("div",{class:"now-line",style:L(pe.value)},null,4),(f(!0),m(P,null,S(v.value,(n,a)=>(f(),m("div",{key:n.id,class:"guide-row",role:"row"},[s("div",bt,[s("div",{class:"guide-channel-icon",style:L({background:"linear-gradient(135deg, "+b[a%4]+", "+b[a%4]+"dd)",boxShadow:"0 0 15px "+b[a%4]+"44"})},null,4),s("div",wt,h(n.name),1)]),s("div",yt,[(f(!0),m(P,null,S(re.value[a]||[],(o,u)=>(f(),m("div",{key:a+"-"+u,class:M(["program",{selected:E.value.row===a&&E.value.col===u}]),onClick:r=>ie(o),onKeydown:ve(r=>ie(o),["enter"]),"data-row":a,"data-col":u,tabindex:"0",role:"gridcell","aria-label":o.title+" • "+o.durMin+" min",style:L({width:o.widthPx+"px",background:"linear-gradient(165deg, "+b[a%4]+"bb 0%, "+b[a%4]+"22 100%)",border:"1px solid "+b[a%4]+"cc",backdropFilter:"blur(16px)",boxShadow:"0 8px 32px rgba(0,0,0,0.4), inset 0 0 15px "+b[a%4]+"22"})},[s("div",kt,h(o.title),1)],46,Tt))),128))])]))),128))])],544)])]),V.value?(f(),m("div",{key:0,class:"ltv-overlay",onClick:t[5]||(t[5]=n=>V.value=!1)})):B("",!0),T.value?(f(),m("div",{key:1,class:"program-modal-overlay",onClick:ze(K,["self"])},[s("div",Ct,[s("button",{class:"close-btn",onClick:K,"aria-label":"Close"},[...t[21]||(t[21]=[s("i",{class:"fas fa-times"},null,-1)])]),s("div",_t,[s("div",Mt,[s("h2",Lt,h(q(T.value.title)),1),s("div",xt,[s("span",Dt,h(T.value.category),1),s("span",null,h(T.value.durMin)+" min",1)])]),s("div",Et,[s("p",Pt,h(((l=T.value.item)==null?void 0:l.description)||"No description available for this program."),1),s("div",St,[s("button",{class:"action-btn primary",onClick:t[6]||(t[6]=n=>be(T.value))},[...t[22]||(t[22]=[s("i",{class:"fas fa-plus"},null,-1),te(" Add to Saved ",-1)])])])])])])])):B("",!0)],512)])}}},$t=Ne(Vt,[["__scopeId","data-v-de4a6a7e"]]);export{$t as default};
