import{_ as Me,o as xe,b as Ee,c as f,d as h,e as l,f as le,t as g,n as x,F as A,r as G,G as De,C as E,i as Ue,E as Le,a as Se,M as Ve,m as d,q as B,L as Pe,g as Ne}from"./index-BLQ12ZV3.js";const $e={class:"tv-container"},Fe={class:"video-spotlight"},Re={class:"spotlight-grid"},Ae={class:"spotlight-left"},Ge={class:"panelstream-player hero-player"},Be={class:"video-header"},ze={class:"channel-name-label","aria-live":"polite"},He={class:"right-dashboard glass hidden-mobile","aria-label":"Channel Dashboard"},Ke=["src"],Oe={class:"rd-now"},qe={class:"rd-title"},Qe={class:"rd-meta"},We={class:"rd-next"},Ie={class:"rd-title"},Xe={class:"channel-list",role:"listbox","aria-label":"Live TV Channels"},Je=["aria-selected","onClick","onKeydown"],Ye={class:"channel-name"},Ze={class:"live-tv-main"},je={class:"mobile-only",style:{padding:"8px 10px"}},et={class:"guide"},tt={class:"guide-timebar"},nt={class:"guide-scroller"},at={class:"guide-rows",role:"grid","aria-label":"Channel Guide"},lt={class:"guide-channel-label"},st={class:"guide-channel-name"},ot={class:"guide-track"},it=["data-row","data-col","aria-label"],rt={class:"program-title",style:{"font-size":"11px",opacity:"0.9"}},se="",oe=6,W=180,ut=2,ct={__name:"LiveTVView",setup(dt){const m=d(null),D=d(null),u=d([]),c=d(0),z=d(!0),I=d(!1),y=d(!1),T=d(!0),U=d(!1),L=d(!0);let C=null;function _(){L.value=!0,C&&clearTimeout(C),C=setTimeout(()=>{L.value=!1},5e3)}const p=d({}),k=d({row:0,col:0}),ie=B(()=>({left:"158px"})),S=d([]);let V="",w=null;const P=["#7c66ff","#ff6b6b","#22c55e","#f59e0b"],X=B(()=>{const e=c.value,t=u.value[e];return`Channel ${String(e+1).padStart(2,"0")} — ${(t==null?void 0:t.name)||"Live TV"}`}),re=B(()=>{const e=[],t=new Date;for(let a=0;a<=W;a+=30){const n=new Date(t.getTime()+a*6e4);e.push(n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}))}return e}),J=B(()=>{p.value;const e={},t=new Date;return u.value.forEach((a,n)=>{const s=[];let o=new Date(t),v=0;const r=a.items||[];if(!r.length){e[n]=s;return}for(;Y(t,o)<W;){const i=r[v%r.length],b=(i==null?void 0:i.video_url)||(i==null?void 0:i.mp4_link)||(i==null?void 0:i.trailer_url)||"",q=Math.max(5,Math.round(((i==null?void 0:i.duration_seconds)||300)/60)),Q=new Date(o.getTime()+q*6e4);s.push({title:(i==null?void 0:i.title)||"Untitled",thumbnail:ue(i,b),category:(i==null?void 0:i.category)||a.name||"Show",durMin:q,widthPx:q*oe,timeLabel:`${Z(o)} – ${Z(Q)}`,startUTC:o.getTime(),endUTC:Q.getTime(),src:b,item:i}),o=Q,v++}e[n]=s}),e});function Y(e,t){return Math.round((t.getTime()-e.getTime())/6e4)}function Z(e){return e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function j(e){return e&&e.replace(/\[[^\]]*\]/g,"").replace(/\([^)]*\)/g,"").trim()||"Untitled"}function H(e){return(e==null?void 0:e.video_url)||(e==null?void 0:e.mp4_link)||(e==null?void 0:e.trailer_url)||""}function ue(e,t){if(e!=null&&e.thumbnail)return e.thumbnail;const a=t||H(e);return a&&p.value[a]?p.value[a]:se}const N=[];let K=0;function ce(e){return new Promise((t,a)=>{if(!e||typeof e!="string"){a(new Error("Invalid video URL"));return}const n=document.createElement("video");n.muted=!0,n.playsInline=!0,n.crossOrigin="anonymous",n.preload="metadata";const s=setTimeout(()=>{n.src="",n.load(),a(new Error("Timeout"))},15e3);n.onerror=()=>{clearTimeout(s),a(new Error("Video load failed"))},n.onloadeddata=()=>{const o=Math.min(1,Math.max(0,n.duration?n.duration*.05:1));n.currentTime=o},n.onseeked=()=>{clearTimeout(s);try{const o=document.createElement("canvas"),v=320,r=Math.round(n.videoHeight/n.videoWidth*v)||180;o.width=v,o.height=r;const i=o.getContext("2d");if(!i){t(null);return}i.drawImage(n,0,0,v,r);const b=o.toDataURL("image/jpeg",.85);n.src="",n.load(),t(b)}catch(o){a(o)}},n.src=e,n.load().catch(()=>a(new Error("Load failed")))})}function O(){if(K>=ut||N.length===0)return;const e=N.shift();if(p.value[e]){O();return}K++,ce(e).then(t=>{t&&(p.value={...p.value,[e]:t})}).catch(()=>{}).finally(()=>{K--,O()})}function de(e){!e||p.value[e]||N.includes(e)||(N.push(e),O())}function ve(){const e=[],t=new Date;u.value.forEach((a,n)=>{const s=a.items||[];if(!s.length)return;let o=new Date(t),v=0;for(;Y(t,o)<W;){const r=s[v%s.length],i=Math.max(5,Math.round(((r==null?void 0:r.duration_seconds)||300)/60)),b=new Date(o.getTime()+i*6e4);e.push({startUTC:o.getTime(),endUTC:b.getTime(),row:n,col:v,title:(r==null?void 0:r.title)||"Program",category:(r==null?void 0:r.category)||a.name||"Show",src:H(r),thumb:(r==null?void 0:r.thumbnail)||"",durationSec:i*60}),o=b,v++}}),e.sort((a,n)=>a.startUTC-n.startUTC),S.value=e}function $(e){const t=Date.now();for(const a of S.value)if(!(e!=null&&a.row!==e)&&t>=a.startUTC&&t<a.endUTC)return a;return null}function ee(e){const t=Date.now();let a=null;for(const n of S.value)e!=null&&n.row!==e||n.startUTC>t&&(!a||n.startUTC<a.startUTC)&&(a=n);return a}function te(e){const t=Math.max(0,Date.now()-e.startUTC);return Math.max(0,Math.min(Math.floor(t/1e3),e.durationSec-1))}function fe(){const e=m.value;if(!e||!S.value.length)return;const t=$(c.value);if(!t||!t.src)return;const a=t.src!==V,n=te(t);if(a){V=t.src;try{e.pause()}catch{}e.src=t.src;try{e.load()}catch{}e.currentTime=n,e.muted=!0,T.value=!0,e.play().catch(()=>{});const s=u.value[c.value];Pe({id:`live_tv-${(s==null?void 0:s.id)??c.value}-${t.startUTC}`,type:"live_tv",title:t.title||"Live TV",host:(s==null?void 0:s.name)||X.value,thumbnail:t.thumb,url:t.src})}else if(Math.abs((e.currentTime||0)-n)>3)try{e.currentTime=n}catch{}}function he(){const e=$(c.value),t=ee(c.value);e&&(nowTitle.value=j(e.title),nowMeta.value=e.category||"",nowThumb.value=e.thumb||p.value[e.src]||se),upNextTitle.value=t?j(t.title):"—"}function me(){const e=$(c.value);if(!e){progressPct.value=0;return}const t=Date.now();progressPct.value=Math.max(0,Math.min(100,(t-e.startUTC)/(e.endUTC-e.startUTC)*100))}function F(){fe(),he(),me()}function ne(){const e=$(c.value);if(!e)return;const t=m.value;if(!t)return;const a=te(e);try{Math.abs((t.currentTime||0)-a)>2&&(t.currentTime=a)}catch{}}function pe(){y.value=!1;const e=ee(c.value);if(!e)return;const t=()=>{V="",F()},a=Date.now();a<e.startUTC?setTimeout(t,Math.max(0,e.startUTC-a+50)):t()}function ge(){m.value&&(y.value?m.value.pause():m.value.play().catch(()=>{}))}function be(){m.value&&(T.value=!T.value,m.value.muted=T.value)}function we(){var t,a,n;const e=m.value||document.documentElement;document.fullscreenElement?(n=document.exitFullscreen)==null||n.call(document):(a=(t=e==null?void 0:e.requestFullscreen)==null?void 0:t.call(e))==null||a.catch(()=>{})}function ye(){const e=u.value.length;if(!e)return;const t=(c.value+1)%e;M(t)}function Te(){const e=u.value.length;if(!e)return;const t=(c.value-1+e)%e;M(t)}function M(e){c.value=e,V="",F()}function Ce(){var e;(e=D.value)==null||e.scrollIntoView({behavior:"smooth",block:"start"})}function R(e,t){k.value={row:e,col:t}}function ae(e){var o;if(!D.value)return;const t=D.value.getBoundingClientRect();if(t.bottom<0||t.top>window.innerHeight)return;const a=u.value.length;if(!a)return;const{row:n,col:s}=k.value;if(e.key==="ArrowUp")e.preventDefault(),R(Math.max(0,n-1),s);else if(e.key==="ArrowDown")e.preventDefault(),R(Math.min(a-1,n+1),s);else if(e.key==="ArrowRight"){e.preventDefault();const v=(((o=J.value[n])==null?void 0:o.length)||1)-1;R(n,Math.min(v,s+1))}else e.key==="ArrowLeft"?(e.preventDefault(),R(n,Math.max(0,s-1))):e.key==="Enter"&&(e.preventDefault(),M(k.value.row))}function _e(e){var a;const t=(e==null?void 0:e.channels)??((a=e==null?void 0:e.data)==null?void 0:a.channels)??[];return Array.isArray(t)?t.map(n=>({...n,id:(n==null?void 0:n.id)??"misc",name:(n==null?void 0:n.name)??"Channel",items:Array.isArray(n==null?void 0:n.items)?n.items:[]})):[]}async function ke(){z.value=!0,I.value=!1,w&&(clearInterval(w),w=null);let e=null;try{e=await Le("/api/live-tv/channels?_="+Date.now())}catch{try{e=await Se("/api/live-tv/channels")}catch{I.value=!0,u.value=[],z.value=!1;return}}u.value=_e(e||{}),u.value.forEach((t,a)=>{if(!t.items||t.items.length===0){const n=[],s=["Broadcast","Live Segment","Commercial Break","Station ID"];for(let o=0;o<24;o++)n.push({title:s[o%s.length]+" #"+(o+1),duration_seconds:3600,category:t.name});t.items=n}}),u.value.length&&(ve(),F(),w=setInterval(F,1e3),Ve(()=>{u.value.forEach(t=>{(t.items||[]).forEach(a=>{const n=H(a);n&&!(a!=null&&a.thumbnail)&&de(n)})})})),z.value=!1}return xe(async()=>{document.addEventListener("keydown",ae),window.addEventListener("mousemove",_),window.addEventListener("touchstart",_),_(),await ke()}),Ee(()=>{w&&clearInterval(w),C&&clearTimeout(C),window.removeEventListener("mousemove",_),window.removeEventListener("touchstart",_),document.removeEventListener("keydown",ae)}),(e,t)=>(f(),h("div",$e,[t[16]||(t[16]=l("section",{class:"podcasts-hero"},[l("div",{class:"podcasts-hero-inner"},[l("h1",null,[l("i",{class:"fas fa-tv","aria-hidden":"true"}),le(" Live TV ")]),l("p",null,"Channel surf and watch live programming.")])],-1)),l("div",Fe,[l("div",Re,[l("div",Ae,[l("div",Ge,[l("video",{ref_key:"videoEl",ref:m,controls:"",autoplay:"",muted:"",playsinline:"","webkit-playsinline":"",onPlay:t[0]||(t[0]=a=>y.value=!0),onPause:t[1]||(t[1]=a=>y.value=!1),onEnded:pe,onError:ne,onStalled:ne},null,544),l("div",Be,[t[5]||(t[5]=l("span",{class:"now-playing-label"},"Now Playing",-1)),l("span",ze,g(X.value),1)]),t[6]||(t[6]=l("div",{class:"hero-glass"},null,-1))]),l("div",{class:x(["channel-remote remote-below",{"vibes-hidden":!L.value}]),"aria-label":"Channel Controls"},[l("button",{type:"button",class:"remote-btn",title:"Play/Pause",onClick:ge},[l("i",{class:x(y.value?"fas fa-pause":"fas fa-play")},null,2)]),l("button",{type:"button",class:"remote-btn",title:"Mute",onClick:be},[l("i",{class:x(T.value?"fas fa-volume-mute":"fas fa-volume-up")},null,2)]),l("button",{type:"button",class:"remote-btn",title:"Fullscreen",onClick:we},[...t[7]||(t[7]=[l("i",{class:"fas fa-expand"},null,-1)])]),l("button",{type:"button",class:"remote-btn",title:"Go to Guide",onClick:Ce},[...t[8]||(t[8]=[l("i",{class:"fas fa-list"},null,-1)])]),l("button",{type:"button",class:"remote-btn",title:"Channel Up",onClick:ye},[...t[9]||(t[9]=[l("i",{class:"fas fa-chevron-up"},null,-1)])]),l("button",{type:"button",class:"remote-btn",title:"Channel Down",onClick:Te},[...t[10]||(t[10]=[l("i",{class:"fas fa-chevron-down"},null,-1)])]),l("button",{type:"button",class:"remote-btn hide-vibes-btn",title:"Hide Controls",onClick:t[2]||(t[2]=a=>L.value=!1)},[...t[11]||(t[11]=[l("i",{class:"fas fa-eye-slash"},null,-1)])])],2)]),l("aside",He,[l("img",{src:e.nowThumb,alt:"",class:"rd-thumb"},null,8,Ke),l("div",Oe,[t[12]||(t[12]=l("div",{class:"rd-label"},"Playing Now",-1)),l("div",qe,g(e.nowTitle),1),l("div",Qe,[l("span",null,g(e.nowMeta),1)])]),l("div",We,[t[13]||(t[13]=l("div",{class:"rd-label"},"Up Next",-1)),l("div",Ie,g(e.upNextTitle),1)])])])]),l("div",{ref_key:"guideRef",ref:D,class:"live-tv-container guide-flush","aria-label":"TV Guide"},[l("aside",{class:x(["live-tv-sidebar",{open:U.value}]),"aria-label":"Channels"},[l("ul",Xe,[(f(!0),h(A,null,G(u.value,(a,n)=>(f(),h("li",{key:a.id,class:"channel-item",role:"option","aria-selected":String(c.value===n),tabindex:"0",onClick:s=>M(n),onKeydown:Ne(s=>M(n),["enter"])},[l("span",{class:"channel-pill",style:E({background:P[n%4]})},null,4),l("span",Ye,g(a.name),1)],40,Je))),128))])],2),l("section",Ze,[l("div",je,[l("button",{class:"channels-btn",type:"button",onClick:t[3]||(t[3]=a=>U.value=!0)},[...t[14]||(t[14]=[l("i",{class:"fas fa-list"},null,-1),le(" Channels ",-1)])])]),l("div",et,[t[15]||(t[15]=De('<div class="guide-header" data-v-27711960><div data-v-27711960>Guide</div><div class="kbd-hint" aria-hidden="true" data-v-27711960><span data-v-27711960>Navigate</span><span class="kbd" data-v-27711960>↑</span><span class="kbd" data-v-27711960>↓</span><span class="kbd" data-v-27711960>←</span><span class="kbd" data-v-27711960>→</span></div></div>',1)),l("div",tt,[(f(!0),h(A,null,G(re.value,a=>(f(),h("div",{key:a,class:"time-marker",style:E({minWidth:30*oe+"px"})},g(a),5))),128))]),l("div",nt,[l("div",at,[l("div",{class:"now-line",style:E(ie.value)},null,4),(f(!0),h(A,null,G(u.value,(a,n)=>(f(),h("div",{key:a.id,class:"guide-row",role:"row"},[l("div",lt,[l("div",{class:"guide-channel-icon",style:E({background:P[n%4]})},null,4),l("div",st,g(a.name),1)]),l("div",ot,[(f(!0),h(A,null,G(J.value[n]||[],(s,o)=>(f(),h("div",{key:n+"-"+o,class:x(["program",{selected:k.value.row===n&&k.value.col===o}]),"data-row":n,"data-col":o,tabindex:"0",role:"gridcell","aria-label":s.title+" • "+s.durMin+" min",style:E({width:s.widthPx+"px",background:P[n%4],boxShadow:"0 0 10px "+P[n%4]+"66, inset 0 0 5px rgba(255,255,255,0.2)"})},[l("div",rt,g(s.title),1)],14,it))),128))])]))),128))])])])]),U.value?(f(),h("div",{key:0,class:"ltv-overlay",onClick:t[4]||(t[4]=a=>U.value=!1)})):Ue("",!0)],512)]))}},ft=Me(ct,[["__scopeId","data-v-27711960"]]);export{ft as default};
