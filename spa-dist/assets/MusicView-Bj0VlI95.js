import{_ as A,c,d as r,e,C,n as k,t as m,D as E,q as y,m as u,u as F,o as L,y as V,k as S,F as x,r as R,a as z,p as I,B as b,h as Y,j as N,E as O,G as H}from"./index-DGqWHNLv.js";const M=70,$=120,j={__name:"PullRefresh",emits:["refresh"],setup(B,{emit:i}){const g=i,T=u(null),t=u(!1),l=u(!1),v=u(0),n=u(0),o=y(()=>l.value?M*.6:Math.min(n.value*.5,$*.5)),a=y(()=>l.value?0:Math.min(n.value*.4,$*.4)-40),w=y(()=>l.value?1:Math.min(n.value/M,1)),s=y(()=>n.value>=M);function f(){return window.scrollY<=0}function p(d){!f()||l.value||(v.value=d.touches[0].clientY,t.value=!0)}function h(d){if(!t.value||l.value)return;const P=d.touches[0].clientY-v.value;P>0?n.value=P:(t.value=!1,n.value=0)}function _(){t.value&&(s.value?(l.value=!0,n.value=0,g("refresh",D)):n.value=0,t.value=!1)}function D(){l.value=!1,n.value=0}return(d,P)=>(c(),r("div",{class:"pull-refresh-wrapper",ref_key:"wrapper",ref:T,onTouchstartPassive:p,onTouchmovePassive:h,onTouchendPassive:_},[e("div",{class:k(["pull-indicator",{active:t.value,refreshing:l.value}]),style:C({transform:`translateY(${a.value}px)`,opacity:w.value})},[e("i",{class:k(l.value?"fas fa-spinner fa-spin":"fas fa-arrow-down"),style:C({transform:s.value?"rotate(180deg)":""})},null,6),e("span",null,m(l.value?"Refreshing...":s.value?"Release to refresh":"Pull to refresh"),1)],6),e("div",{class:"pull-content",style:C({transform:`translateY(${o.value}px)`})},[E(d.$slots,"default",{},void 0)],4)],544))}},q=A(j,[["__scopeId","data-v-d1c2085f"]]),G={class:"music-container"},J={class:"unified-header music-subheader"},Q={class:"header-content"},U={class:"header-count"},X={key:0,class:"music-grid"},K=["onClick"],W=["src","alt"],Z={class:"track-overlay"},ee=["onClick"],se=["onClick"],te={class:"track-title"},ae={class:"track-artist"},le={key:1,class:"music-grid"},ne={__name:"MusicView",setup(B){const i=F(),g=O();function T(o){g.open(o)}const t=u([]);function l(o){var a;((a=i.currentTrack)==null?void 0:a.id)===t.value[o].id&&i.isPlaying?i.pause():i.setQueue(t.value,o)}async function v(){const o=await z("/api/music").catch(()=>({tracks:[]}));t.value=o.tracks||[]}async function n(o){try{const a=await H("/api/music");t.value=a.tracks||[],localStorage.setItem("ahoy:/api/music",JSON.stringify({data:a,ts:Date.now()}))}catch{}o()}return L(v),(o,a)=>{const w=I("router-link");return c(),V(q,{onRefresh:n},{default:S(()=>[e("div",G,[e("div",J,[e("div",Q,[a[0]||(a[0]=e("h1",null,"Music",-1)),e("span",U,m(t.value.length)+" tracks",1)])]),t.value.length?(c(),r("div",X,[(c(!0),r(x,null,R(t.value,(s,f)=>{var p,h;return c(),r("div",{key:s.id,class:k(["track-card",{playing:((p=b(i).currentTrack)==null?void 0:p.id)===s.id}])},[e("div",{class:"track-cover",onClick:_=>l(f)},[e("img",{src:s.cover_art,alt:s.title,loading:"lazy"},null,8,W),e("div",Z,[e("button",{class:"play-btn",onClick:Y(_=>l(f),["stop"])},[e("i",{class:k(((h=b(i).currentTrack)==null?void 0:h.id)===s.id&&b(i).isPlaying?"fas fa-pause":"fas fa-play")},null,2)],8,ee),e("button",{type:"button",class:"track-overlay-btn add-to-playlist-btn",title:"Add to playlist",onClick:Y(_=>T(s),["stop"])},[...a[1]||(a[1]=[e("i",{class:"fas fa-plus"},null,-1)])],8,se)])],8,K),N(w,{to:`/music/${s.id}`,class:"track-info",style:{"text-decoration":"none",color:"inherit"}},{default:S(()=>[e("div",te,m(s.title),1),e("div",ae,m(s.artist),1)]),_:2},1032,["to"])],2)}),128))])):(c(),r("div",le,[(c(),r(x,null,R(8,s=>e("div",{class:"track-card",key:s},[...a[2]||(a[2]=[e("div",{class:"track-cover skeleton"},null,-1),e("div",{class:"track-info"},[e("div",{class:"skeleton",style:{height:"14px",width:"60%","margin-bottom":"6px"}}),e("div",{class:"skeleton",style:{height:"12px",width:"40%"}})],-1)])])),64))]))])]),_:1})}}},ie=A(ne,[["__scopeId","data-v-3ebb10c1"]]);export{ie as default};
