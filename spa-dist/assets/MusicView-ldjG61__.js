import{_ as J,c as d,d as v,e as t,C as z,n,t as p,D as tt,q,m as y,u as st,z as et,o as at,y as lt,k as N,f as it,r as R,F as D,l as L,A as O,x as ot,v as F,i as nt,E as G,s as rt,p as ut,B as l,h as u,j as U}from"./index-BygRSi_L.js";const I=70,X=120,dt={__name:"PullRefresh",emits:["refresh"],setup(K,{emit:j}){const i=j,m=y(null),h=y(!1),c=y(!1),x=y(0),r=y(0),T=q(()=>c.value?I*.6:Math.min(r.value*.5,X*.5)),P=q(()=>c.value?0:Math.min(r.value*.4,X*.4)-40),_=q(()=>c.value?1:Math.min(r.value/I,1)),A=q(()=>r.value>=I);function $(){return window.scrollY<=0}function Y(C){!$()||c.value||(x.value=C.touches[0].clientY,h.value=!0)}function b(C){if(!h.value||c.value)return;const E=C.touches[0].clientY-x.value;E>0?r.value=E:(h.value=!1,r.value=0)}function V(){h.value&&(A.value?(c.value=!0,r.value=0,i("refresh",k)):r.value=0,h.value=!1)}function k(){c.value=!1,r.value=0}return(C,E)=>(d(),v("div",{class:"pull-refresh-wrapper",ref_key:"wrapper",ref:m,onTouchstartPassive:Y,onTouchmovePassive:b,onTouchendPassive:V},[t("div",{class:n(["pull-indicator",{active:h.value,refreshing:c.value}]),style:z({transform:`translateY(${P.value}px)`,opacity:_.value})},[t("i",{class:n(c.value?"fas fa-spinner fa-spin":"fas fa-arrow-down"),style:z({transform:A.value?"rotate(180deg)":""})},null,6),t("span",null,p(c.value?"Refreshing...":A.value?"Release to refresh":"Pull to refresh"),1)],6),t("div",{class:"pull-content",style:z({transform:`translateY(${T.value}px)`})},[tt(C.$slots,"default",{},void 0)],4)],544))}},ct=J(dt,[["__scopeId","data-v-d1c2085f"]]),vt={class:"music-container"},pt={class:"podcasts-section podcasts-featured-section"},ft={class:"podcasts-section-header podcasts-featured-header"},mt={class:"podcast-filter-chips"},bt=["onClick"],yt={class:"podcast-shows-dropdown-mobile"},ht=["value"],_t={class:"music-header-toolbar"},kt={class:"search-bar music-toolbar-search"},gt={class:"view-options"},Ct={class:"music-list"},wt={class:"music-table-wrap"},Tt={class:"music-table"},Pt=["onClick"],$t={class:"col-art"},Bt={class:"music-table-art-wrap"},St=["src","alt"],At=["aria-label","onClick"],Mt={class:"col-title-artist"},xt={class:"music-track-meta"},Rt={class:"title-text"},Dt={class:"music-track-artist"},Lt={class:"col-duration"},qt={class:"col-plays"},Vt={class:"col-action"},Et=["onClick"],Yt=["title","onClick"],Nt=["aria-pressed","onClick"],jt={class:"music-mobile-list"},zt=["onClick"],Ft={class:"music-mobile-art"},Ut=["src","alt"],It=["aria-label","onClick"],Qt={class:"music-mobile-meta"},Ht={class:"music-mobile-title"},Ot={class:"music-mobile-artist"},Gt={class:"music-mobile-right"},Xt={class:"music-mobile-duration"},Jt={class:"music-mobile-actions"},Kt=["title","aria-label","onClick"],Wt=["onClick"],Zt=["title","onClick"],ts=["aria-pressed","onClick"],ss={class:"music-grid"},es=["onClick"],as=["src","alt"],ls={class:"track-overlay"},is=["onClick"],os=["onClick"],ns=["onClick"],rs=["title","onClick"],us={class:"track-title"},ds={class:"track-artist"},cs={class:"track-duration"},vs={key:0,class:"music-grid"},ps={key:1,class:"empty-state"},fs={__name:"MusicView",setup(K){const j=rt(),i=st(),m=et();function h(a){m.toggle({type:"track",id:a.id,title:a.title,cover_art:a.cover_art})}function c(a){const s=a&&(a.cover_art||a.artwork);return typeof s=="string"&&s.trim()?s:"/static/img/default-cover.jpg"}function x(a){if(!a||!a.artist)return;const s=a.artist_slug||a.artist,o=new URLSearchParams({type:"boost",artist_id:s,amount:"1"});j.push("/checkout?"+o.toString())}const r=y([]),T=y(!0),P=y(""),_=y(""),A=y("plays"),$=y("list"),Y=q(()=>{const a=new Set;for(const s of r.value)s.artist&&a.add(s.artist);return Array.from(a).sort()}),b=q(()=>{let a=[...r.value];if(P.value){const s=P.value.toLowerCase();a=a.filter(o=>(o.title||"").toLowerCase().includes(s)||(o.artist||"").toLowerCase().includes(s)||(o.album||"").toLowerCase().includes(s))}return _.value&&(a=a.filter(s=>s.artist===_.value)),a.sort((s,o)=>{switch(A.value){case"title":return(s.title||"").localeCompare(o.title||"");case"artist":return(s.artist||"").localeCompare(o.artist||"");case"added_date":return new Date(o.added_date||0)-new Date(s.added_date||0);case"plays":return(o.play_count||0)-(s.play_count||0);default:return 0}}),a});function V(a){if(!a&&a!==0)return"0:00";const s=Math.floor(Number(a)/60),o=Math.floor(Number(a)%60);return`${s}:${o.toString().padStart(2,"0")}`}function k(a){var e;const s=b.value,o=s[a];if(o){if(((e=i.currentTrack)==null?void 0:e.id)===o.id&&i.isPlaying){i.pause();return}i.setQueue(s,a)}}function C(a){i.addToQueue({type:"track",id:a.id,title:a.title,artist:a.artist,cover_art:a.cover_art,duration_seconds:a.duration_seconds})}function E(){if(b.value.length===0)return;const a=Math.floor(Math.random()*b.value.length);k(a)}async function W(){T.value=!0;try{const a=await G("/api/music?t="+Date.now());r.value=a.tracks||[]}catch{r.value=[]}T.value=!1}async function Z(a){try{const s=await G("/api/music?t="+Date.now());r.value=s.tracks||[]}catch{}a()}return at(W),(a,s)=>{const o=ut("router-link");return d(),lt(ct,{onRefresh:Z},{default:N(()=>[t("div",vt,[s[30]||(s[30]=t("section",{class:"podcasts-hero"},[t("div",{class:"podcasts-hero-inner"},[t("h1",null,[t("i",{class:"fas fa-music","aria-hidden":"true"}),it(" Music Library ")]),t("p",null,"Explore")])],-1)),t("section",pt,[t("div",ft,[s[12]||(s[12]=t("div",null,[t("h2",null,"Tracks"),t("p",{class:"podcasts-section-subtitle"},"Filter by artist or search. Sort and switch between list and grid.")],-1)),t("div",mt,[t("button",{type:"button",class:n(["podcast-filter-chip",{active:!_.value}]),onClick:s[0]||(s[0]=e=>_.value="")}," All ",2),(d(!0),v(D,null,R(Y.value.slice(0,14),e=>(d(),v("button",{key:e,type:"button",class:n(["podcast-filter-chip",{active:_.value===e}]),onClick:g=>_.value=e},p(e),11,bt))),128))])]),t("div",yt,[L(t("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>_.value=e),class:"podcast-show-select","aria-label":"Filter by artist"},[s[13]||(s[13]=t("option",{value:""},"All Artists",-1)),(d(!0),v(D,null,R(Y.value,e=>(d(),v("option",{key:e,value:e},p(e),9,ht))),128))],512),[[O,_.value]])]),t("div",_t,[t("div",kt,[s[15]||(s[15]=t("i",{class:"fas fa-search","aria-hidden":"true"},null,-1)),L(t("input",{"onUpdate:modelValue":s[2]||(s[2]=e=>P.value=e),type:"text",class:"search-input",placeholder:"Search music...","aria-label":"Search music"},null,512),[[ot,P.value]]),L(t("button",{type:"button",class:"search-clear","aria-label":"Clear search",onClick:s[3]||(s[3]=e=>P.value="")},[...s[14]||(s[14]=[t("i",{class:"fas fa-times","aria-hidden":"true"},null,-1)])],512),[[F,P.value]])]),L(t("select",{"onUpdate:modelValue":s[4]||(s[4]=e=>A.value=e),class:"music-toolbar-sort","aria-label":"Sort music"},[...s[16]||(s[16]=[t("option",{value:"title"},"Title",-1),t("option",{value:"artist"},"Artist",-1),t("option",{value:"plays"},"Plays",-1),t("option",{value:"added_date"},"Date Added",-1)])],512),[[O,A.value]]),t("div",gt,[t("button",{type:"button",class:n(["view-btn",{active:$.value==="grid"}]),"aria-label":"Grid view",onClick:s[5]||(s[5]=e=>$.value="grid")},[...s[17]||(s[17]=[t("i",{class:"fas fa-th","aria-hidden":"true"},null,-1)])],2),t("button",{type:"button",class:n(["view-btn",{active:$.value==="list"}]),"aria-label":"List view",onClick:s[6]||(s[6]=e=>$.value="list")},[...s[18]||(s[18]=[t("i",{class:"fas fa-list","aria-hidden":"true"},null,-1)])],2)]),t("button",{type:"button",class:"episode-btn music-toolbar-play",title:"Play Random",onClick:E},[...s[19]||(s[19]=[t("i",{class:"fas fa-random","aria-hidden":"true"},null,-1),t("span",{class:"sr-only"},"Play Random",-1)])])])]),L(t("div",Ct,[t("div",wt,[t("table",Tt,[s[23]||(s[23]=t("thead",null,[t("tr",null,[t("th",{class:"col-art"},"Album"),t("th",{class:"col-title-artist"},"Track"),t("th",{class:"col-duration"},"Duration"),t("th",{class:"col-plays col-plays-header"},"Plays"),t("th",{class:"col-action","aria-label":"Actions"})])],-1)),t("tbody",null,[(d(!0),v(D,null,R(b.value,(e,g)=>{var B,S,f;return d(),v("tr",{key:e.id,class:n(["music-table-row",{playing:((B=l(i).currentTrack)==null?void 0:B.id)===e.id}]),onClick:w=>k(g)},[t("td",$t,[t("div",Bt,[t("img",{class:"music-table-art",src:c(e),alt:e.title,loading:"lazy",onError:s[7]||(s[7]=w=>w.target.src="/static/img/default-cover.jpg")},null,40,St),t("button",{type:"button",class:"music-table-art-play","aria-label":((S=l(i).currentTrack)==null?void 0:S.id)===e.id&&l(i).isPlaying?"Pause":"Play",onClick:u(w=>k(g),["stop"])},[t("i",{class:n(((f=l(i).currentTrack)==null?void 0:f.id)===e.id&&l(i).isPlaying?"fas fa-pause":"fas fa-play"),"aria-hidden":"true"},null,2)],8,At)])]),t("td",Mt,[t("div",xt,[U(o,{to:`/music/${e.id}`,class:"title-link",onClick:s[8]||(s[8]=u(()=>{},["stop"]))},{default:N(()=>[t("span",Rt,p(e.title),1)]),_:2},1032,["to"]),t("span",Dt,p(e.artist),1)])]),t("td",Lt,p(V(e.duration_seconds)),1),t("td",qt,p(e.play_count||0),1),t("td",Vt,[t("button",{type:"button",class:"episode-btn queue-btn",title:"Add to queue","aria-label":"Add to queue",onClick:u(w=>C(e),["stop"])},[...s[20]||(s[20]=[t("i",{class:"fas fa-plus","aria-hidden":"true"},null,-1),t("span",{class:"sr-only"},"Add to queue",-1)])],8,Et),t("button",{type:"button",class:"episode-btn boost-btn",title:"Boost "+(e.artist||"artist"),"aria-label":"Boost artist",onClick:u(w=>x(e),["stop"])},[...s[21]||(s[21]=[t("i",{class:"fas fa-bolt","aria-hidden":"true"},null,-1),t("span",{class:"sr-only"},"Boost",-1)])],8,Yt),t("button",{type:"button",class:n(["episode-btn bm-btn",{bookmarked:l(m).isBookmarked({id:e.id})}]),"aria-pressed":l(m).isBookmarked({id:e.id}),title:"Save",onClick:u(w=>h(e),["stop"])},[t("i",{class:n(l(m).isBookmarked({id:e.id})?"fas fa-bookmark":"far fa-bookmark"),"aria-hidden":"true"},null,2),s[22]||(s[22]=t("span",{class:"sr-only"},"Save",-1))],10,Nt)])],10,Pt)}),128))])])]),t("div",jt,[(d(!0),v(D,null,R(b.value,(e,g)=>{var B,S,f,w,Q,H;return d(),v("div",{key:"mobile-"+e.id,class:n(["music-mobile-row",{playing:((B=l(i).currentTrack)==null?void 0:B.id)===e.id}]),onClick:M=>k(g)},[t("div",Ft,[t("img",{class:"music-mobile-art-img",src:c(e),alt:e.title,loading:"lazy",onError:s[9]||(s[9]=M=>M.target.src="/static/img/default-cover.jpg")},null,40,Ut),t("button",{type:"button",class:"music-mobile-art-play","aria-label":((S=l(i).currentTrack)==null?void 0:S.id)===e.id&&l(i).isPlaying?"Pause":"Play",onClick:u(M=>k(g),["stop"])},[t("i",{class:n(((f=l(i).currentTrack)==null?void 0:f.id)===e.id&&l(i).isPlaying?"fas fa-pause":"fas fa-play"),"aria-hidden":"true"},null,2)],8,It)]),t("div",Qt,[U(o,{to:`/music/${e.id}`,class:"music-mobile-title-link",onClick:s[10]||(s[10]=u(()=>{},["stop"]))},{default:N(()=>[t("span",Ht,p(e.title),1)]),_:2},1032,["to"]),t("span",Ot,p(e.artist),1)]),t("div",Gt,[t("div",Xt,p(V(e.duration_seconds)),1),t("div",Jt,[t("button",{type:"button",class:"episode-btn music-mobile-btn music-mobile-play-btn",title:((w=l(i).currentTrack)==null?void 0:w.id)===e.id&&l(i).isPlaying?"Pause":"Play","aria-label":((Q=l(i).currentTrack)==null?void 0:Q.id)===e.id&&l(i).isPlaying?"Pause":"Play",onClick:u(M=>k(g),["stop"])},[t("i",{class:n(((H=l(i).currentTrack)==null?void 0:H.id)===e.id&&l(i).isPlaying?"fas fa-pause":"fas fa-play"),"aria-hidden":"true"},null,2)],8,Kt),t("button",{type:"button",class:"episode-btn queue-btn music-mobile-btn",title:"Add to queue","aria-label":"Add to queue",onClick:u(M=>C(e),["stop"])},[...s[24]||(s[24]=[t("i",{class:"fas fa-plus","aria-hidden":"true"},null,-1)])],8,Wt),t("button",{type:"button",class:"episode-btn boost-btn music-mobile-btn",title:"Boost "+(e.artist||"artist"),"aria-label":"Boost artist",onClick:u(M=>x(e),["stop"])},[...s[25]||(s[25]=[t("i",{class:"fas fa-bolt","aria-hidden":"true"},null,-1)])],8,Zt),t("button",{type:"button",class:n(["episode-btn bm-btn music-mobile-btn",{bookmarked:l(m).isBookmarked({id:e.id})}]),"aria-pressed":l(m).isBookmarked({id:e.id}),title:"Save",onClick:u(M=>h(e),["stop"])},[t("i",{class:n(l(m).isBookmarked({id:e.id})?"fas fa-bookmark":"far fa-bookmark"),"aria-hidden":"true"},null,2)],10,ts)])])],10,zt)}),128))])],512),[[F,$.value==="list"&&!T.value&&b.value.length>0]]),L(t("div",ss,[(d(!0),v(D,null,R(b.value,(e,g)=>{var B,S;return d(),v("div",{key:e.id,class:n(["track-card",{playing:((B=l(i).currentTrack)==null?void 0:B.id)===e.id}])},[t("div",{class:"track-cover",onClick:f=>k(g)},[t("img",{src:c(e),alt:e.title,loading:"lazy",onError:s[11]||(s[11]=f=>f.target.src="/static/img/default-cover.jpg")},null,40,as),t("div",ls,[t("button",{type:"button",class:"play-btn",onClick:u(f=>k(g),["stop"])},[t("i",{class:n(((S=l(i).currentTrack)==null?void 0:S.id)===e.id&&l(i).isPlaying?"fas fa-pause":"fas fa-play")},null,2)],8,is),t("button",{type:"button",class:"track-overlay-btn add-to-playlist-btn",title:"Add to queue",onClick:u(f=>C(e),["stop"])},[...s[26]||(s[26]=[t("i",{class:"fas fa-plus"},null,-1)])],8,os),t("button",{type:"button",class:"track-overlay-btn boost-btn",title:"Boost artist",onClick:u(f=>x(e),["stop"])},[...s[27]||(s[27]=[t("i",{class:"fas fa-bolt","aria-hidden":"true"},null,-1)])],8,ns),t("button",{type:"button",class:"track-overlay-btn bm-btn",title:l(m).isBookmarked({id:e.id})?"Unsave":"Save",onClick:u(f=>h(e),["stop"])},[t("i",{class:n(l(m).isBookmarked({id:e.id})?"fas fa-bookmark":"far fa-bookmark"),"aria-hidden":"true"},null,2)],8,rs)])],8,es),U(o,{to:`/music/${e.id}`,class:"track-info",style:{"text-decoration":"none",color:"inherit"}},{default:N(()=>[t("div",us,p(e.title),1),t("div",ds,p(e.artist),1),t("div",cs,p(V(e.duration_seconds)),1)]),_:2},1032,["to"])],2)}),128))],512),[[F,$.value==="grid"&&!T.value&&b.value.length>0]]),T.value?(d(),v("div",vs,[(d(),v(D,null,R(8,e=>t("div",{key:e,class:"track-card"},[...s[28]||(s[28]=[t("div",{class:"track-cover skeleton"},null,-1),t("div",{class:"track-info"},[t("div",{class:"skeleton",style:{height:"14px",width:"60%","margin-bottom":"6px"}}),t("div",{class:"skeleton",style:{height:"12px",width:"40%","margin-bottom":"4px"}}),t("div",{class:"skeleton",style:{height:"10px",width:"36px"}})],-1)])])),64))])):!T.value&&b.value.length===0?(d(),v("div",ps,[...s[29]||(s[29]=[t("i",{class:"fas fa-music"},null,-1),t("h3",null,"No music found",-1),t("p",null,"Try adjusting your filters or search terms",-1)])])):nt("",!0)])]),_:1})}}},bs=J(fs,[["__scopeId","data-v-a8eab701"]]);export{bs as default};
