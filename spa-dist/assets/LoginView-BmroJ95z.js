import{m as I,g as d,_ as O,a as g,c as y,b as a,n as C,x as T,B as w,C as _,d as N,i as h,t as x,D as U}from"./index-BdyQCXb8.js";import{b as E}from"./useApi-BCqoWMHl.js";const S="ahoy.auth.token",b="ahoy.auth.user",u=d(null),c=d(null),k=d(!1),o=d(null);try{const f=localStorage.getItem(S),v=localStorage.getItem(b);f&&(c.value=f),v&&(u.value=JSON.parse(v))}catch{}function V(){const f=I(()=>!!c.value&&!!u.value),v=I(()=>{var s,r;return((s=u.value)==null?void 0:s.username)||((r=u.value)==null?void 0:r.email)||""});async function n(s,r){k.value=!0,o.value=null;try{const t=await E("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,password:r})});return t.success&&t.token?(c.value=t.token,u.value=t.user||{email:s},localStorage.setItem(S,t.token),localStorage.setItem(b,JSON.stringify(u.value)),{success:!0}):(o.value=t.error||"Login failed",{success:!1,error:o.value})}catch(t){return o.value=t.message||"Network error",{success:!1,error:o.value}}finally{k.value=!1}}async function l(s,r,t){k.value=!0,o.value=null;try{const e=await E("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,password:r,username:t})});return e.success&&e.token?(c.value=e.token,u.value=e.user||{email:s,username:t},localStorage.setItem(S,e.token),localStorage.setItem(b,JSON.stringify(u.value)),{success:!0}):(o.value=e.error||"Signup failed",{success:!1,error:o.value})}catch(e){return o.value=e.message||"Network error",{success:!1,error:o.value}}finally{k.value=!1}}function p(){c.value=null,u.value=null,localStorage.removeItem(S),localStorage.removeItem(b)}function m(){return c.value?{Authorization:`Bearer ${c.value}`}:{}}return{user:u,token:c,loading:k,error:o,isLoggedIn:f,username:v,login:n,signup:l,logout:p,authHeaders:m}}const L={class:"auth-page"},A={class:"auth-card"},B={class:"auth-tabs"},J={key:0,class:"auth-field"},$={class:"auth-field"},z={class:"auth-field"},D={key:1,class:"auth-error"},K=["disabled"],P={key:0,class:"fas fa-spinner fa-spin"},j={key:1},q={__name:"LoginView",setup(f){const v=U(),n=V(),l=d("login"),p=d(""),m=d(""),s=d("");async function r(){let t;l.value==="login"?t=await n.login(p.value,m.value):t=await n.signup(p.value,m.value,s.value),t.success&&(window.dispatchEvent(new CustomEvent("ahoy:toast",{detail:{message:l.value==="login"?"Welcome back!":"Account created!",type:"success"}})),v.push("/"))}return(t,e)=>(g(),y("div",L,[a("div",A,[e[9]||(e[9]=a("div",{class:"auth-logo"},[a("i",{class:"fas fa-anchor",style:{"font-size":"36px",color:"var(--accent-primary,#6ddcff)"}}),a("h1",null,"Ahoy")],-1)),a("div",B,[a("button",{class:C({active:l.value==="login"}),onClick:e[0]||(e[0]=i=>l.value="login")},"Log In",2),a("button",{class:C({active:l.value==="signup"}),onClick:e[1]||(e[1]=i=>l.value="signup")},"Sign Up",2)]),a("form",{onSubmit:T(r,["prevent"]),class:"auth-form"},[l.value==="signup"?(g(),y("div",J,[e[6]||(e[6]=a("label",{for:"username"},"Username",-1)),w(a("input",{id:"username","onUpdate:modelValue":e[2]||(e[2]=i=>s.value=i),type:"text",placeholder:"your name",autocomplete:"username"},null,512),[[_,s.value]])])):N("",!0),a("div",$,[e[7]||(e[7]=a("label",{for:"email"},"Email",-1)),w(a("input",{id:"email","onUpdate:modelValue":e[3]||(e[3]=i=>p.value=i),type:"email",placeholder:"you@example.com",autocomplete:"email",required:""},null,512),[[_,p.value]])]),a("div",z,[e[8]||(e[8]=a("label",{for:"password"},"Password",-1)),w(a("input",{id:"password","onUpdate:modelValue":e[4]||(e[4]=i=>m.value=i),type:"password",placeholder:"••••••••",autocomplete:"current-password",required:""},null,512),[[_,m.value]])]),h(n).error.value?(g(),y("div",D,x(h(n).error.value),1)):N("",!0),a("button",{type:"submit",class:"auth-submit",disabled:h(n).loading.value},[h(n).loading.value?(g(),y("i",P)):(g(),y("span",j,x(l.value==="login"?"Log In":"Create Account"),1))],8,K)],32),a("button",{class:"auth-skip",onClick:e[5]||(e[5]=i=>h(v).push("/"))}," Continue as Guest ")])]))}},Y=O(q,[["__scopeId","data-v-1c7d6772"]]);export{Y as default};
