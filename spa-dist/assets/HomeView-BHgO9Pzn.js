import{u as Z,o as ee,a as D,b as te,w as se,c as d,d as c,e as t,f as S,g as ae,h as k,t as r,i as V,j as ne,k as le,n as L,F as E,r as U,l as B,v as P,m as v,p as ie,q as oe,s as re}from"./index-B3g4hvEb.js";const ue={class:"home-page"},de={class:"live-dashboard"},ce={class:"dashboard-grid"},ve={class:"dash-preview"},he=["src"],fe={class:"dash-overlay"},pe={class:"dash-badges"},me={class:"channel-badge"},we={key:0,class:"channel-nav"},ge={class:"dash-content"},ye={class:"dash-actions"},be={class:"dashboard-sidebar"},ke={class:"dash-thumb"},_e=["src"],Ce={class:"dash-info"},Te={class:"radio-next-list"},Ve={class:"track-title"},Ne={class:"track-artist"},xe={key:0,class:"tv-channel-strip"},Se={class:"tv-channel-strip-list"},Le=["onClick"],Ae={class:"tv-channel-strip-meta"},$e={class:"tv-channel-strip-name"},Ie={class:"tv-channel-strip-now"},je={key:0,class:"tv-channel-strip-next"},Me={class:"whats-new-section"},Re={class:"whats-new-container"},De={class:"whats-new-header"},Ee={key:0,href:"/whats-new",class:"view-all-link"},Ue={class:"whats-new-loading"},Be={class:"whats-new-updates"},Pe=["href"],Fe={class:"whats-new-content"},Oe={class:"whats-new-date"},He={class:"whats-new-empty"},Ke={__name:"HomeView",setup(Qe){const K=re(),f=Z(),h=v([]),_=v(0),n=v(null),w=v(null),N=v({}),A=v({});let $=null;const z={misc:"Channel 01 — Misc",films:"Channel 02 — Short Films","music-videos":"Channel 03 — Music Videos","live-shows":"Channel 04 — Live Shows"};function F(s,e){return z[s.id]||`Channel ${String(e+1).padStart(2,"0")} — ${s.name||"Unknown"}`}function O(){var i,m;const s=new Date().getHours(),e={},l={};for(let u=0;u<h.value.length;u++){const o=h.value[u];if((i=o==null?void 0:o.items)!=null&&i.length){const y=s%o.items.length;e[o.id]=o.items[y],l[o.id]=o.items.length>y+1?o.items[y+1]:o.items[0]}}if(N.value=e,A.value=l,(m=w.value)!=null&&m.id){const u=w.value.id;e[u]&&(n.value=e[u])}}function I(s){var l;if(!h.value.length)return;_.value=(s+h.value.length)%h.value.length;const e=h.value[_.value];w.value={...e,name:F(e,_.value)},N.value[e.id]?n.value=N.value[e.id]:(l=e.items)!=null&&l.length?n.value=e.items[0]:n.value={id:"placeholder",title:"No content available",thumbnail:"/static/img/default-cover.jpg",host:e.name}}function H(s){h.value.length&&I(_.value+(s==="next"?1:-1))}function j(s){!(s!=null&&s.id)||s.id==="placeholder"||s.id==="error"||K.push({path:"/shows",query:{play:s.id}})}const b=v([]),M=v([]),C=v([]),p=v(null),R=oe(()=>{if(!p.value||!f.currentTrack)return!1;const s=String(p.value.id??""),e=String(f.currentTrack.id??"");return s===e&&f.isPlaying});function G(){const s=[...b.value];s.sort(()=>.5-Math.random()),M.value=s.map(e=>({...e,type:"track"})),C.value=M.value.slice(0,20)}function J(){if(R.value){f.pause();return}if(p.value){f.resume();return}const s=M.value[0]||C.value[0];s&&(p.value=s,f.setQueue(b.value,b.value.findIndex(e=>e.id===s.id)))}const g=v([]),T=v(!0);function X(s){if(!s)return"";try{return new Date(s).toLocaleDateString(void 0,{year:"numeric",month:"short"})}catch{return s}}function Y(s){if(s.year&&s.month&&s.section){const e=`/whats-new/${s.year}/${s.month}/${s.section}`;return s.slug?`${e}#update-${s.slug}`:e}return s.link?s.link:"/whats-new"}return ee(async()=>{try{const e=(await D("/api/live-tv/channels").catch(()=>({channels:[]}))).channels||[];if(h.value=e,e.length){const l=e.find(i=>i.id==="misc")||e[0];_.value=e.findIndex(i=>i.id===l.id),O(),I(_.value)}else n.value={id:"placeholder",title:"Loading Live TV...",thumbnail:"/static/img/default-cover.jpg",host:"Ahoy TV"},w.value={id:"misc",name:"Channel 01 — Misc"};$=setInterval(O,60*1e3)}catch{n.value={id:"error",title:"Live TV",thumbnail:"/static/img/default-cover.jpg",host:"Ahoy TV"},w.value={id:"misc",name:"Channel 01 — Misc"}}try{const e=((await D("/api/music").catch(()=>({tracks:[]}))).tracks||[]).filter(i=>i.audio_url||i.preview_url),l=new Set;b.value=e.filter(i=>l.has(i.id)?!1:(l.add(i.id),!0)),G()}catch{}f.currentTrack&&b.value.length&&b.value.some(e=>{var l;return String(e.id)===String((l=f.currentTrack)==null?void 0:l.id)})&&(p.value=f.currentTrack),T.value=!0;try{const e=(await D("/api/whats-new").catch(()=>({updates:[]}))).updates;if(Array.isArray(e))g.value=e.slice(0,4);else if(e&&typeof e=="object"){const l=[];for(const i of Object.keys(e).sort().reverse())for(const m of Object.keys(e[i]||{}).sort().reverse())for(const u of Object.keys(e[i][m]||{})){const o=(e[i][m][u].items||[]).map(y=>({...y,year:i,month:m,section:u}));l.push(...o)}g.value=l.slice(0,4)}else g.value=[]}catch{g.value=[]}finally{T.value=!1}}),te(()=>{$&&clearInterval($)}),se(()=>f.currentTrack,s=>{if(!s)return;b.value.some(l=>String(l.id)===String(s.id))&&(p.value=s)},{deep:!0}),(s,e)=>{var i,m,u,o,y,Q,W,q;const l=ie("router-link");return d(),c("div",ue,[e[22]||(e[22]=t("section",{class:"podcasts-hero"},[t("div",{class:"podcasts-hero-inner"},[t("h1",null,[t("i",{class:"fas fa-home","aria-hidden":"true"}),S(" Home")]),t("p",null,"Explore")])],-1)),t("section",de,[t("div",ce,[t("div",{class:"dashboard-main",role:"button",tabindex:"0",onClick:e[4]||(e[4]=a=>n.value&&n.value.id!=="placeholder"&&n.value.id!=="error"?j(n.value):null),onKeydown:e[5]||(e[5]=ae(k(a=>n.value&&n.value.id!=="placeholder"&&n.value.id!=="error"?j(n.value):null,["prevent"]),["enter"]))},[t("div",ve,[t("img",{src:((i=n.value)==null?void 0:i.thumbnail)||"/static/img/default-cover.jpg",alt:"Live TV",class:"dash-bg"},null,8,he),t("div",fe,[t("div",pe,[e[6]||(e[6]=t("span",{class:"live-badge"},"LIVE TV",-1)),t("span",me,r(((m=w.value)==null?void 0:m.name)||"Channel 01 — Misc"),1)]),h.value.length>1?(d(),c("div",we,[t("button",{type:"button",class:"channel-nav-btn","aria-label":"Previous channel",onClick:e[0]||(e[0]=k(a=>H("prev"),["stop"]))},[...e[7]||(e[7]=[t("i",{class:"fas fa-chevron-left"},null,-1)])]),t("button",{type:"button",class:"channel-nav-btn","aria-label":"Next channel",onClick:e[1]||(e[1]=k(a=>H("next"),["stop"]))},[...e[8]||(e[8]=[t("i",{class:"fas fa-chevron-right"},null,-1)])])])):V("",!0),t("div",ge,[t("h2",null,r(((u=n.value)==null?void 0:u.title)||"Loading..."),1),t("p",null,r(((o=n.value)==null?void 0:o.artist)||((y=n.value)==null?void 0:y.host)||""),1),t("div",ye,[n.value&&n.value.id!=="placeholder"&&n.value.id!=="error"?(d(),c("button",{key:0,type:"button",class:"dash-play-btn",onClick:e[2]||(e[2]=k(a=>j(n.value),["stop"]))},[...e[9]||(e[9]=[t("i",{class:"fas fa-play"},null,-1),S(" Watch Now ",-1)])])):V("",!0),ne(l,{to:"/live-tv",class:"dash-guide-btn",onClick:e[3]||(e[3]=k(()=>{},["stop"]))},{default:le(()=>[...e[10]||(e[10]=[t("i",{class:"fas fa-tv"},null,-1),S(" View All Channels ",-1)])]),_:1})])])])])],32),t("div",be,[e[14]||(e[14]=t("div",{class:"sidebar-header"},[t("h3",null,"Live Radio")],-1)),t("div",{class:L(["dash-item radio-item",{active:R.value}])},[t("div",ke,[t("img",{src:((Q=p.value||C.value[0])==null?void 0:Q.cover_art)||"https://ahoy.ooo/images/Ahoy-Indie-Media-DEFAULT-COVER-A-8.jpg",alt:"Radio"},null,8,_e),e[11]||(e[11]=t("div",{class:"dash-icon"},[t("i",{class:"fas fa-broadcast-tower"})],-1))]),t("div",Ce,[e[12]||(e[12]=t("div",{class:"dash-label"},"On Air Now",-1)),t("h4",null,r(((W=p.value||C.value[0])==null?void 0:W.title)||"Loading..."),1),t("p",null,r(((q=p.value||C.value[0])==null?void 0:q.artist)||""),1)]),t("button",{type:"button",class:"dash-action-btn","aria-label":"Play/Pause radio",onClick:k(J,["stop"])},[t("i",{class:L(R.value?"fas fa-pause":"fas fa-play")},null,2)])],2),t("div",Te,[e[13]||(e[13]=t("div",{class:"list-label"},"Up Next",-1)),(d(!0),c(E,null,U(C.value.slice(0,3),a=>(d(),c("div",{key:a.id,class:"mini-track"},[t("span",Ve,r(a.title),1),t("span",Ne,r(a.artist),1)]))),128))])])]),h.value.length>1?(d(),c("div",xe,[e[16]||(e[16]=t("div",{class:"tv-channel-strip-header"},[t("div",{class:"tv-channel-strip-title"},"Live TV Channels"),t("div",{class:"tv-channel-strip-subtitle"},"Tap a channel to switch")],-1)),t("div",Se,[(d(!0),c(E,null,U(h.value,(a,x)=>(d(),c("button",{key:a.id,type:"button",class:L(["tv-channel-strip-item",{active:w.value&&w.value.id===a.id}]),onClick:k(We=>I(x),["stop"])},[t("div",Ae,[t("span",$e,r(F(a,x)),1),e[15]||(e[15]=t("span",{class:"tv-channel-strip-live"},"LIVE",-1))]),t("div",Ie,r((N.value[a.id]||{}).title||"No content available"),1),A.value[a.id]?(d(),c("div",je," Up next: "+r((A.value[a.id]||{}).title||""),1)):V("",!0)],10,Le))),128))])])):V("",!0)]),t("section",Me,[t("div",Re,[t("div",De,[e[18]||(e[18]=t("h2",null,"What's New at Ahoy",-1)),!T.value&&g.value.length>0?(d(),c("a",Ee,[...e[17]||(e[17]=[S(" View All ",-1),t("i",{class:"fas fa-arrow-right"},null,-1)])])):V("",!0)]),B(t("div",Ue,[...e[19]||(e[19]=[t("span",null,"Loading updates...",-1)])],512),[[P,T.value]]),B(t("div",Be,[(d(!0),c(E,null,U(g.value,(a,x)=>(d(),c("a",{key:a.id||a.title||x,href:Y(a),class:L(["whats-new-item clickable","type-"+(a.type||"update")])},[t("div",Fe,[t("h3",null,r(a.title),1),t("p",null,r(a.description),1),t("span",Oe,r(X(a.date,a.type)),1)]),e[20]||(e[20]=t("div",{class:"whats-new-arrow"},[t("i",{class:"fas fa-chevron-right"})],-1))],10,Pe))),128))],512),[[P,!T.value&&g.value.length>0]]),B(t("div",He,[...e[21]||(e[21]=[t("p",null,"No updates available at this time.",-1),t("a",{href:"/whats-new",class:"view-archive-link"},"View Archive",-1)])],512),[[P,!T.value&&g.value.length===0]])])])])}}};export{Ke as default};
