import{_ as Ne,n as $e,m as d,o as Ae,b as Be,c as v,d as f,e as s,k as ee,g as _,l as te,t as m,x as E,F as S,f as U,G as Fe,C as k,s as ze,E as Ge,a as He,M as Oe,z as F,H as Ke,q as ve}from"./index-Ddfj5B8F.js";const Xe={class:"tv-container"},qe={class:"video-spotlight"},Qe={class:"spotlight-grid"},We={class:"spotlight-left"},Ye={key:0,class:"placeholder-content"},Ie={class:"video-header"},Je={class:"channel-name-label","aria-live":"polite"},Ze={class:"right-dashboard glass hidden-mobile","aria-label":"Channel Dashboard"},je=["src"],et={class:"rd-now"},tt={class:"rd-title"},nt={class:"rd-meta"},st={class:"rd-next"},lt={class:"rd-title"},at={class:"rd-suggested"},ot=["onClick"],it={class:"rd-suggested-name"},rt={ref:"guideRef",class:"live-tv-container guide-flush","aria-label":"TV Guide"},ut={class:"channel-list",role:"listbox","aria-label":"Live TV Channels"},dt=["aria-selected","onClick","onKeydown"],ct={class:"channel-name"},vt={class:"live-tv-main"},ft={class:"mobile-only",style:{padding:"8px 10px"}},mt={class:"guide"},ht={class:"guide-timebar"},gt={class:"guide-rows",role:"grid","aria-label":"Channel Guide"},pt={class:"guide-channel-label"},wt={class:"guide-channel-name"},bt={class:"guide-track"},yt=["onClick","onKeydown","data-row","data-col","aria-label"],Tt={class:"program-title",style:{"font-size":"11px",opacity:"0.9"}},Ct={class:"program-modal"},_t={class:"modal-content"},kt={class:"modal-header"},Mt={class:"modal-title"},Lt={class:"modal-meta"},Dt={class:"modal-badge"},xt={class:"modal-body"},Et={class:"modal-desc"},St={class:"modal-actions"},fe="",ne=6,z=180,Ut=2,Pt={__name:"LiveTVView",setup(Vt){Ke();const P=d(null),p=d(null),g=$e(),c=d([]),h=d(0),G=d(!0),se=d(!1),V=d(!1),R=d(!0);let M=null;const H=d(!1),le=d(0),ae=d(0);function me(e){H.value=!0,le.value=e.pageX-p.value.offsetLeft,ae.value=p.value.scrollLeft,p.value.style.cursor="grabbing"}function he(e){if(!H.value)return;e.preventDefault();const l=(e.pageX-p.value.offsetLeft-le.value)*1.5;p.value.scrollLeft=ae.value-l}function oe(){H.value=!1,p.value&&(p.value.style.cursor="grab")}function L(){R.value=!0,M&&clearTimeout(M),M=setTimeout(()=>{R.value=!1},5e3)}const w=d({}),D=d({row:0,col:0}),O=d(ge());function ge(){const e=new Date,t=1e3*60*30;return new Date(Math.floor(e.getTime()/t)*t)}const pe=F(()=>{const e=Date.now(),t=O.value.getTime();return{left:158+(e-t)/6e4*ne+"px"}}),b=d(null);function ie(e){b.value=e}function K(){b.value=null}function we(e){console.log("Added to saved:",e.title),K()}const X=d([]);let T=null;const x=["#7c66ff","#ff6b6b","#22c55e","#f59e0b"],be=F(()=>{const e=h.value,t=c.value[e];return`Channel ${String(e+1).padStart(2,"0")} — ${(t==null?void 0:t.name)||"Live TV"}`}),ye=F(()=>{const e=[],t=O.value;for(let l=0;l<=z;l+=30){const n=new Date(t.getTime()+l*6e4);e.push(n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}))}return e}),re=F(()=>{w.value;const e={},t=O.value;return new Date(t.getTime()+z*6e4),c.value.forEach((l,n)=>{const o=[],a=l.items||[];if(!a.length){e[n]=o;return}let u=new Date(t),r=0;for(;ue(t,u)<z;){const i=a[r%a.length],y=(i==null?void 0:i.video_url)||(i==null?void 0:i.mp4_link)||(i==null?void 0:i.trailer_url)||"";let Z=Math.max(5,Math.round(((i==null?void 0:i.duration_seconds)||300)/60));const j=new Date(u.getTime()+Z*6e4);o.push({title:(i==null?void 0:i.title)||"Untitled",thumbnail:Te(i,y),category:(i==null?void 0:i.category)||l.name||"Show",durMin:Z,widthPx:Z*ne,timeLabel:`${de(u)} – ${de(j)}`,startUTC:u.getTime(),endUTC:j.getTime(),src:y,item:i}),u=j,r++}e[n]=o}),e});function ue(e,t){return Math.round((t.getTime()-e.getTime())/6e4)}function de(e){return e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function q(e){return e&&e.replace(/\[[^\]]*\]/g,"").replace(/\([^)]*\)/g,"").trim()||"Untitled"}function Q(e){return(e==null?void 0:e.video_url)||(e==null?void 0:e.mp4_link)||(e==null?void 0:e.trailer_url)||""}function Te(e,t){if(e!=null&&e.thumbnail)return e.thumbnail;const l=t||Q(e);return l&&w.value[l]?w.value[l]:fe}const N=[];let W=0;function Ce(e){return new Promise((t,l)=>{if(!e||typeof e!="string"){l(new Error("Invalid video URL"));return}const n=document.createElement("video");n.muted=!0,n.playsInline=!0,n.crossOrigin="anonymous",n.preload="metadata";const o=setTimeout(()=>{n.src="",n.load(),l(new Error("Timeout"))},15e3);n.onerror=()=>{clearTimeout(o),l(new Error("Video load failed"))},n.onloadeddata=()=>{const a=Math.min(1,Math.max(0,n.duration?n.duration*.05:1));n.currentTime=a},n.onseeked=()=>{clearTimeout(o);try{const a=document.createElement("canvas"),u=320,r=Math.round(n.videoHeight/n.videoWidth*u)||180;a.width=u,a.height=r;const i=a.getContext("2d");if(!i){t(null);return}i.drawImage(n,0,0,u,r);const y=a.toDataURL("image/jpeg",.85);n.src="",n.load(),t(y)}catch(a){l(a)}},n.src=e,n.load().catch(()=>l(new Error("Load failed")))})}function Y(){if(W>=Ut||N.length===0)return;const e=N.shift();if(w.value[e]){Y();return}W++,Ce(e).then(t=>{t&&(w.value={...w.value,[e]:t})}).catch(()=>{}).finally(()=>{W--,Y()})}function _e(e){!e||w.value[e]||N.includes(e)||(N.push(e),Y())}function ke(){const e=[],t=new Date;c.value.forEach((l,n)=>{const o=l.items||[];if(!o.length)return;let a=new Date(t),u=0;for(;ue(t,a)<z;){const r=o[u%o.length],i=Math.max(5,Math.round(((r==null?void 0:r.duration_seconds)||300)/60)),y=new Date(a.getTime()+i*6e4);e.push({startUTC:a.getTime(),endUTC:y.getTime(),row:n,col:u,title:(r==null?void 0:r.title)||"Program",category:(r==null?void 0:r.category)||l.name||"Show",src:Q(r),thumb:(r==null?void 0:r.thumbnail)||"",durationSec:i*60}),a=y,u++}}),e.sort((l,n)=>l.startUTC-n.startUTC),X.value=e}function I(e){const t=Date.now();for(const l of X.value)if(!(e!=null&&l.row!==e)&&t>=l.startUTC&&t<l.endUTC)return l;return null}function Me(e){const t=Date.now();let l=null;for(const n of X.value)e!=null&&n.row!==e||n.startUTC>t&&(!l||n.startUTC<l.startUTC)&&(l=n);return l}function Le(){var n;const e=I(h.value);if(!e||!e.src)return;const t=c.value[h.value],l={type:"live_tv",id:`live_tv-${(t==null?void 0:t.id)??h.value}`,title:e.title||"Live TV",host:(t==null?void 0:t.name)||"Live TV",thumbnail:e.thumb,video_url:e.src,duration_seconds:e.durationSec};((n=g.currentTrack)==null?void 0:n.video_url)!==e.src&&g.play(l)}function De(){const e=I(h.value),t=Me(h.value);e&&(nowTitle.value=q(e.title),nowMeta.value=e.category||"",nowThumb.value=e.thumb||w.value[e.src]||fe),upNextTitle.value=t?q(t.title):"—"}function xe(){const e=I(h.value);if(!e){progressPct.value=0;return}const t=Date.now();progressPct.value=Math.max(0,Math.min(100,(t-e.startUTC)/(e.endUTC-e.startUTC)*100))}function J(){Le(),De(),xe()}function Ee(){var t,l,n;const e=videoEl.value||document.documentElement;document.fullscreenElement?(n=document.exitFullscreen)==null||n.call(document):(l=(t=e==null?void 0:e.requestFullscreen)==null?void 0:t.call(e))==null||l.catch(()=>{})}function Se(){const e=c.value.length;if(!e)return;const t=(h.value+1)%e;C(t)}function Ue(){const e=c.value.length;if(!e)return;const t=(h.value-1+e)%e;C(t)}function C(e){h.value=e,J()}function Pe(){var e;(e=guideRef.value)==null||e.scrollIntoView({behavior:"smooth",block:"start"})}function $(e,t){D.value={row:e,col:t}}function ce(e){var a;if(!guideRef.value)return;const t=guideRef.value.getBoundingClientRect();if(t.bottom<0||t.top>window.innerHeight)return;const l=c.value.length;if(!l)return;const{row:n,col:o}=D.value;if(e.key==="ArrowUp")e.preventDefault(),$(Math.max(0,n-1),o);else if(e.key==="ArrowDown")e.preventDefault(),$(Math.min(l-1,n+1),o);else if(e.key==="ArrowRight"){e.preventDefault();const u=(((a=re.value[n])==null?void 0:a.length)||1)-1;$(n,Math.min(u,o+1))}else e.key==="ArrowLeft"?(e.preventDefault(),$(n,Math.max(0,o-1))):e.key==="Enter"&&(e.preventDefault(),C(D.value.row))}function Ve(e){var l;const t=(e==null?void 0:e.channels)??((l=e==null?void 0:e.data)==null?void 0:l.channels)??[];return Array.isArray(t)?t.map(n=>({...n,id:(n==null?void 0:n.id)??"misc",name:(n==null?void 0:n.name)??"Channel",items:Array.isArray(n==null?void 0:n.items)?n.items:[]})):[]}async function Re(){G.value=!0,se.value=!1,T&&(clearInterval(T),T=null);let e=null;try{e=await Ge("/api/live-tv/channels?_="+Date.now())}catch{try{e=await He("/api/live-tv/channels")}catch{se.value=!0,c.value=[],G.value=!1;return}}c.value=Ve(e||{}),c.value.forEach((t,l)=>{if(!t.items||t.items.length===0){const n=[],o=["Broadcast","Live Segment","Commercial Break","Station ID"];for(let a=0;a<24;a++)n.push({title:o[a%o.length]+" #"+(a+1),duration_seconds:3600,category:t.name});t.items=n}}),c.value.length&&(ke(),J(),T=setInterval(J,1e3),Oe(()=>{c.value.forEach(t=>{(t.items||[]).forEach(l=>{const n=Q(l);n&&!(l!=null&&l.thumbnail)&&_e(n)})})})),G.value=!1}let A=null;function B(){if(P.value){const e=P.value.getBoundingClientRect();g.setHeroBounds({top:e.top+window.scrollY,left:e.left+window.scrollX,width:e.width,height:e.height})}}return Ae(async()=>{document.addEventListener("keydown",ce),window.addEventListener("mousemove",L),window.addEventListener("touchstart",L),L(),await Re(),B(),window.ResizeObserver&&(A=new ResizeObserver(B),A.observe(P.value)),window.addEventListener("resize",B)}),Be(()=>{T&&clearInterval(T),M&&clearTimeout(M),window.removeEventListener("mousemove",L),window.removeEventListener("touchstart",L),document.removeEventListener("keydown",ce),window.removeEventListener("resize",B),A&&A.disconnect(),g.setHeroBounds(null)}),(e,t)=>{var l;return v(),f("div",Xe,[t[22]||(t[22]=s("section",{class:"podcasts-hero"},[s("div",{class:"podcasts-hero-inner"},[s("h1",null,[s("i",{class:"fas fa-tv","aria-hidden":"true"}),ee(" Live TV ")]),s("p",null,"Channel surf and watch live programming.")])],-1)),s("div",qe,[s("div",Qe,[s("div",We,[s("div",{ref_key:"heroPlaceholder",ref:P,class:"panelstream-player hero-player"},[!_(g).currentTrack||_(g).mode!=="video"?(v(),f("div",Ye,[...t[6]||(t[6]=[s("i",{class:"fas fa-tv fa-3x",style:{opacity:"0.2","margin-bottom":"20px"}},null,-1),s("span",null,"Select a channel to start watching",-1)])])):te("",!0),s("div",Ie,[t[7]||(t[7]=s("span",{class:"now-playing-label"},"Now Playing",-1)),s("span",Je,m(be.value),1)]),t[8]||(t[8]=s("div",{class:"hero-glass"},null,-1))],512),s("div",{class:E(["channel-remote remote-below",{"vibes-hidden":!R.value}]),"aria-label":"Channel Controls"},[s("button",{type:"button",class:"remote-btn",title:"Play/Pause",onClick:t[0]||(t[0]=n=>_(g).togglePlay())},[s("i",{class:E(_(g).isPlaying?"fas fa-pause":"fas fa-play")},null,2)]),s("button",{type:"button",class:"remote-btn",title:"Mute",onClick:t[1]||(t[1]=n=>_(g).toggleMute())},[s("i",{class:E(_(g).isMuted?"fas fa-volume-mute":"fas fa-volume-up")},null,2)]),s("button",{type:"button",class:"remote-btn",title:"Fullscreen",onClick:Ee},[...t[9]||(t[9]=[s("i",{class:"fas fa-expand"},null,-1)])]),s("button",{type:"button",class:"remote-btn",title:"Go to Guide",onClick:Pe},[...t[10]||(t[10]=[s("i",{class:"fas fa-list"},null,-1)])]),s("button",{type:"button",class:"remote-btn",title:"Channel Up",onClick:Se},[...t[11]||(t[11]=[s("i",{class:"fas fa-chevron-up"},null,-1)])]),s("button",{type:"button",class:"remote-btn",title:"Channel Down",onClick:Ue},[...t[12]||(t[12]=[s("i",{class:"fas fa-chevron-down"},null,-1)])]),s("button",{type:"button",class:"remote-btn hide-vibes-btn",title:"Hide Controls",onClick:t[2]||(t[2]=n=>R.value=!1)},[...t[13]||(t[13]=[s("i",{class:"fas fa-eye-slash"},null,-1)])])],2)]),s("aside",Ze,[s("img",{src:e.nowThumb,alt:"",class:"rd-thumb"},null,8,je),s("div",et,[t[14]||(t[14]=s("div",{class:"rd-label"},"Playing Now",-1)),s("div",tt,m(e.nowTitle),1),s("div",nt,[s("span",null,m(e.nowMeta),1)])]),s("div",st,[t[15]||(t[15]=s("div",{class:"rd-label"},"Up Next",-1)),s("div",lt,m(e.upNextTitle),1)]),s("div",at,[t[17]||(t[17]=s("div",{class:"rd-suggested-title"},"Suggested for You",-1)),(v(!0),f(S,null,U(c.value.slice(0,4),(n,o)=>(v(),f("div",{key:n.id,class:"rd-suggested-item",onClick:a=>C(o)},[s("span",{class:"rd-suggested-dot",style:k({background:x[o%4]})},null,4),s("span",it,m(n.name),1),t[16]||(t[16]=s("span",{class:"rd-suggested-meta"},"Live",-1))],8,ot))),128))])])])]),s("div",rt,[s("aside",{class:E(["live-tv-sidebar",{open:V.value}]),"aria-label":"Channels"},[s("ul",ut,[(v(!0),f(S,null,U(c.value,(n,o)=>(v(),f("li",{key:n.id,class:"channel-item",role:"option","aria-selected":String(h.value===o),tabindex:"0",onClick:a=>C(o),onKeydown:ve(a=>C(o),["enter"])},[s("span",{class:"channel-pill",style:k({background:x[o%4]})},null,4),s("span",ct,m(n.name),1)],40,dt))),128))])],2),s("section",vt,[s("div",ft,[s("button",{class:"channels-btn",type:"button",onClick:t[3]||(t[3]=n=>V.value=!0)},[...t[18]||(t[18]=[s("i",{class:"fas fa-list"},null,-1),ee(" Channels ",-1)])])]),s("div",mt,[t[19]||(t[19]=Fe('<div class="guide-header" data-v-7905711e><div data-v-7905711e>Guide</div><div class="kbd-hint" aria-hidden="true" data-v-7905711e><span data-v-7905711e>Navigate</span><span class="kbd" data-v-7905711e>↑</span><span class="kbd" data-v-7905711e>↓</span><span class="kbd" data-v-7905711e>←</span><span class="kbd" data-v-7905711e>→</span></div></div>',1)),s("div",ht,[(v(!0),f(S,null,U(ye.value,n=>(v(),f("div",{key:n,class:"time-marker",style:k({minWidth:30*ne+"px"})},m(n),5))),128))]),s("div",{class:"guide-scroller",ref_key:"scrollerRef",ref:p,onMousedown:me,onMousemove:he,onMouseup:oe,onMouseleave:oe},[s("div",gt,[s("div",{class:"now-line",style:k(pe.value)},null,4),(v(!0),f(S,null,U(c.value,(n,o)=>(v(),f("div",{key:n.id,class:"guide-row",role:"row"},[s("div",pt,[s("div",{class:"guide-channel-icon",style:k({background:x[o%4]})},null,4),s("div",wt,m(n.name),1)]),s("div",bt,[(v(!0),f(S,null,U(re.value[o]||[],(a,u)=>(v(),f("div",{key:o+"-"+u,class:E(["program",{selected:D.value.row===o&&D.value.col===u}]),onClick:r=>ie(a),onKeydown:ve(r=>ie(a),["enter"]),"data-row":o,"data-col":u,tabindex:"0",role:"gridcell","aria-label":a.title+" • "+a.durMin+" min",style:k({width:a.widthPx+"px",background:x[o%4],boxShadow:"0 0 10px "+x[o%4]+"66, inset 0 0 5px rgba(255,255,255,0.2)"})},[s("div",Tt,m(a.title),1)],46,yt))),128))])]))),128))])],544)])]),V.value?(v(),f("div",{key:0,class:"ltv-overlay",onClick:t[4]||(t[4]=n=>V.value=!1)})):te("",!0),b.value?(v(),f("div",{key:1,class:"program-modal-overlay",onClick:ze(K,["self"])},[s("div",Ct,[s("button",{class:"close-btn",onClick:K,"aria-label":"Close"},[...t[20]||(t[20]=[s("i",{class:"fas fa-times"},null,-1)])]),s("div",_t,[s("div",kt,[s("h2",Mt,m(q(b.value.title)),1),s("div",Lt,[s("span",Dt,m(b.value.category),1),s("span",null,m(b.value.durMin)+" min",1)])]),s("div",xt,[s("p",Et,m(((l=b.value.item)==null?void 0:l.description)||"No description available for this program."),1),s("div",St,[s("button",{class:"action-btn primary",onClick:t[5]||(t[5]=n=>we(b.value))},[...t[21]||(t[21]=[s("i",{class:"fas fa-plus"},null,-1),ee(" Add to Saved ",-1)])])])])])])])):te("",!0)],512)])}}},Nt=Ne(Pt,[["__scopeId","data-v-7905711e"]]);export{Nt as default};
