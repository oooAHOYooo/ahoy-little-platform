import{_ as We,o as Oe,k as ze,b as c,c as d,d as l,h as D,t as u,p as F,C as y,F as x,e as P,i as C,G as Qe,E as qe,a as Xe,M as Je,j as h,s as J,L as Ye,m as _e}from"./index-DKIbx5E3.js";const Ze={class:"tv-container"},je={class:"video-spotlight"},Ie={class:"spotlight-grid"},et={class:"spotlight-left"},tt={class:"panelstream-player hero-player"},nt={class:"video-header"},st={class:"channel-name-label","aria-live":"polite"},lt={class:"channel-remote remote-below","aria-label":"Channel Controls"},at={class:"playing-now glass"},ot=["src"],it={class:"now-col"},rt={class:"np-title"},ut={class:"np-sub"},ct={class:"next-col"},dt={class:"np-next"},vt={class:"ltv-progress-wrap"},ht={class:"right-dashboard glass hidden-mobile","aria-label":"Channel Dashboard"},ft=["src"],mt={class:"rd-now"},pt={class:"rd-title"},gt={class:"rd-meta"},bt={class:"rd-next"},yt={class:"rd-title"},_t={id:"channel-selector"},wt={key:1,class:"channel-selector-empty"},Tt={class:"channel-selector-empty-text"},kt={key:0,class:"channel-selector-empty-hint"},Ct=["onClick","onMouseenter"],Mt={class:"channel-sideways-text"},Ut={class:"channel-content"},Dt={class:"cc-header"},Et={key:0,class:"cc-status"},St={key:1,class:"cc-time"},Lt={class:"cc-program"},xt={class:"cc-title"},Pt={key:0,class:"cc-meta"},Vt={key:0,class:"cc-up-next"},Nt={key:1,class:"cc-progress-track"},$t=["src"],Rt={class:"live-tv-channel-preview-title"},At={class:"live-tv-channel-preview-meta"},Ft={class:"channel-list",role:"listbox","aria-label":"Live TV Channels"},Gt=["aria-selected","onClick","onKeydown"],Bt={class:"channel-name"},Ht={class:"live-tv-main"},Kt={class:"mobile-only",style:{padding:"8px 10px"}},Wt={class:"guide"},Ot={class:"guide-timebar"},zt={class:"guide-scroller"},Qt={class:"guide-rows",role:"grid","aria-label":"Channel Guide"},qt={class:"guide-channel-label"},Xt={class:"guide-channel-name"},Jt={class:"guide-track"},Yt=["data-row","data-col","aria-label","onClick","onKeydown"],Zt=["src","alt"],jt={class:"program-title"},It={class:"program-meta"},G="",we=6,ae=180,en=2,tn={__name:"LiveTVView",setup(nn){const _=h(null),B=h(null),v=h([]),m=h(0),H=h(!0),K=h(!1),V=h(!1),N=h(!0),Y=h("Live"),Z=h("—"),j=h(G),I=h("—"),ee=h(0),W=h(!1),b=h({}),$=h({row:0,col:0}),Te=J(()=>({left:"158px"})),w=h({visible:!1,x:0,y:0,thumb:"",title:"",meta:""});let E=null;const O=h([]);let z="",S=null;const R=["#7c66ff","#ff6b6b","#22c55e","#f59e0b"],oe=J(()=>{const e=m.value,t=v.value[e];return`Channel ${String(e+1).padStart(2,"0")} — ${(t==null?void 0:t.name)||"Live TV"}`}),ke=J(()=>{const e=[],t=new Date;for(let s=0;s<=ae;s+=30){const n=new Date(t.getTime()+s*6e4);e.push(n.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}))}return e}),ie=J(()=>{b.value;const e={},t=new Date;return v.value.forEach((s,n)=>{const a=[];let o=new Date(t),f=0;const r=s.items||[];if(!r.length){e[n]=a;return}for(;re(t,o)<ae;){const i=r[f%r.length],g=(i==null?void 0:i.video_url)||(i==null?void 0:i.mp4_link)||(i==null?void 0:i.trailer_url)||"",T=Math.max(5,Math.round(((i==null?void 0:i.duration_seconds)||300)/60)),U=new Date(o.getTime()+T*6e4);a.push({title:(i==null?void 0:i.title)||"Untitled",thumbnail:ne(i,g),category:(i==null?void 0:i.category)||s.name||"Show",durMin:T,widthPx:T*we,timeLabel:`${te(o)} – ${te(U)}`,startUTC:o.getTime(),endUTC:U.getTime(),src:g,item:i}),o=U,f++}e[n]=a}),e});function re(e,t){return Math.round((t.getTime()-e.getTime())/6e4)}function te(e){return e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function M(e){return e&&e.replace(/\[[^\]]*\]/g,"").replace(/\([^)]*\)/g,"").trim()||"Untitled"}function A(e){return(e==null?void 0:e.video_url)||(e==null?void 0:e.mp4_link)||(e==null?void 0:e.trailer_url)||""}function ne(e,t){if(e!=null&&e.thumbnail)return e.thumbnail;const s=t||A(e);return s&&b.value[s]?b.value[s]:G}const Q=[];let se=0;function Ce(e){return new Promise((t,s)=>{if(!e||typeof e!="string"){s(new Error("Invalid video URL"));return}const n=document.createElement("video");n.muted=!0,n.playsInline=!0,n.crossOrigin="anonymous",n.preload="metadata";const a=setTimeout(()=>{n.src="",n.load(),s(new Error("Timeout"))},15e3);n.onerror=()=>{clearTimeout(a),s(new Error("Video load failed"))},n.onloadeddata=()=>{const o=Math.min(1,Math.max(0,n.duration?n.duration*.05:1));n.currentTime=o},n.onseeked=()=>{clearTimeout(a);try{const o=document.createElement("canvas"),f=320,r=Math.round(n.videoHeight/n.videoWidth*f)||180;o.width=f,o.height=r;const i=o.getContext("2d");if(!i){t(null);return}i.drawImage(n,0,0,f,r);const g=o.toDataURL("image/jpeg",.85);n.src="",n.load(),t(g)}catch(o){s(o)}},n.src=e,n.load().catch(()=>s(new Error("Load failed")))})}function le(){if(se>=en||Q.length===0)return;const e=Q.shift();if(b.value[e]){le();return}se++,Ce(e).then(t=>{t&&(b.value={...b.value,[e]:t})}).catch(()=>{}).finally(()=>{se--,le()})}function Me(e){!e||b.value[e]||Q.includes(e)||(Q.push(e),le())}function Ue(){const e=[],t=new Date;v.value.forEach((s,n)=>{const a=s.items||[];if(!a.length)return;let o=new Date(t),f=0;for(;re(t,o)<ae;){const r=a[f%a.length],i=Math.max(5,Math.round(((r==null?void 0:r.duration_seconds)||300)/60)),g=new Date(o.getTime()+i*6e4);e.push({startUTC:o.getTime(),endUTC:g.getTime(),row:n,col:f,title:(r==null?void 0:r.title)||"Program",category:(r==null?void 0:r.category)||s.name||"Show",src:A(r),thumb:(r==null?void 0:r.thumbnail)||"",durationSec:i*60}),o=g,f++}}),e.sort((s,n)=>s.startUTC-n.startUTC),O.value=e}function p(e){const t=Date.now();for(const s of O.value)if(!(e!=null&&s.row!==e)&&t>=s.startUTC&&t<s.endUTC)return s;return null}function q(e){const t=Date.now();let s=null;for(const n of O.value)e!=null&&n.row!==e||n.startUTC>t&&(!s||n.startUTC<s.startUTC)&&(s=n);return s}function ue(e){const t=Math.max(0,Date.now()-e.startUTC);return Math.max(0,Math.min(Math.floor(t/1e3),e.durationSec-1))}function De(){const e=_.value;if(!e||!O.value.length)return;const t=p(m.value);if(!t||!t.src)return;const s=t.src!==z,n=ue(t);if(s){z=t.src;try{e.pause()}catch{}e.src=t.src;try{e.load()}catch{}e.currentTime=n,e.muted=!0,N.value=!0,e.play().catch(()=>{});const a=v.value[m.value];Ye({id:`live_tv-${(a==null?void 0:a.id)??m.value}-${t.startUTC}`,type:"live_tv",title:t.title||"Live TV",host:(a==null?void 0:a.name)||oe.value,thumbnail:t.thumb,url:t.src})}else if(Math.abs((e.currentTime||0)-n)>3)try{e.currentTime=n}catch{}}function Ee(){const e=p(m.value),t=q(m.value);e&&(Y.value=M(e.title),Z.value=e.category||"",j.value=e.thumb||b.value[e.src]||G),I.value=t?M(t.title):"—"}function Se(){const e=p(m.value);if(!e){ee.value=0;return}const t=Date.now();ee.value=Math.max(0,Math.min(100,(t-e.startUTC)/(e.endUTC-e.startUTC)*100))}function X(){De(),Ee(),Se()}function ce(){const e=p(m.value);if(!e)return;const t=_.value;if(!t)return;const s=ue(e);try{Math.abs((t.currentTime||0)-s)>2&&(t.currentTime=s)}catch{}}function Le(){V.value=!1;const e=q(m.value);if(!e)return;const t=()=>{z="",X()},s=Date.now();s<e.startUTC?setTimeout(t,Math.max(0,e.startUTC-s+50)):t()}function xe(){_.value&&(V.value?_.value.pause():_.value.play().catch(()=>{}))}function Pe(){_.value&&(N.value=!N.value,_.value.muted=N.value)}function Ve(){var t,s,n;const e=_.value||document.documentElement;document.fullscreenElement?(n=document.exitFullscreen)==null||n.call(document):(s=(t=e==null?void 0:e.requestFullscreen)==null?void 0:t.call(e))==null||s.catch(()=>{})}function Ne(){const e=v.value.length;if(!e)return;const t=(m.value+1)%e;k(t)}function $e(){const e=v.value.length;if(!e)return;const t=(m.value-1+e)%e;k(t)}function k(e){m.value=e,z="",X()}function Re(){var e;(e=B.value)==null||e.scrollIntoView({behavior:"smooth",block:"start"})}function Ae(e){var n;const t=p(e);if(t)return M(t.title);const s=v.value[e];return(n=s==null?void 0:s.items)!=null&&n.length?M(s.items[0].title):"Off Air"}function Fe(e){const t=p(e);if(!t)return 0;const s=Date.now();return Math.max(0,Math.min(100,(s-t.startUTC)/(t.endUTC-t.startUTC)*100))}function Ge(e){var n;const t=p(e),s=v.value[e];return t?t.thumb||b.value[t.src]||null:(n=s==null?void 0:s.items)!=null&&n.length?ne(s.items[0],A(s.items[0])):null}function Be(e){const t=Ge(e);return t&&t!==G?{backgroundImage:`url(${t})`}:{background:`linear-gradient(135deg, ${R[e%4]}22 0%, #111 60%)`,opacity:.8}}function He(e,t){de(),E=setTimeout(()=>{var fe,me,pe,ge,be,ye;const s=v.value[t];if(!s)return;const n=p(t),a=(n==null?void 0:n.src)||A((fe=s.items)==null?void 0:fe[0]),o=n?n.thumb||b.value[n.src]||G:ne((me=s.items)==null?void 0:me[0],a),f=M(n?n.title:(ge=(pe=s.items)==null?void 0:pe[0])==null?void 0:ge.title),r=(n==null?void 0:n.category)||((ye=(be=s.items)==null?void 0:be[0])==null?void 0:ye.category)||s.name||"",i=e.target.closest(".channel-button").getBoundingClientRect(),g=280;let T=i.left+i.width/2-g/2,U=i.top-12;T<12&&(T=12),T+g>window.innerWidth-12&&(T=window.innerWidth-g-12),U<12&&(U=i.bottom+12),w.value={visible:!0,x:T,y:U,thumb:o,title:f,meta:r}},1e3)}function de(){E&&(clearTimeout(E),E=null),w.value={...w.value,visible:!1}}function L(e,t){$.value={row:e,col:t}}function ve(e){var o;if(!B.value)return;const t=B.value.getBoundingClientRect();if(t.bottom<0||t.top>window.innerHeight)return;const s=v.value.length;if(!s)return;const{row:n,col:a}=$.value;if(e.key==="ArrowUp")e.preventDefault(),L(Math.max(0,n-1),a);else if(e.key==="ArrowDown")e.preventDefault(),L(Math.min(s-1,n+1),a);else if(e.key==="ArrowRight"){e.preventDefault();const f=(((o=ie.value[n])==null?void 0:o.length)||1)-1;L(n,Math.min(f,a+1))}else e.key==="ArrowLeft"?(e.preventDefault(),L(n,Math.max(0,a-1))):e.key==="Enter"&&(e.preventDefault(),k($.value.row))}function Ke(e){var s;const t=(e==null?void 0:e.channels)??((s=e==null?void 0:e.data)==null?void 0:s.channels)??[];return Array.isArray(t)?t.map(n=>({...n,id:(n==null?void 0:n.id)??"misc",name:(n==null?void 0:n.name)??"Channel",items:Array.isArray(n==null?void 0:n.items)?n.items:[]})):[]}async function he(){H.value=!0,K.value=!1,S&&(clearInterval(S),S=null);let e=null;try{e=await qe("/api/live-tv/channels?_="+Date.now())}catch{try{e=await Xe("/api/live-tv/channels")}catch{K.value=!0,v.value=[],H.value=!1;return}}v.value=Ke(e||{}),v.value.length&&(Ue(),X(),S=setInterval(X,1e3),Je(()=>{v.value.forEach(t=>{(t.items||[]).forEach(s=>{const n=A(s);n&&!(s!=null&&s.thumbnail)&&Me(n)})})})),H.value=!1}return Oe(async()=>{document.addEventListener("keydown",ve),await he()}),ze(()=>{S&&clearInterval(S),E&&clearTimeout(E),document.removeEventListener("keydown",ve)}),(e,t)=>(c(),d("div",Ze,[t[21]||(t[21]=l("section",{class:"podcasts-hero"},[l("div",{class:"podcasts-hero-inner"},[l("h1",null,[l("i",{class:"fas fa-tv","aria-hidden":"true"}),D(" Live TV ")]),l("p",null,"Channel surf and watch live programming.")])],-1)),l("div",je,[l("div",Ie,[l("div",et,[l("div",tt,[l("video",{ref_key:"videoEl",ref:_,controls:"",autoplay:"",muted:"",playsinline:"","webkit-playsinline":"",onPlay:t[0]||(t[0]=s=>V.value=!0),onPause:t[1]||(t[1]=s=>V.value=!1),onEnded:Le,onError:ce,onStalled:ce},null,544),l("div",nt,[t[4]||(t[4]=l("span",{class:"now-playing-label"},"Now Playing",-1)),l("span",st,u(oe.value),1)]),t[5]||(t[5]=l("div",{class:"hero-glass"},null,-1))]),l("div",lt,[l("button",{type:"button",class:"remote-btn",title:"Play/Pause",onClick:xe},[l("i",{class:F(V.value?"fas fa-pause":"fas fa-play")},null,2)]),l("button",{type:"button",class:"remote-btn",title:"Mute",onClick:Pe},[l("i",{class:F(N.value?"fas fa-volume-mute":"fas fa-volume-up")},null,2)]),l("button",{type:"button",class:"remote-btn",title:"Fullscreen",onClick:Ve},[...t[6]||(t[6]=[l("i",{class:"fas fa-expand"},null,-1)])]),l("button",{type:"button",class:"remote-btn",title:"Go to Guide",onClick:Re},[...t[7]||(t[7]=[l("i",{class:"fas fa-list"},null,-1)])]),l("button",{type:"button",class:"remote-btn",title:"Channel Up",onClick:Ne},[...t[8]||(t[8]=[l("i",{class:"fas fa-chevron-up"},null,-1)])]),l("button",{type:"button",class:"remote-btn",title:"Channel Down",onClick:$e},[...t[9]||(t[9]=[l("i",{class:"fas fa-chevron-down"},null,-1)])])]),l("div",at,[l("img",{src:j.value,alt:""},null,8,ot),l("div",it,[l("div",rt,u(Y.value),1),l("div",ut,u(Z.value),1)]),l("div",ct,[t[10]||(t[10]=l("div",{class:"np-label"},"Up Next",-1)),l("div",dt,u(I.value),1)]),l("div",vt,[l("div",{class:"ltv-progress",style:y({width:ee.value+"%"})},null,4)])])]),l("aside",ht,[l("img",{src:j.value,alt:"",class:"rd-thumb"},null,8,ft),l("div",mt,[t[11]||(t[11]=l("div",{class:"rd-label"},"Playing Now",-1)),l("div",pt,u(Y.value),1),l("div",gt,[l("span",null,u(Z.value),1)])]),l("div",bt,[t[12]||(t[12]=l("div",{class:"rd-label"},"Up Next",-1)),l("div",yt,u(I.value),1)])])])]),l("div",_t,[H.value?(c(),d(x,{key:0},P(4,s=>l("div",{key:"skeleton-"+s,class:"channel-button",style:{"pointer-events":"none"}},[...t[13]||(t[13]=[l("div",{class:"skeleton",style:{height:"20px",width:"70%","margin-bottom":"8px"}},null,-1),l("div",{class:"skeleton",style:{height:"14px",width:"50%"}},null,-1)])])),64)):v.value.length===0?(c(),d("div",wt,[l("p",Tt,u(K.value?"Couldn't load channels":"No channels available"),1),K.value?(c(),d("p",kt,"Check your connection and try again.")):C("",!0),l("button",{type:"button",class:"channel-selector-retry",onClick:he},[...t[14]||(t[14]=[l("i",{class:"fas fa-sync-alt"},null,-1),D(" Retry ",-1)])])])):(c(!0),d(x,{key:2},P(v.value,(s,n)=>(c(),d("button",{key:s.id,type:"button",class:F(["channel-button",{active:m.value===n}]),onClick:a=>k(n),onMouseenter:a=>He(a,n),onMouseleave:de},[l("div",{class:"channel-strip",style:y({"--strip-color":R[n%4]})},[l("div",Mt,[D(" CH "+u(String(n+1).padStart(2,"0"))+" ",1),t[15]||(t[15]=l("span",{class:"bullet"},"•",-1)),D(" "+u(s.name),1)])],4),l("div",Ut,[l("div",Dt,[m.value===n?(c(),d("div",Et,[...t[16]||(t[16]=[l("span",{class:"pulsing-dot"},null,-1),D(" WATCHING ",-1)])])):C("",!0),p(n)?(c(),d("div",St,u(te(new Date(p(n).startUTC))),1)):C("",!0)]),l("div",Lt,[l("div",xt,u(Ae(n)),1),p(n)?(c(),d("div",Pt,u(p(n).category||s.name),1)):C("",!0)]),q(n)?(c(),d("div",Vt,[t[17]||(t[17]=l("span",{class:"un-label"},"Next:",-1)),D(" "+u(M(q(n).title)),1)])):C("",!0),p(n)?(c(),d("div",Nt,[l("div",{class:"cc-progress-fill",style:y({width:Fe(n)+"%",background:R[n%4]})},null,4)])):C("",!0)]),l("div",{class:"channel-bg-image",style:y(Be(n))},null,4),t[18]||(t[18]=l("div",{class:"channel-bg-overlay"},null,-1))],42,Ct))),128))]),w.value.visible?(c(),d("div",{key:0,class:"live-tv-channel-preview visible",style:y({left:w.value.x+"px",top:w.value.y+"px"}),"aria-hidden":"true"},[l("img",{src:w.value.thumb,alt:""},null,8,$t),l("div",Rt,u(w.value.title),1),l("div",At,u(w.value.meta),1)],4)):C("",!0),l("div",{ref_key:"guideRef",ref:B,class:"live-tv-container","aria-label":"TV Guide"},[l("aside",{class:F(["live-tv-sidebar",{open:W.value}]),"aria-label":"Channels"},[l("ul",Ft,[(c(!0),d(x,null,P(v.value,(s,n)=>(c(),d("li",{key:s.id,class:"channel-item",role:"option","aria-selected":String(m.value===n),tabindex:"0",onClick:a=>k(n),onKeydown:_e(a=>k(n),["enter"])},[l("span",{class:"channel-pill",style:y({background:R[n%4]})},null,4),l("span",Bt,u(s.name),1)],40,Gt))),128))])],2),l("section",Ht,[l("div",Kt,[l("button",{class:"channels-btn",type:"button",onClick:t[2]||(t[2]=s=>W.value=!0)},[...t[19]||(t[19]=[l("i",{class:"fas fa-list"},null,-1),D(" Channels ",-1)])])]),l("div",Wt,[t[20]||(t[20]=Qe('<div class="guide-header" data-v-f0b861e1><div data-v-f0b861e1>Guide</div><div class="kbd-hint" aria-hidden="true" data-v-f0b861e1><span data-v-f0b861e1>Navigate</span><span class="kbd" data-v-f0b861e1>↑</span><span class="kbd" data-v-f0b861e1>↓</span><span class="kbd" data-v-f0b861e1>←</span><span class="kbd" data-v-f0b861e1>→</span><span data-v-f0b861e1>Tune to channel</span><span class="kbd" data-v-f0b861e1>Enter</span></div></div>',1)),l("div",Ot,[(c(!0),d(x,null,P(ke.value,s=>(c(),d("div",{key:s,class:"time-marker",style:y({minWidth:30*we+"px"})},u(s),5))),128))]),l("div",zt,[l("div",Qt,[l("div",{class:"now-line",style:y(Te.value)},null,4),(c(!0),d(x,null,P(v.value,(s,n)=>(c(),d("div",{key:s.id,class:"guide-row",role:"row"},[l("div",qt,[l("div",{class:"guide-channel-icon",style:y({background:R[n%4]})},null,4),l("div",Xt,u(s.name),1)]),l("div",Jt,[(c(!0),d(x,null,P(ie.value[n]||[],(a,o)=>(c(),d("div",{key:n+"-"+o,class:F(["program",{selected:$.value.row===n&&$.value.col===o}]),style:y({width:a.widthPx+"px"}),"data-row":n,"data-col":o,tabindex:"0",role:"gridcell","aria-label":a.title+" • "+a.durMin+" min",onClick:f=>{L(n,o),k(n)},onKeydown:_e(f=>{L(n,o),k(n)},["enter"])},[l("img",{class:"program-thumb",src:a.thumbnail,alt:a.title,loading:"lazy"},null,8,Zt),l("div",jt,u(a.title),1),l("div",It,u(a.timeLabel)+" • "+u(a.category),1)],46,Yt))),128))])]))),128))])])])]),W.value?(c(),d("div",{key:0,class:"ltv-overlay",onClick:t[3]||(t[3]=s=>W.value=!1)})):C("",!0)],512)]))}},ln=We(tn,[["__scopeId","data-v-f0b861e1"]]);export{ln as default};
