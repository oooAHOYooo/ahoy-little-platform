import{_ as Ee,o as Ve,b as Ne,c as v,d as h,e as n,f as q,t as u,n as E,C as x,F as U,r as D,i as O,H as $e,E as Fe,a as Ae,m as c,q as K,g as de}from"./index-Dc5YEzPe.js";const Ge={class:"tv-container"},Re={class:"video-spotlight"},Ke={class:"spotlight-grid"},Be={class:"spotlight-left"},We={class:"panelstream-player hero-player"},ze={class:"video-header"},He={class:"channel-name-label","aria-live":"polite"},je={class:"channel-remote remote-below","aria-label":"Channel Controls"},qe={class:"playing-now glass"},Oe=["src"],Je={class:"now-col"},Qe={class:"np-title"},Xe={class:"np-sub"},Ye={class:"next-col"},Ze={class:"np-next"},Ie={class:"ltv-progress-wrap"},et={class:"right-dashboard glass hidden-mobile","aria-label":"Channel Dashboard"},tt=["src"],nt={class:"rd-now"},lt={class:"rd-title"},st={class:"rd-meta"},at={class:"rd-next"},ot={class:"rd-title"},it={id:"channel-selector"},rt={key:1,class:"channel-selector-empty"},ut={class:"channel-selector-empty-text"},ct={key:0,class:"channel-selector-empty-hint"},dt=["onClick","onMouseenter"],vt={class:"channel-button-name"},ht={class:"channel-button-next"},ft=["src"],mt={class:"live-tv-channel-preview-title"},pt={class:"live-tv-channel-preview-meta"},gt={class:"channel-list",role:"listbox","aria-label":"Live TV Channels"},bt=["aria-selected","onClick","onKeydown"],yt={class:"channel-name"},wt={class:"live-tv-main"},_t={class:"mobile-only",style:{padding:"8px 10px"}},kt={class:"guide"},Ct={class:"guide-timebar"},Tt={class:"guide-scroller"},Mt={class:"guide-rows",role:"grid","aria-label":"Channel Guide"},xt={class:"guide-channel-label"},Ut={class:"guide-track"},Dt=["data-row","data-col","aria-label","onClick","onKeydown"],St=["src","alt"],Lt={class:"program-title"},Pt={class:"program-meta"},ve=6,J=180,Et={__name:"LiveTVView",setup(Vt){const g=c(null),V=c(null),d=c([]),f=c(0),N=c(!0),$=c(!1),S=c(!1),L=c(!0),B=c("Live"),W=c("—"),z=c("/static/img/default-cover.jpg"),H=c("—"),j=c(0),F=c(!1),P=c({row:0,col:0}),b=c({visible:!1,x:0,y:0,thumb:"",title:"",meta:""});let _=null;const A=c([]);let G="",k=null;const Q=["#7c66ff","#ff6b6b","#22c55e","#f59e0b"],he=[{key:"misc",titles:["misc","clips","clip"],label:"Channel 01 — Misc"},{key:"films",titles:["films","film","movies","movie","short films","short film"],label:"Channel 02 — Short Films"},{key:"music-videos",titles:["music videos","music_video","music"],label:"Channel 03 — Music Videos"},{key:"live-shows",titles:["live shows","broadcast","shows","live"],label:"Channel 04 — Live Shows"}],fe=K(()=>d.value.map((e,t)=>{const l=he[t];return(l==null?void 0:l.label)||`Channel ${String(t+1).padStart(2,"0")} — ${e.name}`})),me=K(()=>{const e=f.value,t=d.value[e];return`Channel ${String(e+1).padStart(2,"0")} — ${(t==null?void 0:t.name)||"Live TV"}`}),pe=K(()=>{const e=[],t=new Date;for(let l=0;l<=J;l+=30){const s=new Date(t.getTime()+l*6e4);e.push(s.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}))}return e}),X=K(()=>{const e={},t=new Date;return d.value.forEach((l,s)=>{const a=[];let r=new Date(t),m=0;const i=l.items||[];if(!i.length){e[s]=a;return}for(;Y(t,r)<J;){const o=i[m%i.length],p=Math.max(5,Math.round(((o==null?void 0:o.duration_seconds)||300)/60)),w=new Date(r.getTime()+p*6e4);a.push({title:(o==null?void 0:o.title)||"Untitled",thumbnail:(o==null?void 0:o.thumbnail)||"/static/img/default-cover.jpg",category:(o==null?void 0:o.category)||l.name||"Show",durMin:p,widthPx:p*ve,timeLabel:`${Z(r)} – ${Z(w)}`,startUTC:r.getTime(),endUTC:w.getTime(),src:(o==null?void 0:o.video_url)||(o==null?void 0:o.mp4_link)||(o==null?void 0:o.trailer_url)||"",item:o}),r=w,m++}e[s]=a}),e});function Y(e,t){return Math.round((t.getTime()-e.getTime())/6e4)}function Z(e){return e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function C(e){return e&&e.replace(/\[[^\]]*\]/g,"").replace(/\([^)]*\)/g,"").trim()||"Untitled"}function ge(e){return(e==null?void 0:e.video_url)||(e==null?void 0:e.mp4_link)||(e==null?void 0:e.trailer_url)||""}function be(){const e=[],t=new Date;d.value.forEach((l,s)=>{const a=l.items||[];if(!a.length)return;let r=new Date(t),m=0;for(;Y(t,r)<J;){const i=a[m%a.length],o=Math.max(5,Math.round(((i==null?void 0:i.duration_seconds)||300)/60)),p=new Date(r.getTime()+o*6e4);e.push({startUTC:r.getTime(),endUTC:p.getTime(),row:s,col:m,title:(i==null?void 0:i.title)||"Program",category:(i==null?void 0:i.category)||l.name||"Show",src:ge(i),thumb:(i==null?void 0:i.thumbnail)||"",durationSec:o*60}),r=p,m++}}),e.sort((l,s)=>l.startUTC-s.startUTC),A.value=e}function T(e){const t=Date.now();for(const l of A.value)if(!(e!=null&&l.row!==e)&&t>=l.startUTC&&t<l.endUTC)return l;return null}function I(e){const t=Date.now();let l=null;for(const s of A.value)e!=null&&s.row!==e||s.startUTC>t&&(!l||s.startUTC<l.startUTC)&&(l=s);return l}function ee(e){const t=Math.max(0,Date.now()-e.startUTC);return Math.max(0,Math.min(Math.floor(t/1e3),e.durationSec-1))}function ye(){const e=g.value;if(!e||!A.value.length)return;const t=T(f.value);if(!t||!t.src)return;const l=t.src!==G,s=ee(t);if(l){G=t.src;try{e.pause()}catch{}e.src=t.src;try{e.load()}catch{}e.currentTime=s,e.muted=!0,L.value=!0,e.play().catch(()=>{})}else if(Math.abs((e.currentTime||0)-s)>3)try{e.currentTime=s}catch{}}function we(){const e=T(f.value),t=I(f.value);e&&(B.value=C(e.title),W.value=e.category||"",e.thumb&&(z.value=e.thumb)),H.value=t?C(t.title):"—"}function _e(){const e=T(f.value);if(!e){j.value=0;return}const t=Date.now();j.value=Math.max(0,Math.min(100,(t-e.startUTC)/(e.endUTC-e.startUTC)*100))}function R(){ye(),we(),_e()}function te(){const e=T(f.value);if(!e)return;const t=g.value;if(!t)return;const l=ee(e);try{Math.abs((t.currentTime||0)-l)>2&&(t.currentTime=l)}catch{}}function ke(){S.value=!1;const e=I(f.value);if(!e)return;const t=()=>{G="",R()},l=Date.now();l<e.startUTC?setTimeout(t,Math.max(0,e.startUTC-l+50)):t()}function Ce(){g.value&&(S.value?g.value.pause():g.value.play().catch(()=>{}))}function Te(){g.value&&(L.value=!L.value,g.value.muted=L.value)}function Me(){var t,l,s;const e=g.value||document.documentElement;document.fullscreenElement?(s=document.exitFullscreen)==null||s.call(document):(l=(t=e==null?void 0:e.requestFullscreen)==null?void 0:t.call(e))==null||l.catch(()=>{})}function xe(){const e=d.value.length;if(!e)return;const t=(f.value+1)%e;y(t)}function Ue(){const e=d.value.length;if(!e)return;const t=(f.value-1+e)%e;y(t)}function y(e){f.value=e,G="",R()}function De(){var e;(e=V.value)==null||e.scrollIntoView({behavior:"smooth",block:"start"})}function Se(e){var s;const t=T(e);if(t)return C(t.title);const l=d.value[e];return(s=l==null?void 0:l.items)!=null&&s.length?C(l.items[0].title):"—"}function Le(e,t){ne(),_=setTimeout(()=>{var ae,oe,ie,re,ue,ce;const l=d.value[t];if(!l)return;const s=T(t),a=(s==null?void 0:s.thumb)||((oe=(ae=l.items)==null?void 0:ae[0])==null?void 0:oe.thumbnail)||"/static/img/default-cover.jpg",r=C(s?s.title:(re=(ie=l.items)==null?void 0:ie[0])==null?void 0:re.title),m=(s==null?void 0:s.category)||((ce=(ue=l.items)==null?void 0:ue[0])==null?void 0:ce.category)||l.name||"",i=e.target.closest(".channel-button").getBoundingClientRect(),o=280;let p=i.left+i.width/2-o/2,w=i.top-12;p<12&&(p=12),p+o>window.innerWidth-12&&(p=window.innerWidth-o-12),w<12&&(w=i.bottom+12),b.value={visible:!0,x:p,y:w,thumb:a,title:r,meta:m}},1e3)}function ne(){_&&(clearTimeout(_),_=null),b.value={...b.value,visible:!1}}function M(e,t){P.value={row:e,col:t}}function le(e){var r;if(!V.value)return;const t=V.value.getBoundingClientRect();if(t.bottom<0||t.top>window.innerHeight)return;const l=d.value.length;if(!l)return;const{row:s,col:a}=P.value;if(e.key==="ArrowUp")e.preventDefault(),M(Math.max(0,s-1),a);else if(e.key==="ArrowDown")e.preventDefault(),M(Math.min(l-1,s+1),a);else if(e.key==="ArrowRight"){e.preventDefault();const m=(((r=X.value[s])==null?void 0:r.length)||1)-1;M(s,Math.min(m,a+1))}else e.key==="ArrowLeft"?(e.preventDefault(),M(s,Math.max(0,a-1))):e.key==="Enter"&&(e.preventDefault(),y(P.value.row))}function Pe(e){var l;const t=(e==null?void 0:e.channels)??((l=e==null?void 0:e.data)==null?void 0:l.channels)??[];return Array.isArray(t)?t.map(s=>({...s,id:(s==null?void 0:s.id)??"misc",name:(s==null?void 0:s.name)??"Channel",items:Array.isArray(s==null?void 0:s.items)?s.items:[]})):[]}async function se(){N.value=!0,$.value=!1,k&&(clearInterval(k),k=null);let e=null;try{e=await Fe("/api/live-tv/channels?_="+Date.now())}catch{try{e=await Ae("/api/live-tv/channels")}catch{$.value=!0,d.value=[],N.value=!1;return}}d.value=Pe(e||{}),d.value.length&&(be(),R(),k=setInterval(R,1e3)),N.value=!1}return Ve(async()=>{document.addEventListener("keydown",le),await se()}),Ne(()=>{k&&clearInterval(k),_&&clearTimeout(_),document.removeEventListener("keydown",le)}),(e,t)=>(v(),h("div",Ge,[t[18]||(t[18]=n("section",{class:"podcasts-hero"},[n("div",{class:"podcasts-hero-inner"},[n("h1",null,[n("i",{class:"fas fa-tv","aria-hidden":"true"}),q(" Live TV ")]),n("p",null,"Channel surf and watch live programming.")])],-1)),n("div",Re,[n("div",Ke,[n("div",Be,[n("div",We,[n("video",{ref_key:"videoEl",ref:g,controls:"",autoplay:"",muted:"",playsinline:"","webkit-playsinline":"",onPlay:t[0]||(t[0]=l=>S.value=!0),onPause:t[1]||(t[1]=l=>S.value=!1),onEnded:ke,onError:te,onStalled:te},null,544),n("div",ze,[t[4]||(t[4]=n("span",{class:"now-playing-label"},"Now Playing",-1)),n("span",He,u(me.value),1)]),t[5]||(t[5]=n("div",{class:"hero-glass"},null,-1))]),n("div",je,[n("button",{type:"button",class:"remote-btn",title:"Play/Pause",onClick:Ce},[n("i",{class:E(S.value?"fas fa-pause":"fas fa-play")},null,2)]),n("button",{type:"button",class:"remote-btn",title:"Mute",onClick:Te},[n("i",{class:E(L.value?"fas fa-volume-mute":"fas fa-volume-up")},null,2)]),n("button",{type:"button",class:"remote-btn",title:"Fullscreen",onClick:Me},[...t[6]||(t[6]=[n("i",{class:"fas fa-expand"},null,-1)])]),n("button",{type:"button",class:"remote-btn",title:"Go to Guide",onClick:De},[...t[7]||(t[7]=[n("i",{class:"fas fa-list"},null,-1)])]),n("button",{type:"button",class:"remote-btn",title:"Channel Up",onClick:xe},[...t[8]||(t[8]=[n("i",{class:"fas fa-chevron-up"},null,-1)])]),n("button",{type:"button",class:"remote-btn",title:"Channel Down",onClick:Ue},[...t[9]||(t[9]=[n("i",{class:"fas fa-chevron-down"},null,-1)])])]),n("div",qe,[n("img",{src:z.value,alt:""},null,8,Oe),n("div",Je,[n("div",Qe,u(B.value),1),n("div",Xe,u(W.value),1)]),n("div",Ye,[t[10]||(t[10]=n("div",{class:"np-label"},"Up Next",-1)),n("div",Ze,u(H.value),1)]),n("div",Ie,[n("div",{class:"ltv-progress",style:x({width:j.value+"%"})},null,4)])])]),n("aside",et,[n("img",{src:z.value,alt:"",class:"rd-thumb"},null,8,tt),n("div",nt,[t[11]||(t[11]=n("div",{class:"rd-label"},"Playing Now",-1)),n("div",lt,u(B.value),1),n("div",st,[n("span",null,u(W.value),1)])]),n("div",at,[t[12]||(t[12]=n("div",{class:"rd-label"},"Up Next",-1)),n("div",ot,u(H.value),1)])])])]),n("div",it,[N.value?(v(),h(U,{key:0},D(4,l=>n("div",{key:"skeleton-"+l,class:"channel-button",style:{"pointer-events":"none"}},[...t[13]||(t[13]=[n("div",{class:"skeleton",style:{height:"20px",width:"70%","margin-bottom":"8px"}},null,-1),n("div",{class:"skeleton",style:{height:"14px",width:"50%"}},null,-1)])])),64)):d.value.length===0?(v(),h("div",rt,[n("p",ut,u($.value?"Couldn't load channels":"No channels available"),1),$.value?(v(),h("p",ct,"Check your connection and try again.")):O("",!0),n("button",{type:"button",class:"channel-selector-retry",onClick:se},[...t[14]||(t[14]=[n("i",{class:"fas fa-sync-alt"},null,-1),q(" Retry ",-1)])])])):(v(!0),h(U,{key:2},D(d.value,(l,s)=>(v(),h("button",{key:l.id,type:"button",class:E(["channel-button",{active:f.value===s}]),onClick:a=>y(s),onMouseenter:a=>Le(a,s),onMouseleave:ne},[n("div",vt,u(fe.value[s]||l.name),1),n("div",ht,u(Se(s)),1)],42,dt))),128))]),b.value.visible?(v(),h("div",{key:0,class:"live-tv-channel-preview visible",style:x({left:b.value.x+"px",top:b.value.y+"px"}),"aria-hidden":"true"},[n("img",{src:b.value.thumb,alt:""},null,8,ft),n("div",mt,u(b.value.title),1),n("div",pt,u(b.value.meta),1)],4)):O("",!0),n("div",{ref_key:"guideRef",ref:V,class:"live-tv-container","aria-label":"TV Guide"},[n("aside",{class:E(["live-tv-sidebar",{open:F.value}]),"aria-label":"Channels"},[n("ul",gt,[(v(!0),h(U,null,D(d.value,(l,s)=>(v(),h("li",{key:l.id,class:"channel-item",role:"option","aria-selected":String(f.value===s),tabindex:"0",onClick:a=>y(s),onKeydown:de(a=>y(s),["enter"])},[n("span",{class:"channel-pill",style:x({background:Q[s%4]})},null,4),n("span",yt,u(l.name),1)],40,bt))),128))])],2),n("section",wt,[n("div",_t,[n("button",{class:"channels-btn",type:"button",onClick:t[2]||(t[2]=l=>F.value=!0)},[...t[15]||(t[15]=[n("i",{class:"fas fa-list"},null,-1),q(" Channels ",-1)])])]),n("div",kt,[t[17]||(t[17]=$e('<div class="guide-header" data-v-f1014344><div data-v-f1014344>Guide</div><div class="kbd-hint" aria-hidden="true" data-v-f1014344><span data-v-f1014344>Navigate</span><span class="kbd" data-v-f1014344>↑</span><span class="kbd" data-v-f1014344>↓</span><span class="kbd" data-v-f1014344>←</span><span class="kbd" data-v-f1014344>→</span><span data-v-f1014344>Tune to channel</span><span class="kbd" data-v-f1014344>Enter</span></div></div>',1)),n("div",Ct,[(v(!0),h(U,null,D(pe.value,l=>(v(),h("div",{key:l,class:"time-marker",style:x({minWidth:30*ve+"px"})},u(l),5))),128))]),n("div",Tt,[n("div",Mt,[t[16]||(t[16]=n("div",{class:"now-line",style:{left:"150px"}},null,-1)),(v(!0),h(U,null,D(d.value,(l,s)=>(v(),h("div",{key:l.id,class:"guide-row",role:"row"},[n("div",xt,[n("span",{class:"guide-channel-icon",style:x({background:Q[s%4]})},null,4),n("span",null,u(l.name),1)]),n("div",Ut,[(v(!0),h(U,null,D(X.value[s]||[],(a,r)=>(v(),h("div",{key:s+"-"+r,class:E(["program",{selected:P.value.row===s&&P.value.col===r}]),style:x({width:a.widthPx+"px"}),"data-row":s,"data-col":r,tabindex:"0",role:"gridcell","aria-label":a.title+" • "+a.durMin+" min",onClick:m=>{M(s,r),y(s)},onKeydown:de(m=>{M(s,r),y(s)},["enter"])},[n("img",{class:"program-thumb",src:a.thumbnail,alt:a.title,loading:"lazy"},null,8,St),n("div",Lt,u(a.title),1),n("div",Pt,u(a.timeLabel)+" • "+u(a.category),1)],46,Dt))),128))])]))),128))])])])]),F.value?(v(),h("div",{key:0,class:"ltv-overlay",onClick:t[3]||(t[3]=l=>F.value=!1)})):O("",!0)],512)]))}},$t=Ee(Et,[["__scopeId","data-v-f1014344"]]);export{$t as default};
