{% extends "base.html" %}
<div class="track-actions">
    <button class="action-btn save-btn bm-btn"
        @click.stop="window.AhoyBookmarks && window.AhoyBookmarks.toggle({ type: 'track', id: track.id, title: track.title, artwork: track.cover_art }); $el.classList.add('sparkle'); setTimeout(() => $el.classList.remove('sparkle'), 600)"
        :aria-pressed="window.AhoyBookmarks ? window.AhoyBookmarks.isBookmarked('track', track.id) : false"
        :class="{ 'just-bookmarked': window.AhoyBookmarks && window.AhoyBookmarks.isBookmarked('track', track.id) }">
        <span aria-hidden="true">
            <i
                x-show="window.AhoyBookmarks && window.AhoyBookmarks.isBookmarked('track', track.id)"
                class="fas fa-bookmark"
                style="color: var(--accent-color);"></i>
            <i
                x-show="!(window.AhoyBookmarks && window.AhoyBookmarks.isBookmarked('track', track.id))"
                class="far fa-bookmark"></i>
        </span>
        <span class="sr-only">Bookmark</span>
    </button>
</div>
{% block title %}{{ artist.name }} - Artist Profile - Ahoy Indie Media{%
endblock %}

{% block meta %}
<meta name="description"
    content="{{ artist.bio or 'Discover ' + artist.name + ' on Ahoy Indie Media. ' + (artist.genre or 'Indie artist') + ' with ' + (artist.music_count or 0)|string + ' tracks and ' + (artist.show_count or 0)|string + ' shows.' }}">
<meta name="keywords"
    content="{{ artist.name }}, {{ artist.genre or 'indie music' }}, {{ artist.type or 'artist' }}, ahoy indie media, music, shows, {{ artist.location or 'indie artist' }}">
<meta property="og:title" content="{{ artist.name }} - Artist Profile">
<meta property="og:description"
    content="{{ artist.bio or 'Discover ' + artist.name + ' on Ahoy Indie Media' }}">
<meta property="og:image"
    content="{{ artist.image or '/static/img/default-avatar.png' }}">
<meta property="og:type" content="profile">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ artist.name }} - Artist Profile">
<meta name="twitter:description"
    content="{{ artist.bio or 'Discover ' + artist.name + ' on Ahoy Indie Media' }}">
<meta name="twitter:image"
    content="{{ artist.image or '/static/img/default-avatar.png' }}">
{% endblock %}

{% block content %}
<div class="artist-detail-page" x-data="artistDetailPage()" x-init="init()">
    <!-- Artist Hero Section -->
    <section class="artist-hero">
        <div class="artist-hero-bg"
            :style="`background-image: url(${artist.image || '/static/img/default-avatar.png'})`"></div>
        <div class="artist-hero-content">
            <div class="artist-avatar-large">
                <img :src="artist.image || '/static/img/default-avatar.png'"
                    :alt="artist.name">
            </div>
            <div class="artist-info">
                <h1 x-text="artist.name"></h1>
                <p class="artist-type" x-text="artist.type || 'Artist'"></p>
                <p class="artist-location"
                    x-text="artist.location || 'Location not specified'"></p>
                <p class="artist-bio"
                    x-text="artist.bio || 'No bio available'"></p>
                <div class="artist-stats">
                    <div class="stat-item">
                        <span class="stat-number"
                            x-text="artist.music_count || 0"></span>
                        <span class="stat-label">Tracks</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number"
                            x-text="artist.show_count || 0"></span>
                        <span class="stat-label">Shows</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number"
                            x-text="artist.followers || 0"></span>
                        <span class="stat-label">Followers</span>
                    </div>
                </div>
                <div class="artist-actions">
                    <button @click="followArtist()" class="btn btn-primary"
                        :class="{'following': isFollowing}">
                        <i class="fas fa-heart" x-show="!isFollowing"></i>
                        <i class="fas fa-check" x-show="isFollowing"></i>
                        <span
                            x-text="isFollowing ? 'Following' : 'Follow'"></span>
                    </button>
                    <button @click="shareArtist()" class="btn btn-outline">
                        <i class="fas fa-share"></i> Share
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Artist Content Tabs -->
    <section class="artist-content">
        <div class="content-tabs">
            <button @click="activeTab = 'music'"
                :class="{'active': activeTab === 'music'}" class="tab-btn">
                <i class="fas fa-music"></i> Music
            </button>
            <button @click="activeTab = 'shows'"
                :class="{'active': activeTab === 'shows'}" class="tab-btn">
                <i class="fas fa-play-circle"></i> Shows
            </button>
            <button @click="activeTab = 'about'"
                :class="{'active': activeTab === 'about'}" class="tab-btn">
                <i class="fas fa-info-circle"></i> About
            </button>
        </div>

        <!-- Music Tab -->
        <div x-show="activeTab === 'music'" class="tab-content">
            <div class="content-header">
                <h2>Music by <span x-text="artist.name"></span></h2>
                <div class="view-controls">
                    <button @click="musicViewMode = 'grid'"
                        :class="{'active': musicViewMode === 'grid'}"
                        class="view-btn">
                        <i class="fas fa-th"></i>
                    </button>
                    <button @click="musicViewMode = 'list'"
                        :class="{'active': musicViewMode === 'list'}"
                        class="view-btn">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </div>
            <div x-show="musicViewMode === 'grid'" class="music-grid">
                <template x-for="track in artistMusic" :key="track.id">
                    <div class="music-card" @click="playTrack(track)">
                        <div class="music-cover">
                            <img
                                :src="track.cover_art || '/static/img/default-cover.jpg'"
                                :alt="track.title">
                            <div class="play-overlay">
                                <i class="fas fa-play"></i>
                            </div>

                        </div>
                        <div class="music-info">
                            <h4 x-text="track.title"></h4>
                            <p x-text="track.genre || 'Music'"></p>
                        </div>
                    </div>
                </template>
            </div>
            <div x-show="musicViewMode === 'list'" class="music-list">
                <template x-for="track in artistMusic" :key="track.id">
                    <div class="music-list-item" @click="playTrack(track)">
                        <img
                            :src="track.cover_art || '/static/img/default-cover.jpg'"
                            :alt="track.title">
                        <div class="music-details">
                            <h4 x-text="track.title"></h4>
                            <p x-text="track.genre || 'Music'"></p>
                        </div>
                        <div class="music-actions">
                            <button @click.stop="playTrack(track)"
                                class="play-btn">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Shows Tab -->
        <div x-show="activeTab === 'shows'" class="tab-content">
            <div class="content-header">
                <h2>Shows by <span x-text="artist.name"></span></h2>
                <div class="view-controls">
                    <button @click="showsViewMode = 'grid'"
                        :class="{'active': showsViewMode === 'grid'}"
                        class="view-btn">
                        <i class="fas fa-th"></i>
                    </button>
                    <button @click="showsViewMode = 'list'"
                        :class="{'active': showsViewMode === 'list'}"
                        class="view-btn">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </div>
            <div x-show="showsViewMode === 'grid'" class="shows-grid">
                <template x-for="show in artistShows" :key="show.id">
                    <div class="show-card" @click="playShow(show)">
                        <div class="show-thumbnail">
                            <img
                                :src="show.thumbnail || '/static/img/default-cover.jpg'"
                                :alt="show.title">
                            <div class="play-overlay">
                                <i class="fas fa-play"></i>
                            </div>
                        </div>
                        <div class="show-info">
                            <h4 x-text="show.title"></h4>
                            <p x-text="show.host || 'Show'"></p>
                        </div>
                    </div>
                </template>
            </div>
            <div x-show="showsViewMode === 'list'" class="shows-list">
                <template x-for="show in artistShows" :key="show.id">
                    <div class="show-list-item" @click="playShow(show)">
                        <img
                            :src="show.thumbnail || '/static/img/default-cover.jpg'"
                            :alt="show.title">
                        <div class="show-details">
                            <h4 x-text="show.title"></h4>
                            <p x-text="show.host || 'Show'"></p>
                        </div>
                        <div class="show-actions">
                            <button @click.stop="playShow(show)"
                                class="play-btn">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- About Tab -->
        <div x-show="activeTab === 'about'" class="tab-content">
            <div class="about-content">
                <div class="about-section">
                    <h3>About <span x-text="artist.name"></span></h3>
                    <p
                        x-text="artist.bio || 'No biography available for this artist.'"></p>
                </div>
                <div class="about-section" x-show="artist.location">
                    <h3>Location</h3>
                    <p x-text="artist.location"></p>
                </div>
                <div class="about-section" x-show="artist.website">
                    <h3>Website</h3>
                    <a :href="artist.website" target="_blank"
                        class="website-link">
                        <i class="fas fa-external-link-alt"></i>
                        <span x-text="artist.website"></span>
                    </a>
                </div>
                <div class="about-section">
                    <h3>Stats</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <i class="fas fa-music"></i>
                            <span class="stat-number"
                                x-text="artist.music_count || 0"></span>
                            <span class="stat-label">Tracks</span>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-play-circle"></i>
                            <span class="stat-number"
                                x-text="artist.show_count || 0"></span>
                            <span class="stat-label">Shows</span>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-heart"></i>
                            <span class="stat-number"
                                x-text="artist.followers || 0"></span>
                            <span class="stat-label">Followers</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<script>
function artistDetailPage() {
    return {
        artist: {{ artist|tojson }},
        activeTab: 'music',
        musicViewMode: 'grid',
        showsViewMode: 'grid',
        artistMusic: [],
        artistShows: [],
        isFollowing: false,

        init() {
            this.loadArtistContent();
        },

        async loadArtistContent() {
            try {
                // Load artist's music
                const musicResponse = await fetch(`/api/artists/${this.artist.id}/music`);
                if (musicResponse.ok) {
                    this.artistMusic = await musicResponse.json();
                }

                // Load artist's shows
                const showsResponse = await fetch(`/api/artists/${this.artist.id}/shows`);
                if (showsResponse.ok) {
                    this.artistShows = await showsResponse.json();
                }
            } catch (error) {
                console.error('Error loading artist content:', error);
            }
        },

        playTrack(track) {
            if (window.ahoyApp && window.ahoyApp.playMedia) {
                window.ahoyApp.playMedia(track);
            }
        },

        playShow(show) {
            if (window.ahoyApp && window.ahoyApp.playMedia) {
                window.ahoyApp.playMedia(show);
            }
        },

        followArtist() {
            this.isFollowing = !this.isFollowing;
            // TODO: Implement follow/unfollow API call
        },

        shareArtist() {
            if (navigator.share) {
                navigator.share({
                    title: `${this.artist.name} - Artist Profile`,
                    text: `Check out ${this.artist.name} on Ahoy Indie Media`,
                    url: window.location.href
                });
            } else {
                // Fallback to copying URL
                navigator.clipplaylist.writeText(window.location.href);
                alert('Link copied to clipplaylist!');
            }
        }
    };
}
</script>
{% endblock %}
