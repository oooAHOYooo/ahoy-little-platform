{% extends "base.html" %}
{% block title %}Forgot Password - Ahoy{% endblock %}

{% block extra_css %}
<style>
  .navbar { display:none; }
  .main-content { padding-top: 0; }
  .pw-wrap { max-width: 520px; margin: 0 auto; padding: 22px 16px 44px; }
  .pw-card { border-radius: 16px; border: 1px solid rgba(255,255,255,0.10); background: rgba(255,255,255,0.03); padding: 16px; }
  .pw-title { font-size: 20px; margin: 0; }
  .pw-sub { margin: 8px 0 0; color: rgba(255,255,255,0.72); }
  .pw-form { margin-top: 14px; display:flex; flex-direction: column; gap: 10px; }
  .pw-label { font-weight: 800; display:flex; flex-direction: column; gap: 6px; }
  .pw-input { width:100%; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.14); background: rgba(0,0,0,0.35); color:#fff; }
  .pw-note { margin-top: 10px; font-size: 12px; color: rgba(255,255,255,0.65); }
  .pw-msg { margin-top: 10px; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(59,130,246,0.30); background: rgba(59,130,246,0.10); color: rgba(255,255,255,0.92); }
</style>
{% endblock %}

{% block content %}
<div class="pw-wrap" x-data="forgotPw()">
  <div class="pw-card">
    <h1 class="pw-title">Forgot your password? No stress üòÑ</h1>
    <p class="pw-sub">Drop your email and we‚Äôll send you a magic reset link (expires in 1 hour).</p>

    <form class="pw-form" @submit.prevent="submit()">
      <label class="pw-label">
        Email
        <input class="pw-input" type="email" autocomplete="email" x-model.trim="email" placeholder="you@example.com" required>
      </label>
      <button class="btn btn-primary" type="submit" :disabled="loading">
        <span x-show="!loading">Send reset link ‚úâÔ∏è</span>
        <span x-show="loading">Sending‚Ä¶</span>
      </button>
    </form>

    <div class="pw-msg" x-show="message" x-text="message"></div>
    <div class="pw-note">Tip: We‚Äôll always show success here (even if the email isn‚Äôt registered) to keep accounts private.</div>
    <div class="pw-note"><a href="/auth">Back to sign in</a></div>
  </div>
</div>

<script>
function forgotPw() {
  return {
    email: '',
    loading: false,
    message: '',
    async submit() {
      this.loading = true;
      this.message = '';
      try {
        const r = await fetch('/api/auth/password-reset/request', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ email: this.email })
        });
        const data = await r.json().catch(() => ({}));
        this.message = data.message || "If that email exists, we sent a reset link.";
      } catch (_) {
        this.message = "If that email exists, we sent a reset link.";
      } finally {
        this.loading = false;
      }
    }
  };
}
</script>
{% endblock %}

