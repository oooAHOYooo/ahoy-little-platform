{% extends "base.html" %}

{% block title %}My Account - Ahoy Indie Media{% endblock %}

{% block content %}
<div class="acct">
  {% from "macros/subpage_header.html" import subpage_hero %}
  {{ subpage_hero(title="Profile", subtitle="Your account, saves, and playlists.", icon_class="fas fa-user-circle") }}

  {% if current_user.is_authenticated %}
    <div class="acct-head">
      <div class="acct-avatar">
        <img src="{{ current_user.avatar_url or '/static/img/default-avatar.png' }}" alt="">
      </div>
      <div class="acct-meta">
        <h1 class="acct-name">{{ current_user.display_name or current_user.username or 'Account' }}</h1>
        <div class="acct-sub">
          <span class="muted">@{{ current_user.username }}</span>
          {% if current_user.email %}<span class="dot">•</span><span class="muted">{{ current_user.email }}</span>{% endif %}
        </div>
        <div class="acct-actions">
          <a class="btn btn-secondary" href="/bookmarks">Saved</a>
          <a class="btn btn-secondary" href="/playlists">Playlists</a>
          <button type="button" class="btn btn-secondary"
            onclick="import('/static/js/themes.js').then(m=>m.openThemePicker())">Theme</button>
        </div>
      </div>
    </div>

    <div class="acct-grid">
      <div class="card glass">
        <div class="card-header">Your Stats</div>
        <div class="card-body">
          <div class="acct-stats">
            <div class="acct-stat">
              <div class="n">{{ stats.bookmarks or 0 }}</div>
              <div class="l">Saved</div>
            </div>
            <div class="acct-stat">
              <div class="n">{{ stats.playlists or 0 }}</div>
              <div class="l">Playlists</div>
            </div>
            <div class="acct-stat">
              <div class="n">{{ stats.plays or 0 }}</div>
              <div class="l">Plays</div>
            </div>
            <div class="acct-stat">
              <div class="n">{{ stats.merch_orders or 0 }}</div>
              <div class="l">Merch Orders</div>
            </div>
          </div>
          <p class="muted text-sm" style="margin:10px 0 0;">
            This page is intentionally lightweight and read-only for speed.
          </p>
        </div>
      </div>

      <div class="card glass">
        <div class="card-header">Recent Merch Orders</div>
        <div class="card-body">
          {% if recent_orders and recent_orders|length %}
            <div class="acct-orders">
              {% for o in recent_orders %}
                <div class="acct-order">
                  <div>
                    <div class="row1">
                      <strong>#{{ o.id }}</strong>
                      <span class="pill st-{{ (o.status or 'pending')|e }}">{{ (o.status or 'pending') }}</span>
                    </div>
                    <div class="muted text-sm">
                      {{ o.item_id }}{% if o.qty %} • Qty {{ o.qty }}{% endif %}
                      {% if o.created_at %} • {{ o.created_at }}{% endif %}
                    </div>
                  </div>
                  <div class="right">
                    <div class="total">{{ '$%.2f'|format((o.total or 0)|float) }}</div>
                    <div class="muted text-xs">{{ o.stripe_id or '' }}</div>
                  </div>
                </div>
              {% endfor %}
            </div>
            <div class="muted text-xs" style="margin-top:10px;">
              Status comes from payment + fulfillment tracking (pending → paid → fulfilled).
            </div>
          {% else %}
            <div class="muted">No merch orders yet.</div>
            <div style="margin-top:10px;">
              <a class="btn btn-primary" href="/merch">Shop Merch</a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  {% else %}
    <div class="acct-guest glass">
      <h2>Account</h2>
      <p class="muted">Sign in to view your profile, saves, and merch orders.</p>
      <div style="margin-top:12px;">
        <a class="btn btn-primary" href="/auth">Sign in</a>
      </div>
    </div>
  {% endif %}
</div>

<style>
  .acct { max-width: 1100px; margin: 0 auto; padding: 18px 18px 40px; }
  .acct-head { display:flex; gap: 14px; align-items:center; padding: 14px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03); }
  .acct-avatar { width: 56px; height: 56px; border-radius: 16px; overflow:hidden; border: 1px solid rgba(255,255,255,0.10); background: rgba(0,0,0,0.35); flex: 0 0 auto; }
  .acct-avatar img { width:100%; height:100%; object-fit: cover; display:block; }
  .acct-name { margin: 0; font-size: 20px; }
  .acct-sub { display:flex; gap: 8px; flex-wrap: wrap; margin-top: 4px; }
  .acct-sub .dot { opacity: .5; }
  .acct-actions { margin-top: 10px; display:flex; gap: 10px; flex-wrap: wrap; }

  .acct-grid { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px; }
  @media (max-width: 900px) { .acct-grid { grid-template-columns: 1fr; } }

  .acct-stats { display:grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 10px; }
  @media (max-width: 560px) { .acct-stats { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
  .acct-stat { border-radius: 14px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.02); padding: 10px 10px; }
  .acct-stat .n { font-weight: 900; font-size: 20px; }
  .acct-stat .l { font-size: 11px; letter-spacing: .12em; text-transform: uppercase; opacity: .7; margin-top: 2px; }

  .acct-orders { display:flex; flex-direction: column; gap: 10px; }
  .acct-order { display:flex; justify-content:space-between; gap: 12px; padding: 10px 10px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.02); }
  .acct-order .row1 { display:flex; align-items:center; gap: 8px; }
  .acct-order .right { text-align:right; }
  .acct-order .total { font-weight: 900; }

  .pill { display:inline-flex; align-items:center; padding: 4px 8px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.04); text-transform: uppercase; letter-spacing:.10em; font-size:10px; }
  .pill.st-paid { border-color: rgba(16,185,129,0.35); background: rgba(16,185,129,0.10); }
  .pill.st-pending { border-color: rgba(245,158,11,0.30); background: rgba(245,158,11,0.10); }
  .pill.st-fulfilled { border-color: rgba(59,130,246,0.28); background: rgba(59,130,246,0.10); }

  .acct-guest { padding: 16px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03); }
  .acct-guest h1 { margin: 0; }
  .acct-guest p { margin: 8px 0 0; }
</style>
{% endblock %}
