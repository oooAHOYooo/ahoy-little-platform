{% extends "base.html" %}

{% block title %}Live TV - Ahoy Indie Media{% endblock %}

{% block head %}
<style>
/* Minimal Live TV layout */
.live-tv-container { display: grid; grid-template-columns: 260px 1fr; gap: 16px; padding: 12px; }
.live-tv-sidebar { background: #0f0f0f; border-radius: 8px; padding: 8px; }
.desktop-only { display: none !important; }
.channel-list { list-style: none; margin: 0; padding: 0; }
.channel-item { display: flex; align-items: center; gap: 10px; padding: 10px; border-radius: 6px; cursor: pointer; }
.channel-item[aria-selected="true"] { background: #222; outline: 2px solid #444; }
.channel-pill { width: 28px; height: 28px; border-radius: 50%; background: #555; display: inline-block; }
.channel-name { font-weight: 600; letter-spacing: .25px; }

.live-tv-main { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; align-items: start; }
.player-frame { position: relative; background: #000; border-radius: 12px; overflow: hidden; min-height: 48vh; }
.player-frame video { width: 100%; height: 100%; display: block; }
.now-playing-overlay { position: absolute; left: 12px; bottom: 12px; background: rgba(0,0,0,.55); padding: 10px 12px; border-radius: 8px; }
.now-title { font-weight: 800; font-size: 16px; }
.now-meta { font-size: 12px; opacity: .9; }
.player-actions { position: absolute; right: 12px; bottom: 12px; display: flex; gap: 8px; }
.btn { background:#1d1d1f; border:1px solid #2a2a2a; color:#e5e7eb; padding:10px 12px; border-radius:8px; font-weight:600; cursor:pointer; }
.btn-primary { background:#3b82f6; border-color:#3b82f6; color:white; }
.guide { background: #0f0f0f; border-radius: 8px; padding: 8px; overflow: hidden; min-height: 48vh; }
.guide-header { display: flex; align-items: center; gap: 10px; padding: 8px 10px; border-bottom: 1px solid #222; }
.guide-timebar { position: sticky; top: 0; background: #0f0f0f; z-index: 2; padding: 6px 10px; display: flex; gap: 24px; border-bottom: 1px solid #1d1d1d; flex-wrap: nowrap; overflow-x: auto; }
.time-marker { color: #bbb; font-size: 12px; min-width: 60px; text-align: left; flex: 0 0 auto; display: inline-block; }
.guide-scroller { overflow-x: auto; overflow-y: auto; }
.guide-rows { position: relative; }
.guide-row { display: flex; gap: 8px; align-items: stretch; padding: 10px; border-bottom: 1px solid #141414; }
.guide-channel-label { width: 140px; flex: 0 0 auto; display: flex; align-items: center; gap: 8px; font-weight: 600; }
.guide-channel-icon { width: 28px; height: 28px; border-radius: 6px; background: #222; }
.guide-track { position: relative; display: flex; gap: 8px; min-width: 1200px; }
.program { background: #141414; border: 1px solid #1f1f1f; border-radius: 8px; padding: 8px; display: grid; gap: 6px; color: #e5e7eb; cursor: pointer; }
.program:focus { outline: 2px solid #4f46e5; }
.program.selected { border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59,130,246,.35) inset; }
.program-thumb { width: 100%; aspect-ratio: 16/9; border-radius: 6px; object-fit: cover; background: #222; }
.program-title { font-weight: 600; font-size: 13px; }
.program-meta { font-size: 11px; opacity: .85; }
.now-line { position: absolute; top: 0; bottom: 0; width: 2px; background: #3b82f6; opacity: .85; }

.kbd-hint { font-size: 12px; opacity: .75; margin-left: auto; display: flex; gap: 8px; align-items: center; }
.kbd { border: 1px solid #333; background: #151515; padding: 2px 6px; border-radius: 4px; font-size: 11px; }

/* Details panel */
.details-panel { background: #0f0f0f; border-radius: 8px; padding: 12px; display: grid; gap: 10px; position: sticky; top: 12px; }
.details-thumb { width: 100%; aspect-ratio: 16/9; border-radius: 10px; object-fit: cover; background: #1b1b1b; }
.details-title { font-size: 18px; font-weight: 800; letter-spacing: .2px; }
.chip { display:inline-block; font-size:11px; padding:2px 8px; border-radius:999px; border:1px solid #2a2a2a; background:#151515; margin-right:6px; color:#cfcfcf; }
.details-desc { font-size: 13px; line-height: 1.5; color: #d6d6d6; }
.details-actions { display:flex; gap:8px; }
.btn { background:#1d1d1f; border:1px solid #2a2a2a; color:#e5e7eb; padding:10px 12px; border-radius:8px; font-weight:600; cursor:pointer; }
.btn-primary { background:#3b82f6; border-color:#3b82f6; color:white; }

@media (max-width: 900px) {
  .live-tv-container { grid-template-columns: 1fr; }
  .live-tv-main { grid-template-columns: 1fr; }
  .details-panel { position: static; }
}

/* CHANNEL SELECTOR */
#channel-selector {
  padding: 32px 16px;
  background: #000;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.channel-button {
  background: #111;
  border: 2px solid #222;
  border-radius: 12px;
  padding: 24px;
  cursor: pointer;
  transition: all 0.2s;
  text-align: center;
  color: #fff;
}

.channel-button:hover {
  background: #1a1a1a;
  border-color: #444;
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
}

.channel-button.active {
  background: #1a1a1a;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
}

.channel-button-name {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 8px;
}

.channel-button-next {
  font-size: 13px;
  color: #999;
  margin-top: 8px;
}

@media (max-width: 900px) {
  #channel-selector {
    grid-template-columns: 1fr;
    gap: 16px;
  }
}
</style>
{% endblock %}

{% block content %}
<div class="tv-container">
	<div class="video-spotlight">
		<div class="spotlight-grid">
			<div class="spotlight-left">
				<!-- HERO VIDEO PLAYER WITH GLASS GRADIENT AND HEADER -->
				<div class="panelstream-player hero-player">
					<video id="livePlayer" controls autoplay muted playsinline webkit-playsinline></video>
					<div class="video-header">
						<span class="now-playing-label">Now Playing</span>
						<span class="channel-name-label" id="channelNameLabel" aria-live="polite">Channel ‚Äî</span>
					</div>
					<div class="hero-glass"></div>
				</div>
				<!-- Controls below the video -->
				<div class="channel-remote remote-below" aria-label="Channel Controls">
					<button id="btnPlayPause" class="remote-btn" title="Play/Pause">‚èØ</button>
					<button id="btnMute" class="remote-btn" title="Mute">üîá</button>
					<button id="btnFullscreen" class="remote-btn" title="Fullscreen">‚õ∂</button>
					<button id="btnGoGuide" class="remote-btn" title="Go to Guide">Guide</button>
					<button id="btnChUp" class="remote-btn" title="Channel Up">CH ‚ñ≤</button>
					<button id="btnChDown" class="remote-btn" title="Channel Down">CH ‚ñº</button>
				</div>

				<!-- PLAYING NOW THIN BAR WITH PROGRESS -->
				<div id="playing-now" class="playing-now glass">
					<img id="playingNowThumb" alt="" />
					<div class="now-col">
						<div class="np-title" id="playingNowTitle">Select a program</div>
						<div class="np-sub" id="playingNowMeta">‚Äî</div>
					</div>
					<div class="next-col">
						<div class="np-label">Up Next</div>
						<div class="np-next" id="upNextTitle">‚Äî</div>
					</div>
					<div id="ltv-progress-wrap"><div id="ltv-progress"></div></div>
				</div>

			</div>
			<aside class="right-dashboard glass" id="rightDashboard" aria-label="Channel Dashboard">
				<img id="rd-thumb" alt="" class="rd-thumb"/>
				<div class="rd-now">
					<div class="rd-label">Playing Now</div>
					<div class="rd-title" id="rd-now-title">‚Äî</div>
					<div class="rd-meta"><span id="rd-category">‚Äî</span></div>
				</div>
				<div class="rd-next">
					<div class="rd-label">Up Next</div>
					<div class="rd-title" id="rd-next-title">‚Äî</div>
				</div>
			</aside>
		</div>
	</div>

	<!-- CHANNEL SELECTOR -->
	<div id="channel-selector">
		<!-- Channel buttons will be populated by JavaScript -->
	</div>
</div>

<div class="live-tv-container" id="liveTvRoot" data-initial-channel="misc" style="display:none" aria-hidden="true">
	<!-- Left sidebar: channels -->
	<aside class="live-tv-sidebar" aria-label="Channels">
		<ul class="channel-list" id="channelList" role="listbox" aria-label="Live TV Channels" tabindex="0">
			<!-- Filled by JS -->
		</ul>
	</aside>

	<!-- Main content: player and guide -->
	<section class="live-tv-main">
		<div class="player-frame" aria-live="polite">
			<video id="tvPlayer" playsinline webkit-playsinline controls preload="metadata"></video>
			<div class="now-playing-overlay">
				<div class="now-title" id="nowTitle">Select a program</div>
				<div class="now-meta" id="nowMeta">Use arrow keys and press Enter to play</div>
			</div>
			<div class="player-actions">
				<button class="btn btn-primary" id="btnWatch">Watch</button>
				<button class="btn" id="btnLater">Watch later</button>
			</div>
		</div>
		<div class="guide">
			<div class="guide-header">
				<div id="guideChannelName">Guide</div>
				<div class="kbd-hint" aria-hidden="true">
					<span>Navigate</span>
					<span class="kbd">‚Üë</span><span class="kbd">‚Üì</span>
					<span class="kbd">‚Üê</span><span class="kbd">‚Üí</span>
					<span>Open</span>
					<span class="kbd">Enter</span>
				</div>
			</div>
			<div class="guide-timebar" id="timebar"></div>
			<div class="guide-scroller">
				<div class="guide-rows" id="guideRows" role="grid" aria-label="Channel Guide">
					<div class="now-line" id="nowLine" style="left:0"></div>
					<!-- Filled by JS -->
				</div>
			</div>
		</div>
	</section>
</div>
{% endblock %}

{% block extra_head %}
<script src="{{ url_for('static', filename='js/live-tv.js') }}"></script>
<script src="{{ url_for('static', filename='js/live-tv-rows.js') }}"></script>
<script src="{{ url_for('static', filename='js/live-tv-engine.js') }}"></script>
{% endblock %}


